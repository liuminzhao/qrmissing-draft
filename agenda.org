#+TITLE: Quantile Regression Research Diary
#+INFOJS_OPT: path:scripts/org-info.js view:overview toc:nil

* 2013-05-23

** TODO SP
   SCHEDULED: <2013-05-23 Thu 20:00>

   [[file:~/Documents/qrmissing/draft/0523l.pdf][SP]] : once h is fixed, \mu is identified.

   try to revise on bivariate case first , then send to mike

   be careful about interpretation 

* 2013-05-16

** TODO revise paper
   SCHEDULED: <2013-05-23 Thu 13:00>
** TODO paper style for polya tree too

* 2013-05-07

** TODO contrast quantile for mixture models

* 2013-04-30

** TODO think about goodness of fit or bayes factor ?
** TODO think about contrast
** DONE make sure race 3 is white
   yes
** TODO put into a paper style


* 2013-04-22

** TODO similar development for binary?
** TODO what if nonparametric in each pattern? implecations and computations
** TODO quantiles for contrasts across time
** TODO explore a bit further for general case. if used laplace, what would be the order of the error of \gamma
** TODO give details on true quantile lines of separable distribution
** TODO try to explore asymptotic variance for mle estimates: checkout review papers
   
   1. check Koenker book
   2. check Roy's paper about PMM asym var
   3. check PMM mean regression asym var

   If the information matrix is also too diÂ±cult to calculate, we can use the outer product
   approximation of the information matrix:

   use bootstrap and ask mike about method of asymptotic variance of mle when derivative is hard to compute


* 2013-04-18

** TODO tours data, y1 as month 6, y2 as month 18, covariates as treatment and race

** TODO real data

** TODO correction

** TODO should not depend on initial value

** DONE multix:

   param(11 + 8*xdim):
   pp = 1 + xdim
   pp: \gamma_1 , pp: \beta_1^(0), pp: \sigma_1^(1), pp:\sigma_1^(0)
   pp: \gamma_2, pp: \beta_2^(0), pp: \sigma_2^(1), pp:\sigma_2^(0), \beta_12^(0), h, p

   go to Mike's machine to test if the same

* 2013-04-16

** TODO modify beta22 = beta2 + h in H1 and homo

** TODO add beta22 into Heter2

* 2013-04-11

** TODO write generalized version for J , even for restricted model

** TODO try to write down true quantile line for model \exp(1 + \alpha x) \sigma
   or \exp(\alpha_0 + \alpha_1 x)

* 2013-04-05

** TODO check mle for y = x\beta + (1 + x\gamma) \epsilon ~ N,0,\sigma
** TODO check mle for mean regression
   E(y) = x\beta
   y|R=1 ~ \Delta + x\beta + \epsilon 1
   y|R = 0 ~ \Delta - x\beta + \epsilon 2

   Then test mle for heter

** TODO heter unimlesigm.f testunimlesigma2.R 

   for univariate, perform pretty good. even on the extreme quantile.

   Might test simulation with qr function

** TODO heter bimlesigma MAR

   heter1, for y1
   heter2(1) for y2|R = 1, heter2(2) for 1+heter2(1)*heter2(2)*x for y2|R= 0,y1

* 2013-04-02

** DONE adaptive gradient descent method: branch: RPROP : rb-1993-rprop.pdf

   - start with UniMLESigma.f
   - BiMLESigma.f works too 

** TODO notation on page 2 , \Delta (\tau) point out independent of R , index by \tau
** TODO constraints terminology
** TODO page 8 trivariate case, MAR for Y_2
** TODO should see bigger gains if MAR tested instead of MCAR

** [[http://en.wikipedia.org/wiki/Gradient_descent][Limitations of gradient descent method]]:

   - zigzags as the gradients point nearly orthogonally to the shortest direction to a minimum point
   - ill-defined for non-differentiable function, consider 
     - bundle methods of descent for locally Lipschitz problems, especially for convex minimizatino problems
     - non-descent method: [[http://en.wikipedia.org/wiki/Subgradient_method][subgradient projection method]]
     - smooth the function
   - can be combined with a [[http://en.wikipedia.org/wiki/Line_search][line search]], finding the locally optimal step size \gamma, but time-consuming.
     however, using a fixed small \gamma can yield poor convergence
   - use [[http://en.wikipedia.org/wiki/Newton%2527s_method_in_optimization][newton's method]] : x(t+1) = x(t) - f'(x(t))/f"(x(t)), use the curvature information
   - [[http://en.wikipedia.org/wiki/BFGS_method][BFGS method]] or L-BFGS : These methods use the first and second derivatives.
   - [[http://en.wikipedia.org/wiki/Stochastic_gradient_descent][stochastic gradient descent]]
     1. Choose an initial vector of parameters \omega  and learning rate \alpha.
     2. Repeat until an approximate minimum is obtained:
        Randomly shuffle examples in the training set.
        For i = 1, 2, ..., n, do:
	\omega = \omega - \alpha DQ_i(w)
   - [[http://davinci.fmph.uniba.sk/~uhliarik4/recognition/resources/rprop/rb_1993_rprop.pdf][adaptive method: ]]
   - [[http://en.wikipedia.org/wiki/Subgradient_method][Step size rule: ]] offline and online
     - fix \alpha
     - fix \gamma 
     - \alpha_k
     - \gamma_k


* 2013-03-29

** TODO simulation comparing with true value

** TODO draft

* 2013-03-28

** DONE UniMLESigma.f, UniMLESigma.R

   when tau = 0.5, sometimes weird behavior 

* 2013-03-18

** when iteration goes deep, ll change little, the numerical derivative becomes not accurate, 

   need to change epsilon to 0.001 in derivative ?

** when there is error, try smaller alpha 0.0003

** caution when tau goes to extreme quantile: 

   the step needs to be very small , say alpha = 0.0001, and the convergence is slow

** TODO estimate phi 

** TODO use python to write code for univariate case gradient descent

** TODO bivariate model MLE code: fix sensitivity parameter: =BiMLE.R=

** TODO using precision instead of sigma: =UniMLETau.R=

** TODO univariate MLE with sigma, =qrGradient.R=

   when change alpha to 0.003, and convergence criteria to 10^-5, correct sigma is obtained.

   however, sometimes sigma does not go to true value, and other parameters \gamma and \beta 
   still are consistent

   Hope this does not affect accuracy in Bivariate case

   found there is bug in Loglikelihood , used global variable of sigma1, sigma0 (true value)
   no wonder 

* 2013-03-17

  if there is no missing, can use MLE, but if we put priors on sensitivity parameter, 
  only bayesian method can be used ?

** TODO use MLE for polya tree as well ? for posterior predictive likelihood ? 

** TODO asymptotic variance of MLE ? 

** MLE can be used in bayesian senario for posterior mode

** potential quantiles lines crossing

   based on the information covariates brought, not always happen crossing quantile lines
   
   dangerous to extrapolate covariates/quantile lines. 

* 2013-03-14

** TODO try code for univariate case with covariates

** TODO try to code for with covariates , check quantile, for bivariate case


*** TODO bayesian
*** TODO MLE 

    use MLE done. =qrGradient.R=

    parameter (gamma, beta, sigma, phi), fixed sigma, and phi. only MLE for beta and gamma

* 2013-03-08

** TODO computation complex in >3 dim . try to avoid that or look for other model specification

\begin{align*}
I(a,b) &= \int \phi(x) \Phi(\frac{x-b}{a}) dx\\
& = \int_{b \sqrt{a^2+1}}^{+\infty} \phi(t)dt
\end{align*}

one solution walk around is to use first order model , which leads to one integral for each subject

* 2013-03-05

** TODO draft computation part for bivariate part

* 2013-02-28

** TODO monotone dropout, MAR

** TODO bivariate case

** TODO trivariate case

** TODO generalized form other than normal

** TODO exp \lambda form on ymis

** TODO likelihood computation

** TODO pattern mixture

** TODO code for bivaraite

* 2013-02-27
** TODO which is sensitivity parameter

   if use common \delta, how to specify sensitivity parameter?

   say univariate case, different parametrization can cause difficulty in choosing 
   sensitiviy parameter

   - [ ] check how Roy do with sensitivity analysis

     did not find any solution he deals with sensitivity analaysis

   Mike: sensitivity in the observed likelihood does not matter, since it can not be estimated. 
   once it can be estimated, it must not be sensitivity paramter.

* 2013-02-25

** TODO different distribution 

   if p(y2|y1, R = 0) is exp(\lambda)p(y2|y1, R= 1), can still get \mu_\tau ?

   Basically it is not an issue, from page 2, no covariates case. But complicated. 

   Still prefer conditional of y2 on y1 and assume x stays the same across time

* 2013-02-18

** TODO work with covariates? even with time varing covariates or coefs?

* 2013-02-17

** TODO is parameter in PT identifiable? like \mu and \sigma

* 2013-01-28

** TODO Identifiability problem for pattern mixture model with copula

** TODO MM + PT/DP ?check reference


* 2012-12-03

** DONE check pattern mixture model in Mike's book

** TODO pattern mixture model with copula with quantile regression

   Specify the model from conditional distribution $y_{ij}|D_i$, where $y_{ij}$ is the j-th
   observation for i-th subject and $D_i$ is the dropout time for i-th subject. Now we suppose there 
   is a pattern for each dropout time. 

   Then following Roy and Daniels 2008, suppose conditional on dropout/pattern, the distribution is 
   exponential family:

   $$L(y_{ij}|D_i; \alpha^{D_i}, \phi) = \exp \left\{ (y_{ij}\eta_{ij} - \psi(\eta_{ij})) / (m_{ij}\phi) + h(y_{ij}, \phi) \right\}$$

   where 

   $$\eta_{ij} = \Delta_{ij} + x_{ij} \alpha^{D_i}$$

   In order to get the marginal quantile regression coefficients, we marginalize dropout/pattern variable $D_i$, and should have
   this:

   \begin{align*}
   \tau &= P(y_{ij} \le x_{ij}\beta)\\
   & = \sum_i P(D_i) P(Y_{ij} \le X_{ij}\beta | D_i) \\
   & = \sum_i P(D_i) Pexpo \left( X_{ij}\beta ; \Delta_{ij}, \alpha^{D_i} \right)
   \end{align*}

   where *Pexpo* is the cdf for exponential family with parameter $(\Delta_{ij}, \alpha^{D_i})$ .
   Because of the above constraints, the \Delta_ij can be deterministic by \beta and $\alpha^{D_i}$. 

   So far, the above is only for patterns / dropout /missingness and quantile regression. Can deal with random effect
   and multivariate correlation using *copula*:

   Now suppose given each dropout time $D_i$, $y_i = (y_{i1}, ..., y_{im})$ are correlation by Copula_\Sigma (normal copula, 
   t copula, any ellipscopula, archimedian copula, etc), in the meantime, keep the above margins (condition on D_i).

   Thus, for likelihood, let $\omega = (\beta, \alpha^{D_i}, \phi)$, 

   $$L(y_i, D_i; \omega) = \prod_i L(y_i|D_i) p(D_i)$$

   where 

   $$f(y_i|D_i) =  Copula(copula=normalcopula, margin = expo(\omega), param=(\beta,\alpha^{D_i}, \phi))$$
   
   and \beta is the marginal quantile regression coefficients. 

** TODO mike's opinion about copula + Reich

   he thinks the model should be 

   $$y_{ij}|D_i = x_{ij}\beta(D_i) + (x_{ij}\gamma)\epsilon_{ij}|D_i$$

   and if put quantile constraint on each $\epsilon_{ij}|D_i$ may be too 
   restrictive. Ultimately we only want marginally $P(y_{ij}< x_{ij}\beta^M) = \tau$.

** TODO fit linear regression with copula 

   $$y = x\beta + \epsilon$$ 

   where \epsilon \sim copula_\Sigma 

*** TODO Simple linear regression with copula with ALD or any margin like Reich

    file:../copula/Copula_SLM.R 

** DONE check out copula quantile Autocorrelation QAR model paper and semiparameteric paper 
   
   2 papers

   - Chen , Fan 2006, time series model, not linear regression model
   - Chen, Koenker, Xiao 2009, quantile autoregression model:
     do not think relavent

* 2012-11-29

** TODO Copula Notes:

   - package: *VGAM* has the laplace distribution, where laplace(location = 0, scale = 1) is double exponential distribution, aka 
     ALD(\sigma = 2, \tau = 0.5)

   - package : *copula*

     - rCopula + Qmargin = rMvdc:

       They are the same. but sometimes sample correlation are different. For a normalCopula(0.5), sample 
       correlation could vary from (0.36 - 0.49)

     - rMvdc: can draw sample from a copula with specified margins

     - computing time for rCopula and rMvdc are almost the same

     - [ ] \epsilon|G, H \sim Copula_\Sigma  can go to ? \epsilon \sim Copula_\Sigma 
       
       may not need this for Reich, since can estimate mle directly

     - [ ] check loglikMvdc with own function 

     - fitMvdc works perfect 

     - functions:

       - fitCopula, fitMvdc

       - rCopula, rMvdc (can specify margin, and copula)

       - ellipCopula Class: normalCopula, tCopula 

       - dfancy, pfancy, qfancy in Mvdc

       - sampling method: 

	 1. draw smaple from Copula $\Phi(\epsilon_{i})$, where \epsilon_i is from multivariate normal say.

	 2. $F_i^{-1}(\Phi(\epsilon_i))$

     - [[file:../copula/ALD.R][ALD.R]] for ALD functions: rALD, qALD, dALD, pALD(sigma, tau)

     - =loglikMvdc= is the same for customized function calculating log likelihood
       put first parameters for margins, and last for copula parameter.

       $$q = \Phi^{-1}(F_i(x_i))$$ 

       $$L = \frac{1}{\sqrt{|\Sigma|}} \exp \left( -\frac{1}{2} q^t\Sigma^{-1}q \right) \exp \left( \frac{1}{2} q^Tq \right) \prod f_i(x_i)$$

     - =fitMvdc= can estimate both marginal parameters and copula parameters together

       sometimes there is error, try to revise the initial value (starting value), may get the mle

       but somehow, =fitMvdc= used =optim= function, which often gives error

** TODO Consider Copula + Mixture model

   If not specified, $y_{ij}$ means subject $i$'s j^{th} treatment, $y_i$ is the response vector
   for subject $i$

   keep Reich's marginal error within each Dropout: 

   $$y_{ij} | D = x_{ij}\beta + D + (x_{ij}\gamma) \epsilon_{ij}$$

   and suppose within each subject, the correlation is introduced by *Copula*
   then since copula does not affect margins, maybe this way can solve random effect 
   by copula and deal with dropout in the same time.
   
*** Possible Solution

    Consider the following model, let $D_i$ denote dropout time for subject $i$ and suppose
    there is only monotone missingness ($D = 1, ..., n_i$), 

    $$y_{ij} | D_i = x_{ij}\beta(D_i) + (x_{ij}\gamma) \epsilon_{ij}$$

    $$\epsilon_{ij} \sim Reich(\tau)$$

    which means $P(\epsilon_{ij} \le 0) = \tau$. Now let $\epsilon_i = (\epsilon_{i1}, ..., \epsilon_{in_i})$ as the random error
    vector for subject $i$, and *suppose it is independent with dropout time D*:

    $$\epsilon_i|D_i = \epsilon_i \sim Copula(copula = normalcopula, Margin = Reich(\tau), param)$$

    So given dropout time $D$, to marginalize over correlation/copula (actually we do not need to do anything,
    since we have already specified the marginal of copula) we have

    $$P(y_{ij} \le X_{ij}\beta(D_i)|D_i) = \tau$$

    Then if marginalizing over dropout $D_i$, we have 

    $$y_{ij} = x_{ij}\left( \sum_i \beta(D_i) p(D_i) \right) + (x_{ij}\gamma) \epsilon_{ij}$$

    Set 

    $$\beta^{(M)} = \sum_i \beta(D_i) p(D_i)$$

    we have marginally 

    $$P(y_{ij} \le x_{ij}\beta^{(M)} ) = \tau$$

    - Likelihood:

      $$(y_i, D_i;\beta, \gamma, \Sigma, \alpha) \propto f(y_i|D_i; \beta, \gamma, \Sigma) p(D_i;\alpha)$$
      $$f(y_i|D_i) \propto \prod_{i=1}^n Copula(copula=normalcopula, margin = Reich(\tau), param=(\beta,\gamma, \Sigma))$$
      $$p(D_i) \propto Multinomial(n_i, Z, \alpha)$$

      $$\hat{\beta}^{(M)} = \sum \hat{\beta}(D_i)\hat{p}(D_i)$$

** TODO copula computation with Reich

** Notes from last report

   1. focus on linear link now
   2. ultimately want to consider random effect and dropout /missingness

* 2012-11-13

** TODO Consider Quantile regression with missing data 

   Let S = {1, 2, 3, ..., T} as the monotone missingness, S = \sum R. Y is a vector. 
   May look at Y from \int Y|S dF(S) prospective as to the marginalized model. 

   Keyword: *missing data, non-ignorable, quantile regression*

   1. Roy and Daniels 2008 (marginalized model)
   2. Reich
   3. PT
   4. Yuan 2010 (missing; non ignorable)
      
     
   Roy and Daniels 2008, proposed the model from condition GLM setting the conditional mean 
   equals \Delta_i + X\alpha . Then in order to have the regression expression X\beta for marginal 
   mean, \Delta_i must be determined through X\beta and X\alpha. Then based on the likelihood 
   from exponential family of conditional mean model, MLE(\beta) can be obtained. 

   Model from 

   $$g(E(Y|b_i)) = \Delta_i + X\alpha$$

   Constraint:

   $$g(E(Y)) = X\beta$$

   Notes:

   1. GLM link in Roy and Daniels: g(E(X|b)) = X\beta ; then g(E(X)) may not equal to \sum X\beta(D)p(D) for nonlinear model.
      In Roy and Daniels, they demostrated the logistic link, but in quantile regression, does generalized link function make sense ?
      Say, if Y is binary, P(Y = 1) = \pi = 1 - P(Y = 0), 

      \begin{equation}
      P(Y \le g^{-1}(X\beta)) = \tau  ?
      \end{equation}

      So far, the only thing I found about /generalized quantile regression/ by Google was to minimize the generalized check function:

      \begin{displaymath}
      \rho_{\tau}(u) = |u|^{\alpha}(\tau - I(u \le 0))
      \end{displaymath}

      where \alpha = 1, 2. 

      One paper I found related is Binary quantile regression with ALD [[https://www.dropbox.com/s/fcmtadprvqcq1eq/benoit-2010.pdf][Benoit, 2010]]. He introduced an latent variable for binary data

      $$P(y_i = 1) = \pi = 1 - P(y_i = 0)$$ 

      $$y_i^{*} = x_i\beta + u_i$$

      $$y_i = 1  \quad \text{if $y_i^{*}>0$ and vice verse.}$$

      where $u_i \sim ALD(\tau)$ , \tau is pre-specified . If u_i is normal distributed, then it is probit model, if u_i is logistic distributed, 
      then it is logistic model. And I did not find how to interpret the quantile regression coefficient. 

   2. [[https://www.dropbox.com/s/irc5lyxmed5l3t2/Geraci-2007.pdf][Geraci-2007]] Quantile Regression with Longitudinal data with Asymmetric Laplace distribution

      $$y_{ij}|u_i = x_{ij}\beta + u_i + \epsilon_{ij}$$

      $$\epsilon_{ij} \sim ALD$$

      $$u_i \sim f(u_i|\phi)$$

      Using Data augementation, it is still a conditional (on random effect) quantile regression. 

*** Possible Solutions 

**** Reich 

     Need to satisfy these two conditions ? 

     $$Q_Y(\tau) = X\beta$$

     $$Q_{Y|b_i}(\tau) = \Delta_{ij} + X_{ij}\alpha$$ 

     In conditional model, we take correlation/longitudinal effect into account. So suppose the model is 

     $$y_{ij}| b_i = X_{ij}\beta + (X_{ij}\gamma) (b_i + \epsilon_{ij})$$

     where $b_i \sim N(0, \sigma^2)$, 

     $$f(\epsilon_{ij}) = \sum p_k h_k (\epsilon_{ij})$$

     $$h_k(t) = q_{k1} \phi(t, \mu_{k1}, \sigma_{k1}) + (1 - q_{k2}) \phi(t, \mu_{k2}, \sigma_{k2})$$

     In order to have the marginal \tau th quantile 0, the marignalized error $\epsilon^{*} = b_i + \epsilon_{ij}$ is 
     restricted at $q_{k1}$ where 

     $$q_{k1} = \frac{\tau - \Phi \left( - \frac{\mu_{2k}}{\sqrt{\sigma_i^2 + \sigma_{k2}^2}} \right)}{\Phi \left( - \frac{\mu_{k1}}{\sqrt{\sigma_{k1}^2 + \sigma_i^2}} \right) - \Phi \left( - \frac{\mu_{k2}}{\sqrt{\sigma_{k2}^2 + \sigma_i^2}} \right)}$$

     Then condition (1) is satisfied. Let $\Delta_{ij}$ be the solution for 

     $$F_{\epsilon_{ij}^{* }}(\Delta_{ij}/X_{ij}\gamma) = P(\epsilon_{ij}^{* } \le \Delta_{ij}/ X_{ij}\gamma ) = \tau$$

     and $\alpha = \beta + b_i \gamma$, then condition (2) is satisfied: 

     $$P(y_{ij} \le \Delta_{ij} + X_{ij}\alpha |b_i) = P((X_{ij}\gamma)\epsilon_{ij} \le \Delta_{ij}) = \tau$$

     The $\Delta_{ij}$ can be determined through $F_{\epsilon_{ij}^{*}}$, since 

     $$F_{\epsilon_{ij}^{*}}(t) = \sum p_k \left[ q_k \Phi(t, \mu_{k1}, \sigma_{k1}) + (1 - q_k) \Phi (t, \mu_{k2}, \sigma_{k2}) \right]$$

     since it is monotone and not hard to get unique zero point for t. 

     The thing is that in this way, model is specified through marginal directly in some way. No need to consider the conditional (in 
     terms of random effect) quantile regression. 

     Also the correlation is only compound symmetric. not even for negative correlation.

**** May consider this model for multivariate quantile regression: Copula + Reich/ALD

     This may not address the *missingness* problem. 

     For \tau th quantile regression, setting the marginal model:

     $$y_{ij} = X_{ij}\beta(\tau) + (X_{ij}\gamma) \epsilon_{ij}$$

     where 

     $$\epsilon \sim ALD(\tau, \sigma)$$

     or 

     $$\epsilon \sim Reich(\tau)$$

     In order to address correlation within group, consider within each subject, the correlation is introduced by copula

     Currently, there are three papers which have keywords  =copula= and =quantile regression= :
     
     1. Chen and Fan (2006): Estimation of copula-based semiparametric time series models
     2. Bouye and Salmon (2009): Dynamic copula quantile regressions and tail area dynamic dependence in Forex markets,
	nonlinear quantile regression model implied by their copula specification 
	too expensive to get ? 
     3. Chen, Koenker, Xiao (2009) : copula-based nonlinear quantile autoregression: based on Bouye and Salmon; review previous two papers
     4. Song 2000: multivariate dispersion models generated from gaussian copula. 

     Also I forgot why and how we gave up the copula idea previously. But try to address new method now

***** Review Copula
      
      By Sklar Theorem, for arbitrary multivariate distribution F, with univariate marginal cdf F_1, ..., F_d,
      (pdf: f_1, ..., f_d), there exists a copula C such that : 

      $$F(y_1, \ldots, y_d) = C(F_1(y_1), \ldots, F_d(y_d))$$

f      If continuous, the multivariate pdf is 

      $$f(y_1, \ldots, y_d) = c(F_1(y_1), \ldots, F_d(y_d))f_{1}(y_1)\cdots f_d(y_d)$$

      where c(u_1, ..., u_d) is the copula density. 

      $$c(u_1, \ldots, u_d) = \frac{\partial^d}{\partial u_1 \cdots \partial u_d} C(u_1, \ldots, u_d)$$

      - Gaussian Copula $C_{\Sigma}$:

	\Phi_\Sigma is the cdf for multivariate normal, \Phi is the cdf of standard normal, \phi is the pdf for standard normal

	$$C(u_1, \ldots, u_d) = \Phi_{\Sigma}(\Phi^{-1}(u_1), \ldots, \Phi^{-1}(u_d))$$

	\begin{align*}
	c(u_1, \ldots, u_d) & =  \phi_{\Sigma}(\Phi^{-1}(u_1), \ldots, \Phi^{-1}(u_d)) \frac{1}{\phi(q_1)} \cdots \frac{1}{\phi(q_d)}\\
	& = \frac{1}{\sqrt{|\Sigma|}} \exp \left( - \frac{1}{2}q^t \Sigma^{-1} q \right) \exp (\frac{1}{2} q^t q)
	\end{align*}

	where $q_i = \Phi^{-1}(u_i)$. 

	- Example

	  Say if a random vector Y follows a Gaussian copula $C_{\Sigma}$ and we want to keep its marginal distribution
	  as standard normal. So $f_i = N(0,1) = \phi$, $F_i = \Phi$, and $u_i = \Phi(y_i)$, $q_i = \Phi^{-1}(\Phi(y_i)) = y_i$
	  then the joint density of random vector Y is :

	  $$f(y_1, \ldots, y_d) = \phi_{\Sigma}(y_1, \ldots, y_d)$$

	  which is exactly the multivariate normal distribution with \Sigma as correlation matrix.

***** Gaussian Copula + Reich + Bivariate 

      Now let us consider an approach combining Reich's method and copula idea to deal with *Bivariate Quantile Regression*:

      Say we have the following marginal model : for \tau th quantile regression, setting the marginal model:

      $$y_{ij} = X_{ij}\beta(\tau) + (X_{ij}\gamma) \epsilon_{ij}$$

      where 

      $$\epsilon_{ij} \sim Reich(\tau) \doteq \sum_1^{\infty} p_k h_k(\epsilon_{ij})$$

      and 

      $$h_k(t) = q_k \phi(t, \mu_{k1}, \sigma_{k1}) + (1 - q_k) \phi(t, \mu_{k2}, \sigma_{k2})$$

      where $q_k$ is determined to make density $h_k$ has \tau quantile *0*. Can also show the marginal cdf is 

      $$F_{ij}(t) = \sum_1^{\infty} p_k \left( q_k \Phi(t, \mu_{k1}, \sigma_{k1}) + (1-q_k) \Phi(t, \mu_{k2}, \sigma_{k2})\right)$$

      and the marginal pdf is 

      $$f_{ij}(t) = \sum_1^{\infty} p_k \left( q_k \phi(t, \mu_{k1}, \sigma_{k1}) + (1-q_k) \phi(t, \mu_{k2}, \sigma_{k2})\right)$$

      Then in order to take correlation into account as well as keep the marginal desired quantile relationship, consider each subject random vector $(\epsilon_{i1}, \epsilon_{i2})$ follows 
      a Gaussian copula $C_{\Sigma}$ with copula parameter \Sigma or \rho if we set the $\Sigma = [1, \rho, \rho, 1]$. 

      The joint pdf can be obtained by :

      $$f(\epsilon_{i1}, \epsilon_{i2}) = c_{\Sigma}(F_{i1}(\epsilon_{i1}), F_{i2}(\epsilon_{i2}))f_{i1}(\epsilon_{i1})f_{i2}(\epsilon_{i2})$$
      
      where 

      $$c_{\Sigma}(F_{i1}(\epsilon_{i1}), F_{i2}(\epsilon_{i2})) = \frac{1}{\sqrt{|\Sigma|}} \exp \left( -  \frac{1}{2} s^t \Sigma^{-1}s  \right) \exp \left( -\frac{1}{2} s^t s \right)$$

      and $s_j = \Phi^{-1}(F_{ij}(\epsilon_{ij})), j = 1, 2$, thus likelihood would be 

      $$L(\beta, \gamma, \Sigma|Y) \propto \prod_i f(y|\beta, \gamma, \Sigma) \pi(\beta)\pi(\gamma)\pi(\Sigma)$$

      #+begin_example
      Other approaches can be generalized as well, say copula + ALD, even copula + PT .
      #+end_example

***** TODO is there a better way to sample copula + reich ?

*** Questions

    1. b_i or S (monotone missingness) or Dropout time

       in Ying : 

       $$y_{ij} | b_i  \quad\text{indep}\quad s_{ij}|b_i$$ 

       share same random effect

       in Roy and Daniels,

       $$E(Y) = \sum P(S) \int E(Y|S, b)f(b|S)db$$

       or more precisely:

       $$E(Y) = \sum \sum P(S|D)P(D) \int E(Y|S, b)f(b|S)db$$ 

       where S is latent class, D is dropout time. 

       In my understanding, you want to take $S$ (missingness/monotone missingness) into 
       account as well as random effects $b$, right? And in the same time, we have to 
       be able to extract the marginal quantile regression coefficients \beta ?

       And you think it might be easier to set the likelihood equation through conditional model
       while still keeping \beta in the likelihood by marginalized model constraints ? Say something like

       $$E(Y) = \sum P(S) \int E(Y|S, b)f(b|S)db$$

       but with equations in terms of quantiles ?

    2. In Yuan 2010, she is still fitting the conditional (on random effect) quantile regression ? (Present the paper)
       although in likelihood, she integrated the random effect. 
      

** TODO for DP, in order to estimate F_\epsilon 

   1. check Ishwaran and Roberts(Rao) 2001 JASA paper (trunked DP?) 
      actually it is Ishwaren and James (2001) : Gibbs sampling methods for stick-breaking priors ?
      
      maybe after fixing M, and sampling \mu, \sigma, and p, the cdf can be determined by  ? 

      $$F(t) = \sum_i^M p_i \Phi_i(t, \mu_i, \sigma_i)$$ 

** TODO consider beating Reich from 

   1. quantile for Y_2 - Y_1
   2. consider model 
      
      \begin{align*}
      Y_1 & = \beta_0 + \beta_1 X_1 + \epsilon_1 \\
      Y_2 & = \beta_0 + \beta_1 X_2 + \epsilon_2
      \end{align*}

      where (Y_1, Y_2) share the same coefficients. And 
   
      \begin{displaymath}
      (x_1, x_2) \sim Bivariate Normal
      \end{displaymath}

** TODO consider estimates where xi^* = x_i - xibar

* 2012-11-01

  [[file:20121101.org]]

** DONE [#A] check out sample size stuff in univariate case , and choice of M, check out PTdensity 

*** DONE check predictive density with fortran function , with n, with M; file:myPTdensity.R file:myptdensity.f file:myptdensity2.f file:PTLL.R 

    - PTLL.R : get PT log like
    - myPTdensity : get density function 

      e \sim 5 + 1/2N(-2, 1) + 1/2 N(2, 1) , mixing and acf 

      [[file:image/u3-mixing.png]]

      [[file:image/u3-500.png]]

**** DONE with mu as intercept :  =myptdensity1= 

     be careful about f(x) = PTLL(x, \mu, y, ...)  and PTLL(x - \mu, 0, v, ...)

**** DONE with mu as baseline measure parameter =myptdensity2=

     [[file:image/den-test.png]] 

*** DONE M compare

    - n = 100, e \sim 1/2 N(-2, 1) + 1/2 N(2,1) , 20k + 10k * 20, 
      
      [[file:image/den-test3.png]]
      
    - n = 500, e \sim 1/2 N(-2,1) + 1/2 N(2,1), 20k + 10k * 20, 

      [[file:image/den-test4.png]]


** DONE check out =gridupptprior= function in multivaraite case with =mdzero= 

   commented =mdzero.ne.0= to make first level prob 1/2 and 1/2, for density estimation 

   - [X] file:heterptlmm.f 
   - [X] file:heterptlmtri.f 

** DONE check out postquantile in univariate and multivariate case

   no =mdzero= in this function 

** TODO Bivaraite consider not updating \rho and Ortho , mixing problem of \rho and Ortho

   for b3, error from Jara's demo, mixing is much better, but acf is not satisfying. 

   also iterations are increased: 20k + 20k * 20

   file:image/b3-comp-no-rho-ortho.pdf 

*** TODO without updating \rho and Ortho, simulation on bivariate cases comparing Reich and PT :simulation:

    MAY compare with file:simulation-multivariate3.R 

**** HOMO
      
    \begin{align}
    y & = x\beta + \epsilon \\
    \beta & =  
    \begin{pmatrix}
    1 & 1 \\
    2 & 1 \\
    3 & 1 
    \end{pmatrix}
    \end{align}

***** \epsilon \sim N(0, 1), standard normal file:sim-b1.R [[file:sim-b1.out][output]] [[file:b1.RData][result]]

      #+CAPTION: MSE	 
      |     |     BQR |         |         |      PT |         |         |
      |     | \beta_0 | \beta_1 | \beta_2 | \beta_0 | \beta_1 | \beta_2 |
      |   / |       < |         |       > |       < |         |       > |
      | 1.5 |   1.320 |   0.967 |   0.999 |   1.364 |   1.155 |   1.197 |
      | 1.9 |   2.806 |   2.057 |   2.051 |   2.233 |   2.218 |   2.198 |
      | 2.5 |   1.054 |   1.092 |   0.946 |   1.178 |   1.216 |   1.002 |
      | 2.9 |   1.939 |   1.462 |   1.816 |   2.333 |   1.464 |   1.617 |

***** \epsilon \sim N((0, 0), (1, 0.5, 0.5, 1), file:sim-b2.R [[file:sim-b2.out][output]] [[file:b2.RData][result]]

      #+CAPTION: MSE
      |     |     BQR |         |         |      PT |         |         |
      |     | \beta_0 | \beta_1 | \beta_2 | \beta_0 | \beta_1 | \beta_2 |
      |   / |       < |         |       > |       < |         |       > |
      | 1.5 |   0.996 |   1.255 |   1.272 |   1.409 |   1.419 |   1.533 |
      | 1.9 |   2.178 |   2.415 |   2.442 |   2.746 |   2.803 |   2.735 |
      | 2.5 |   1.105 |   1.342 |   0.992 |   1.653 |   1.353 |   1.099 |
      | 2.9 |   1.987 |   1.865 |   2.010 |   2.974 |   1.753 |   2.148 |

****** \epsilon \sim N((0, 0), (1, -0.5, -0.5, 1)), file:sim-b3.R [[file:sim-b3.out][output]] [[file:b3.RData][result]]

       #+CAPTION: NO \rho No \Sigma
       |     |     BQR |         |         |      PT |         |         |
       |     | \beta_0 | \beta_1 | \beta_2 | \beta_0 | \beta_1 | \beta_2 |
       |   / |       < |         |       > |       < |         |       > |
       | 1.5 |   1.144 |   1.217 |   1.366 |   1.794 |   1.389 |   1.626 |
       | 1.9 |   2.101 |   2.097 |   2.874 |   2.113 |   2.005 |   2.698 |
       | 2.5 |   1.164 |   1.086 |   1.245 |   1.806 |   1.416 |   1.440 |
       | 2.9 |   1.918 |   2.239 |   2.075 |   1.990 |   2.511 |   2.005 |
       |-----+---------+---------+---------+---------+---------+---------|
       |     |    with |    \rho |     and |  \Sigma |         |         |
       | 1.5 |    1.13 |    0.95 |    1.08 |    1.09 |    1.09 |    1.08 |
       | 1.9 |    2.58 |    2.29 |    2.62 |    2.96 |    2.12 |    2.18 |
       | 2.5 |    1.24 |    0.86 |    0.88 |    1.05 |    0.97 |    0.99 |
       | 2.9 |    2.47 |    1.44 |    1.69 |    3.71 |    1.43 |    1.51 |

***** \epsilon \sim N((0, 0), (1, 1, 1, 4)), file:sim-b4.R [[file:sim-b4.out][output]] [[file:b4.RData][result]]

      |     | BQR     |         |         | PT       |         |         |
      |     | \beta_0 | \beta_1 | \beta_2 | \beta_0  | \beta_1 | \beta_2 |
      |   / | <       |         |       > | <        |         |       > |
      | 1.5 | 1.165   |   1.194 |   1.148 | 1.561    |   1.111 |   1.321 |
      | 1.9 | 56.900  |   6.694 |   6.616 | 2.338    |   1.975 |   2.398 |
      | 2.5 | 4.851   |   4.079 |   5.162 | 6.396    |   3.399 |   5.302 |
      | 2.9 | 50.716* |   6.396 |   7.642 | 159.212* |   6.523 |   9.048 |

      wrong mse for 2.9 \beta_0

***** \epsilon \sim N((0, 0), (1, -1, -1, 4)), file:sim-b5.R [[file:sim-b5.out][output]] [[file:b5.RData][result]]

      #+CAPTION: NO \rho No \Sigma
      |     |     BQR |         |         |       PT |         |         |
      |     | \beta_0 | \beta_1 | \beta_2 |  \beta_0 | \beta_1 | \beta_2 |
      |   / |       < |         |       > |        < |         |       > |
      | 1.5 |   1.203 |   1.218 |   1.145 |    1.478 |   1.477 |   1.238 |
      | 1.9 |  68.040 |   9.844 |   6.786 |    2.169 |   2.549 |   1.988 |
      | 2.5 |   7.182 |   5.049 |   3.384 |    7.894 |   5.262 |   3.728 |
      | 2.9 | 60.217* |   7.737 |   5.280 | 168.977* |   8.779 |   7.408 |

      wrong mse for 2.9 \beta_0 too.

      |     |    with |    \rho |     and |   \Sigma |         |         |
      |-----+---------+---------+---------+----------+---------+---------|
      | 1.5 |    1.10 |    1.28 |    1.51 |     0.96 |    1.22 |    1.32 |
      | 1.9 |   73.99 |    9.51 |    8.53 |     4.59 |    2.40 |    2.42 |
      | 2.5 |    4.70 |    7.34 |    4.86 |     4.17 |    6.47 |    4.21 |
      | 2.9 |   30.95 |   10.60 |    6.75 |    12.64 |   10.87 |    7.34 |

***** error in Jara 2009, show here, file:sim-b6.R [[file:sim-b6.out][output]] [[file:b6.RData][result]]

      \begin{displaymath}
      \epsilon \sim 0.5 \times N_2 \left\{ 
      \begin{pmatrix}
      -1.35 \\
      0.28
      \end{pmatrix}, 
      \begin{pmatrix}
      0.15 & 0.02 \\
      0.02 & 0.04 
      \end{pmatrix}  \right\}      + 0.5 \times N_2 \left\{
      \begin{pmatrix}
      1.35 \\
      0.28 
      \end{pmatrix}, 
      \begin{pmatrix}
      0.15 & 0.02 \\
      0.02 & 0.04 
      \end{pmatrix} \right\}
      \end{displaymath}

      |     |     BQR |         |         |      PT |         |         |
      |     | \beta_0 | \beta_1 | \beta_2 | \beta_0 | \beta_1 | \beta_2 |
      |   / |       < |         |       > |       < |         |       > |
      | 1.5 | 140.701 |  2.6839 |  2.6593 |   3.073 |  0.2668 |  0.3099 |
      | 1.9 |  39.530 |  0.7377 |  0.4900 |   0.623 |  0.6382 |  0.6907 |
      | 2.5 |   9.414 |  0.0927 |  0.1049 |   7.908 |  0.0854 |  0.0824 |
      | 2.9 | 217.297 |  3.9826 |  4.3024 |   0.109 |  0.1869 |  0.1572 |

      wrong code for 2nd component median

      |     |    with |    \rho |     and |  \Sigma |         |         |
      |-----+---------+---------+---------+---------+---------+---------|
      | 1.5 | 149.054 |   0.535 |   0.624 |   3.608 |   0.314 |   0.289 |
      | 1.9 |  27.477 |   0.422 |   0.457 |   3.879 |   0.509 |   0.685 |
      | 2.5 |   1.252 |   0.055 |   0.064 |   0.071 |   0.069 |   0.065 |
      | 2.9 | 227.508 |   3.116 |   4.249 |   0.114 |   0.122 |   0.114 |

      The intercept mse in all b[4-6] are not correct but other \beta_1 and \beta_2 mse are right. 

**** HETER (1, -0.5, 0.5)

** TODO [#A] fix bivariate and trivariate mixing and try to beat Reich

*** DONE file:myPTdensityBi.R check mixing for \mu_1, \mu_2, \Sigma, \alpha and Ortho


*** TODO file:myPTdensityTri.R 


** TODO try winbugs, openbugs, jags, brugs, stan, parallel desktop. Maybe they have better mixing than mine

   one reason considering *BUGS* is that they might have better interface for monitoring and adapting, even much better mixing.

   no way to call R function or fortran/c function to calculate the likelihood. (*bugs*)

   but may consider *DP* for the error, thus latent variable can be used in *BUGS*. (got help from Xuan). 

** TODO [#C] summarize cases when Reich is not good as PT 

* 2012-10-27

** DONE read *Handbook of MCMC* 

   [[http://liuminzhao.com/2012/10/28/notes-for-handbook-of-mcmc/][Notes]]
** DONE modify file:heterptlm.f file:HeterPTlmMean.R univariate case 

   =git branch tuning=

   1) [X] =if (logr ge 0 || unif < exp(logr))= 
   2) [X] check tune every 50
      - ratesave (HeterPTlmMean.R)
      - tunesave
      - ratecount
   3) [ ] \delta(n) = min(0.01, 1/ $\sqrt{n}$ )
   4) [X] arate = 0.44 (outside function)
      arate = 0.25 is much more satisfying than arate = 0.44 in terms of mixing of \beta_0 and acf, see file:image/testu3.pdf compare with file:image/x2u3.pdf
      except sigma2 is not good on acf. may try another variance mixing ? 

   5) [X] place =acf= in plot.HeterPTlm file:HeterPTlmMean.R 

*** TODO if mixing better than previous, do simulation-parallel (univariate) again (4 sets)? 

*** TODO consider a new error can screw up Reich's method? 

*** DONE [#A] \epsilon \sim 1/2 N(-2,1) + 1/2 N(2,1) with quantile (0.25, 0.5, 0.75) ? file:sim-u3-ho-100.R no spike and slab; on mike
    
    [[u3-ho-100-q3.RData][data]] [[sim-u3-ho-100.out][output]] time: 2h for 100 bootstrap, 100 obs

   
    #+attr_html: style="float:left;width:20%;margin:3ex"
    |     |  25% |      |      |   50% |       |       |  75% |      |      |
    |-----+------+------+------+-------+-------+-------+------+------+------|
    | /   |    < |      |    > |     < |       |     > |    < |      |    > |
    |     |  Int |   x1 |   x2 |   Int |    x1 |    x2 |  Int |   x1 |   x2 |
    | RQ  | 6.19 | 6.64 | 5.66 | 30.12 | 25.23 | 23.64 | 4.37 | 4.64 | 6.56 |
    | BQR | 4.97 | 2.88 | 2.48 | 15.12 |  4.91 |  4.48 | 4.15 | 3.59 | 2.89 |
    | PT  | 4.93 | 3.02 | 3.00 |  6.91 |  2.38 |  2.14 | 3.66 | 3.84 | 3.04 |

    #+attr_html: style="float:left;width:20%;margin:3ex"	
    [[file:image/e3-density.png]]
    #+html: <br style="clear:both;" />
    
    When \tau=0.5, PT dominates. When 25% and 75%, PT is best in terms of intercept, but lose to Reich. However, comparing to rq function, PT is better in all case.

*** DONE [#A] \epsilon_4 \sim 1/4 N(-4,2) + 1/2 N(0,2) + 1/4 N(4,2) with quantile (0.125, 0.5, 0.875) ; file:sim-u4-ho-100.R no spike and slab; on mike

    [[u4-ho-100-q3.RData][data]] [[sim-u4-ho-100.out][output]] time: 2h for 100 bootstrap, 100 obs


    #+attr_html: style="float:left;width:10;margin:3ex"
    |     | 12.5% |      |      |  50% |      |      | 87.5% |      |      |
    |-----+-------+------+------+------+------+------+-------+------+------|
    | /   |     < |      |    > |    < |      |    > |     < |      |    > |
    |     |   Int |   x1 |   x2 |  Int |   x1 |   x2 |   Int |   x1 |   x2 |
    | RQ  |  38.2 | 43.4 | 33.1 |  9.9 | 14.1 | 12.5 |  28.8 | 37.8 | 37.9 |
    | BQR |  29.2 | 18.3 | 19.8 | 10.2 | 13.0 | 11.4 |  22.7 | 28.5 | 22.9 |
    | PT  |  28.4 | 18.9 | 17.2 |  9.4 | 15.5 | 12.4 |  24.6 | 27.4 | 23.2 |
    #+attr_html: style="float:left;width:20%;margin:3ex"	
    [[file:image/e4-density.png]]
    #+html: <br style="clear:both;" />
       
    no better than BQR, but in most of cases , especially lower and upper quantile, much better than rq. 

** DONE when n=500, mixing is much worse than n=100 , maybe because of the default M = log_2(n), trying setting M=6 for e3 with n=500, compare with file:image/testu3-500.pdf file:image/testu3-2.pdf file:image/x2u3.pdf

   well, when setting M=6 and mixing is no better than M=8, neither is estimates. file:image/testu3-500-m6.pdf

** DONE modify bivariate case , check the mixing and acf to see it works

   =git branch tuning=

   1) [X] =if (logr .ge. 0 .or. unif < exp(logr))= 
   2) [X] check tune every 50
      - ratesave (HeterPTlmMean.R)
      - tunesave
      - ratecount
   3) [ ] \delta(n) = min(0.01, 1/ $\sqrt{n}$ )
   4) [ ] arate = 0.44 (outside function)
      arate = 0.25 is much more satisfying than arate = 0.44 in terms of mixing of \beta_0 and acf, see file:image/testu3.pdf compare with file:image/x2u3.pdf
      except sigma2 is not good on acf. may try another variance mixing ? 

   5) [X] place =acf= in plot.HeterPTlm file:HeterPTlmm.R 

   6) [ ] update \beta and \gamma componentwisely
      - att[1-2], acc[1-2], tune[1-2] 
       
	\beta is fine. but when update \gamma componentwisely, there is error (no idea so far) 

   7) time: previous vectorize 357s; after: 509s for \beta vectorize 

   8) add =tunesave= and =ratesave= to check tuning progress 
     
      while Ortho keeps high acceptance rate, even after increasing variance of the proposal distribution

   9) [ ] check Jara =PTlmm.R= function to see its aratep for Ortho. 

   10) Mixing is no better than before after updating \beta componentwisely. check file:image/b1-bcomp.pdf file:image/b3-bcomp.pdf file:image/b3-bcomp.pdf compared with file:image/x2b1.pdf file:image/x2b2.pdf file:image/x2b3.pdf 

** TODO modify trivariate case

   =git branch tuning=

   1) [X] =if (logr .ge. 0 .or. unif < exp(logr))= 
   2) [X] check tune every 50
      - ratesave (HeterPTlmMean.R)
      - tunesave
      - ratecount
   3) [ ] \delta(n) = min(0.01, 1/ $\sqrt{n}$ )
   4) [X] arate = 0.44 (outside function)
      arate = 0.25 is much more satisfying than arate = 0.44 in terms of mixing of \beta_0 and acf, see file:image/testu3.pdf compare with file:image/x2u3.pdf
      except sigma2 is not good on acf. may try another variance mixing ? 

   5) [ ] place =acf= in plot.HeterPTlm file:HeterPTlmtri.R 

   6) [ ] update \beta and \gamma componentwisely
      - att[1-2], acc[1-2], tune[1-2]
       
	\beta is fine. but when update \gamma componentwisely, there is error (no idea so far) 

   7) [ ] add =tunesave= and =ratesave= to check tuning progress 
     
      while Ortho keeps high acceptance rate, even after increasing variance of the proposal distribution

   8) [ ] check Jara =PTlmm.R= function to see its aratep for Ortho. 

   9) Mixing is no better than before after updating \beta componentwisely. check

** TODO [#B] update \Sigma together in bi/tri case , like inverse Wishart?
** TODO ask about project
** TODO add more reference from Walker 1997 in file:../qr-draft/qr-draft.tex

  - [ ] Metropolis-Hastings within Gibbs
    1. Metropolis et al 1953
    2. Hastings, 1970
    3. Tierney 1994

  - [ ] 'In many applications, it is the posterior predictive distribution for the next observation that is of interest.'
  - [ ] predictive, prediction purpose
  - [ ] \beta prior $\beta \sim N(0, V)$ where $V$ is a large cov matrix
  - [ ] random walk 


* 2012-10-22

** DONE [#A] re-run simulation in univariate case with *x2~N(0,1)* , and update [[../qr-draft/qr-draft.tex][qr-draft]] , using *spike and slab* prior also. $n=200$
   
   $X=[1, x_1, x_2]$, x_1 and x_2 are both from N(0,1)

   n = 200
   
   evaluate at each component error $(\hat{\beta} - \beta)^2 *100$

*** DONE M1, homo $\epsilon \sim N(0,1)$ 

    file:simulation-parallel-m1.R

    file:uni-m1.RData

    |     |         50% |       |       |         90% |       |       |
    |-----+-------------+-------+-------+-------------+-------+-------|
    | /   |           < |       |     > |           < |       |     > |
    |     | (Intercept) |    x1 |    x2 | (Intercept) |    x1 |    x2 |
    | RQ  |       0.613 | 0.584 | 0.699 |       1.311 | 1.446 | 1.635 |
    | BQR |       0.449 | 0.415 | 0.564 |       0.974 | 0.876 | 1.125 |
    | PT  |       0.494 | 0.531 | 0.679 |       0.871 | 0.727 | 0.980 |

*** DONE M2, homo $\epsilon \sim 1/2 N(-2,1) + 1/2 N(2,1)$

    file:simulation-parallel-m2.R

    file:uni-m2.RData

    |     |         50% |        |        |         90% |       |       |
    |-----+-------------+--------+--------+-------------+-------+-------|
    | /   |           < |        |      > |           < |       |     > |
    |     | (Intercept) |     x1 |     x2 | (Intercept) |    x1 |    x2 |
    | RQ  |      21.206 | 13.097 | 13.644 |       2.200 | 2.071 | 2.419 |
    | BQR |      10.879 |  1.410 |  1.858 |       1.845 | 1.361 | 1.659 |
    | PT  |       5.300 |  0.953 |  1.018 |       1.763 | 1.600 | 1.900 |

*** DONE M3, heter (1, -0.2, 0.2), $\epsilon \sim N(0,1)$

    file:simulation-parallel-m3.R 

    file:uni-m3.RData

    |     |         50% |       |       |         90% |       |       |
    |-----+-------------+-------+-------+-------------+-------+-------|
    | /   |           < |       |     > |           < |       |     > |
    |     | (Intercept) |    x1 |    x2 | (Intercept) |    x1 |    x2 |
    | RQ  |       0.787 | 0.636 | 0.904 |       1.536 | 1.413 | 1.070 |
    | BQR |       0.573 | 0.346 | 0.475 |       0.966 | 0.676 | 0.612 |
    | PT  |       0.629 | 0.403 | 0.515 |       0.969 | 0.948 | 0.796 |


*** DONE M4, heter (1, -0.2, 0.2), $\epsilon \sim 1/2 N(-2,1) + 1/2 N(2,1)$

    file:simulation-parallel-m4.R

    file:uni-m4.RData

    |     |         50% |       |       |         90% |      |      |
    |-----+-------------+-------+-------+-------------+------+------|
    | /   |           < |       |     > |           < |      |    > |
    |     | (Intercept) |    x1 |    x2 | (Intercept) |   x1 |   x2 |
    | RQ  |       25.21 | 11.53 | 12.20 |        2.87 | 1.86 | 2.35 |
    | BQR |        9.04 |  1.36 |  1.48 |        2.11 | 1.23 | 1.36 |
    | PT  |        5.36 |  1.06 |  1.15 |        2.33 | 2.19 | 2.24 |
** DONE file list

   - agenda.org : diary
   - HeterPTlm.R : univariate, posterior mean
   - HeterPTlmMean-ss.R : save above, but with spike-slab prior
   - HeterPTlmm.R : bivariate 
   - HeterPTlmtri.R : tri-variate case
   - Reich: 
     - BQRiid.R
     - BQRmarg.R: bivariate
     - BQRmargtri.R: tri-variate
   - Bootsummary:
     - RQboot.R
     - BQRboot.R

** DONE change covariates matrix to independent x_1 and x_2

*** DONE Model (RE1) random effect 1
   \begin{displaymath}
   B =    
   \begin{bmatrix}
   1 & 1 & 1 \\
   2 & 1 & 0 \\
   3 & 1 & 0 
   \end{bmatrix} 
   \quad 
   \Sigma = 
   \begin{bmatrix}
   1 & 0.6 & 0.1 \\
   & 1 & 0.3 \\
   & & 1 
   \end{bmatrix}
   \end{displaymath}

   by \epsilon = (N(0,0.3) + N(0,0.6) + N(0,0.1)) and 
   \epsilon=(N(0,0.3) + a_{12} + a_{13}, a_{23} + a_{12} + N(0,0.1), a_{23} + N(0,0.6) + a_{13})

   still on mackerel , [[tri-mre1-x2.RData][result]]

   |   | Mean   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint | Median |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |---+--------+-------+-------+---------+--------+---------------+--------------+--------+-------+-------+---------+--------+---------------+--------------|
   | / | <      |       |       |         |        |               |            > | <      |       |       |         |        |               |            > |
   |   | 1.5_b0 | 1.072 |  1.35 |   1.152 |   1.43 |          1.19 |         1.46 | 1.5_b0 | 0.453 | 0.742 |   0.573 |  0.750 |         0.940 |        1.076 |
   |   | 1.5_b1 | 1.181 |  1.61 |         |        |               |              | 1.5_b1 | 0.458 | 0.701 |         |        |               |              |
   |   | 1.5_b2 | 1.201 |  1.32 |         |        |               |              | 1.5_b2 | 0.582 | 0.679 |         |        |               |              |
   |   | 1.9_b0 | 1.548 |  2.83 |   1.990 |   2.66 |          2.21 |         2.58 | 1.9_b0 | 0.552 | 1.307 |   0.762 |  1.097 |         1.391 |        1.656 |
   |   | 1.9_b1 | 1.980 |  2.73 |         |        |               |              | 1.9_b1 | 0.797 | 0.787 |         |        |               |              |
   |   | 1.9_b2 | 2.442 |  2.42 |         |        |               |              | 1.9_b2 | 1.370 | 1.005 |         |        |               |              |
   |   | 2.5_b0 | 0.788 |  1.11 |   0.998 |   1.13 |          1.10 |         1.14 | 2.5_b0 | 0.430 | 0.515 |   0.538 |  0.548 |         0.686 |        0.751 |
   |   | 2.5_b1 | 1.110 |  1.26 |         |        |               |              | 2.5_b1 | 0.594 | 0.711 |         |        |               |              |
   |   | 2.5_b2 | 1.097 |  1.03 |         |        |               |              | 2.5_b2 | 0.484 | 0.520 |         |        |               |              |
   |   | 2.9_b0 | 1.200 | 14.15 |   1.671 |   6.08 |          1.91 |         2.04 | 2.9_b0 | 0.416 | 1.492 |   0.857 |  0.863 |         1.183 |        1.327 |
   |   | 2.9_b1 | 1.867 |  2.26 |         |        |               |              | 2.9_b1 | 0.731 | 0.779 |         |        |               |              |
   |   | 2.9_b2 | 1.946 |  1.82 |         |        |               |              | 2.9_b2 | 0.953 | 0.744 |         |        |               |              |
   |   | 3.5_b0 | 1.252 |  1.55 |   1.158 |   1.31 |          1.11 |         1.20 | 3.5_b0 | 0.580 | 0.793 |   0.690 |  0.624 |         0.839 |        0.882 |
   |   | 3.5_b1 | 1.051 |  1.18 |         |        |               |              | 3.5_b1 | 0.562 | 0.461 |         |        |               |              |
   |   | 3.5_b2 | 1.171 |  1.21 |         |        |               |              | 3.5_b2 | 0.762 | 0.683 |         |        |               |              |
   |   | 3.9_b0 | 2.166 |  4.52 |   2.172 |   3.14 |          2.17 |         2.45 | 3.9_b0 | 1.013 | 1.811 |   0.842 |  1.302 |         1.381 |        1.688 |
   |   | 3.9_b1 | 2.021 |  2.39 |         |        |               |              | 3.9_b1 | 0.843 | 1.138 |         |        |               |              |
   |   | 3.9_b2 | 2.328 |  2.51 |         |        |               |              | 3.9_b2 | 0.894 | 1.444 |         |        |               |              |
   
*** DONE Model (RE3) random effect 3

    $\epsilon_{ij}$ and $a_i \sim 1/2 N(-2,1) + 1/2 N(2,1)$, can show marginally $\epsilon_{ij} \sim 1/4 N(-4,2) + 1/4 N(4,2) + 1/2 N(0,2)$
    where $q5 = 0$ and $q9 = 4.37$. variance is 10 and  correlation among subject is 0.5
    
    The correlation matrix is 
    
    \begin{displaymath}
    \begin{bmatrix}
    1 & 0.5 & 0.5 \\
    0.5 & 1 & 0.5 \\
    0.5 & 0.5 & 1
    \end{bmatrix}
    \end{displaymath}
    
    marginally the pdf is 
    
    \begin{equation}
    1/4 N(-4,2) + 1/4 N(4,2) + 1/2 N(0,2)
    \end{equation}
    
    run on biosci, file:simulation-tri-re3.R 
    
    MSE table [[tri-mre3-x2.RData][result]]  

    |   | Mean   |  BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint | Median |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
    |---+--------+------+-------+---------+--------+---------------+--------------+--------+-------+-------+---------+--------+---------------+--------------|
    | / | <      |      |       |         |        |               |            > | <      |       |       |         |        |               |            > |
    |   | 1.5_b0 | 11.9 | 15.72 |    11.7 |   15.6 |          11.6 |        15.47 | 1.5_b0 |  5.31 |  6.77 |    4.89 |   6.75 |          7.69 |        12.05 |
    |   | 1.5_b1 | 10.9 | 12.86 |         |        |               |              | 1.5_b1 |  5.40 |  6.25 |         |        |               |              |
    |   | 1.5_b2 | 12.4 | 18.07 |         |        |               |              | 1.5_b2 |  4.24 |  8.63 |         |        |               |              |
    |   | 1.9_b0 | 24.1 | 67.52 |    18.1 |   36.3 |          15.1 |        20.74 | 1.9_b0 |  9.28 | 34.03 |    7.34 |  11.52 |          9.77 |        14.01 |
    |   | 1.9_b1 | 14.1 | 19.25 |         |        |               |              | 1.9_b1 |  5.50 |  6.93 |         |        |               |              |
    |   | 1.9_b2 | 16.0 | 22.22 |         |        |               |              | 1.9_b2 |  7.66 |  8.90 |         |        |               |              |
    |   | 2.5_b0 | 10.7 | 11.48 |    13.0 |   14.5 |          14.1 |        15.98 | 2.5_b0 |  5.88 |  5.42 |    6.40 |   7.23 |          9.17 |        11.60 |
    |   | 2.5_b1 | 11.9 | 13.45 |         |        |               |              | 2.5_b1 |  7.90 |  6.80 |         |        |               |              |
    |   | 2.5_b2 | 16.3 | 18.50 |         |        |               |              | 2.5_b2 |  5.14 |  9.88 |         |        |               |              |
    |   | 2.9_b0 | 22.8 | 32.32 |    17.5 |   22.9 |          14.8 |        18.23 | 2.9_b0 |  8.30 | 14.53 |    7.39 |  11.58 |         11.55 |        11.23 |
    |   | 2.9_b1 | 13.5 | 17.35 |         |        |               |              | 2.9_b1 |  6.89 |  7.68 |         |        |               |              |
    |   | 2.9_b2 | 16.1 | 19.11 |         |        |               |              | 2.9_b2 |  5.65 |  8.82 |         |        |               |              |
    |   | 3.5_b0 | 11.1 | 11.92 |    10.9 |   10.6 |          10.9 |         9.91 | 3.5_b0 |  5.13 |  8.21 |    4.77 |   5.37 |          7.30 |         6.27 |
    |   | 3.5_b1 | 10.6 | 10.33 |         |        |               |              | 3.5_b1 |  3.91 |  5.00 |         |        |               |              |
    |   | 3.5_b2 | 11.1 |  9.49 |         |        |               |              | 3.5_b2 |  4.80 |  3.84 |         |        |               |              |
    |   | 3.9_b0 | 22.8 | 23.67 |    18.7 |   18.9 |          16.6 |        16.59 | 3.9_b0 | 10.03 | 14.05 |    7.63 |   9.32 |         10.66 |        12.46 |
    |   | 3.9_b1 | 15.7 | 16.23 |         |        |               |              | 3.9_b1 |  5.50 |  6.79 |         |        |               |              |
    |   | 3.9_b2 | 17.5 | 16.95 |         |        |               |              | 3.9_b2 |  8.47 |  8.63 |         |        |               |              |

** DONE report mse = betahat - truebeta. Modify Bootsummary.HeterPTlm function 
   git 
** DONE Change X=[1,x1,x2] where x2~N(0,1) , to see mixing :
*** DONE univariate 

    - homo , $\epsilon \sim N(0,1)$, n=500
      
      [[file:image/x2u1.pdf][MCMC]]

    - homo, $\epsilon \sim 1/2 N(-2,1) + 1/2 N(2,1)$, n=500

      [[file:image/x2u3.pdf][MCMC]]
      
*** DONE bivariate

    - homo + standard normal

      [[file:image/x2b1.pdf][MCMC]]

    - homo + standard normal with correlation $\rho=0.5$

      [[file:image/x2b2.pdf][MCMC]]

    - homo + mixture of bivariate normal in Jara's example

      [[file:image/x2b3.pdf][MCMC]]

*** DONE trivariate

    - homo + standard normal 

      [[file:image/x2t1.pdf][MCMC]]

    - homo + normal with correlation (1, 0.5, 0.25)

      [[file:image/x2t2.pdf][MCMC]]

    - homo + random effect : mixture normal + mixture normal 

      [[file:image/x2t3.pdf][MCMC]]
* 2012-10-17

** DONE personal webpage for mike's future students
** DONE consider correlated data as \alpha + \epsilon structure, where \alpha is not normal and \epsilon is weird too. :simulation:tri:
   
*** DONE Model (RE2) random effect 2
    
    $\epsilon_{ij} \sim N(0,1)$ and $a_i \sim 1/2 N(-2,1) + 1/2 N(2,1)$, can show marginally $\epsilon_{ij} \sim 1/2 N(2,2) + 1/2 N(-2,2)$
    where $q5 = 0$ and $q9 = 3.19$. sample variance is approxiamte 7 and sample correlation among subject is 0.87
    
    sampling from
    
    #+begin_src R
    e <- matrix(rnorm(nsub*q), nsub, q)
    mypi <- rbinom(nsub, size=1, prob=1/2)
    a <- mypi*rnorm(nsub, mean=-2, sd=1) + (1-mypi)*rnorm(nsub, mean=2, sd=1)
    e2 <- e + cbind(a,a,a)
    #+end_src
    
    analyticaly var(e2) = 6 and var(a) = 5. when sample size is large, sample variance of e+a goes to 6. Sampling method should be right. Correlation should be 5/6. 
    
    The correlation matrix is 
    
    \begin{displaymath}
    \begin{bmatrix}
    1 & 5/6 & 5/6 \\
    5/6 & 1 & 5/6 \\
    5/6 & 5/6 & 1
    \end{bmatrix}
    \end{displaymath}
    
    marginally the pdf is 
    
    \begin{equation}
    1/2 N(-2,2) + 1/2 N(2,2)
    \end{equation}
    
    run on biosci, file:simulation-tri-re2.R 
    
    MSE table, [[tri-mre2.RData][result]]
    
    |   | Mean   |   BQR |     PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint | Median |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
    |---+--------+-------+--------+---------+--------+---------------+--------------+--------+-------+-------+---------+--------+---------------+--------------|
    | / | <      |       |        |         |        |               |            > | <      |       |       |         |        |               |            > |
    |   | 1.5_b0 | 10.47 |   8.87 |    6.97 |   6.43 |          5.22 |         5.21 | 1.5_b0 |  6.59 |  4.53 |    3.07 |   3.35 |          3.38 |         3.51 |
    |   | 1.5_b1 |  6.15 |   7.23 |         |        |               |              | 1.5_b1 |  2.84 |  4.12 |         |        |               |              |
    |   | 1.5_b2 |  4.29 |   3.20 |         |        |               |              | 1.5_b2 |  2.21 |  1.76 |         |        |               |              |
    |   | 1.9_b0 | 49.18 | 105.45 |   22.72 |  39.29 |          9.48 |         6.21 | 1.9_b0 | 33.32 | 90.20 |    6.05 |   6.41 |          5.22 |         3.84 |
    |   | 1.9_b1 |  8.75 |   8.71 |         |        |               |              | 1.9_b1 |  4.03 |  4.58 |         |        |               |              |
    |   | 1.9_b2 | 10.21 |   3.70 |         |        |               |              | 1.9_b2 |  3.44 |  1.48 |         |        |               |              |
    |   | 2.5_b0 | 11.02 |   9.57 |    7.44 |   6.76 |          5.65 |         5.35 | 2.5_b0 |  6.91 |  4.17 |    2.99 |   2.72 |          3.52 |         4.16 |
    |   | 2.5_b1 |  7.03 |   7.82 |         |        |               |              | 2.5_b1 |  3.15 |  3.89 |         |        |               |              |
    |   | 2.5_b2 |  4.27 |   2.89 |         |        |               |              | 2.5_b2 |  1.85 |  1.17 |         |        |               |              |
    |   | 2.9_b0 | 47.01 |  60.07 |   22.32 |  24.07 |          9.97 |         6.07 | 2.9_b0 | 31.10 | 45.77 |    6.86 |   6.42 |          7.58 |         4.59 |
    |   | 2.9_b1 |  8.54 |   7.85 |         |        |               |              | 2.9_b1 |  4.66 |  5.03 |         |        |               |              |
    |   | 2.9_b2 | 11.40 |   4.29 |         |        |               |              | 2.9_b2 |  4.47 |  1.84 |         |        |               |              |
    |   | 3.5_b0 |  9.61 |   9.54 |    6.49 |   6.52 |          4.94 |         5.02 | 3.5_b0 |  5.31 |  5.05 |    3.10 |   2.55 |          3.41 |         4.26 |
    |   | 3.5_b1 |  5.58 |   6.98 |         |        |               |              | 3.5_b1 |  3.55 |  3.06 |         |        |               |              |
    |   | 3.5_b2 |  4.29 |   3.06 |         |        |               |              | 3.5_b2 |  1.94 |  1.97 |         |        |               |              |
    |   | 3.9_b0 | 46.32 |  22.47 |   21.89 |  13.65 |          9.68 |         9.25 | 3.9_b0 | 38.30 | 12.79 |    8.56 |   5.96 |          6.69 |         5.67 |
    |   | 3.9_b1 |  8.02 |  11.21 |         |        |               |              | 3.9_b1 |  3.21 |  4.74 |         |        |               |              |
    |   | 3.9_b2 | 11.34 |   7.29 |         |        |               |              | 3.9_b2 |  4.03 |  2.37 |         |        |               |              |
    
    Without intercept, PT is better than BQR . However, with median, PT is better in 2nd and 3rd component while comparing all. and is better for \beta_3 without intercept
    
    
*** DONE Model (RE3) random effect 3
    
    $\epsilon_{ij}$ and $a_i \sim 1/2 N(-2,1) + 1/2 N(2,1)$, can show marginally $\epsilon_{ij} \sim 1/4 N(-4,2) + 1/4 N(4,2) + 1/2 N(0,2)$
    where $q5 = 0$ and $q9 = 4.37$. variance is 10 and  correlation among subject is 0.5
    
    sampling from
    
    #+begin_src R
    mypi <- rbinom(nsub*q, size=1, prob=1/2)
    e <- mypi*rnorm(nsub*q, mean=-2, sd=1) + (1-mypi)*rnorm(nsub*q, mean=2, sd=1)
    e <- matrix(e, nsub, q)
    mypi <- rbinom(nsub, size=1, prob=1/2)
    a <- mypi*rnorm(nsub, mean=-2, sd=1) + (1-mypi)*rnorm(nsub, mean=2, sd=1)
    e2 <- e + cbind(a,a,a)
    #+end_src
    
    The correlation matrix is 
    
    \begin{displaymath}
    \begin{bmatrix}
    1 & 0.5 & 0.5 \\
    0.5 & 1 & 0.5 \\
    0.5 & 0.5 & 1
    \end{bmatrix}
    \end{displaymath}
    
    marginally the pdf is 
    
    \begin{equation}
    1/4 N(-4,2) + 1/4 N(4,2) + 1/2 N(0,2)
    \end{equation}
    
    run on biosci, file:simulation-tri-re3.R 
    
    MSE table [[tri-mre3.RData][result]]  
    
    |   | Mean   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint | Median |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
    |---+--------+-------+-------+---------+--------+---------------+--------------+--------+-------+-------+---------+--------+---------------+--------------|
    | / | <      |       |       |         |        |               |            > | <      |       |       |         |        |               |            > |
    |   | 1.5_b0 | 13.83 | 10.85 |    10.7 |  10.46 |          9.13 |        10.27 | 1.5_b0 |  5.08 |  4.25 |    4.03 |   4.58 |          5.95 |         7.38 |
    |   | 1.5_b1 | 12.14 | 14.51 |         |        |               |              | 1.5_b1 |  5.40 |  5.92 |         |        |               |              |
    |   | 1.5_b2 |  6.12 |  6.03 |         |        |               |              | 1.5_b2 |  2.42 |  2.70 |         |        |               |              |
    |   | 1.9_b0 | 31.59 | 65.61 |    20.1 |  29.42 |         14.36 |        11.32 | 1.9_b0 | 13.03 | 42.67 |    6.88 |   9.56 |          7.48 |         6.53 |
    |   | 1.9_b1 | 17.66 | 16.13 |         |        |               |              | 1.9_b1 |  6.72 |  7.00 |         |        |               |              |
    |   | 1.9_b2 | 11.06 |  6.52 |         |        |               |              | 1.9_b2 |  4.57 |  1.97 |         |        |               |              |
    |   | 2.5_b0 | 13.77 | 10.48 |    11.1 |   9.67 |          9.78 |         9.26 | 2.5_b0 |  8.00 |  5.16 |    5.01 |   4.03 |          5.60 |         5.67 |
    |   | 2.5_b1 | 12.96 | 13.89 |         |        |               |              | 2.5_b1 |  3.84 |  5.63 |         |        |               |              |
    |   | 2.5_b2 |  6.60 |  4.62 |         |        |               |              | 2.5_b2 |  3.31 |  2.21 |         |        |               |              |
    |   | 2.9_b0 | 29.22 | 50.61 |    20.0 |  26.99 |         15.37 |        15.18 | 2.9_b0 | 13.35 | 29.74 |    8.95 |   9.38 |          9.31 |         8.50 |
    |   | 2.9_b1 | 20.44 | 21.46 |         |        |               |              | 2.9_b1 |  9.13 |  8.33 |         |        |               |              |
    |   | 2.9_b2 | 10.29 |  8.90 |         |        |               |              | 2.9_b2 |  5.28 |  4.34 |         |        |               |              |
    |   | 3.5_b0 | 19.48 | 15.76 |    13.1 |  10.03 |          9.92 |         7.17 | 3.5_b0 |  8.07 |  7.39 |    4.38 |   3.34 |          5.75 |         4.13 |
    |   | 3.5_b1 | 12.41 |  9.48 |         |        |               |              | 3.5_b1 |  4.51 |  3.51 |         |        |               |              |
    |   | 3.5_b2 |  7.42 |  4.85 |         |        |               |              | 3.5_b2 |  3.49 |  1.69 |         |        |               |              |
    |   | 3.9_b0 | 35.30 | 41.45 |    23.3 |  25.03 |         17.24 |        16.82 | 3.9_b0 | 13.85 | 18.32 |    9.91 |   7.67 |          8.78 |         8.63 |
    |   | 3.9_b1 | 20.79 | 20.39 |         |        |               |              | 3.9_b1 |  7.54 |  5.15 |         |        |               |              |
    |   | 3.9_b2 | 13.69 | 13.24 |         |        |               |              | 3.9_b2 |  6.58 |  4.22 |         |        |               |              |
    
    As expected, Reich's method seems to have less power now. 
    
** DONE consider simulation with correlated data as \alpha + \epsilon structure, where they are both normal. Compare trivariate case. :simulation:tri:

*** DONE Model (RE1) random effect 1
   [[file:simulation-tri-re1.R]] 
   
   \begin{displaymath}
   B =    
   \begin{bmatrix}
   1 & 1 & 1 \\
   2 & 1 & 0 \\
   3 & 1 & 0 
   \end{bmatrix} 
   \quad 
   \Sigma = 
   \begin{bmatrix}
   1 & 0.6 & 0.1 \\
   & 1 & 0.3 \\
   & & 1 
   \end{bmatrix}
   \end{displaymath}

   by \epsilon = (N(0,0.3) + N(0,0.6) + N(0,0.1)) and 
   \epsilon=(N(0,0.3) + a_{12} + a_{13}, a_{23} + a_{12} + N(0,0.1), a_{23} + N(0,0.6) + a_{13})

   still on mackerel , [[tri-mre1.RData][result]]

| Term   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
|--------+-------+-------+---------+--------+---------------+--------------|
| 1.5_b0 | 1.620 | 1.906 |    1.09 |   1.30 |         0.818 |         1.00 |
| 1.5_b1 | 0.942 | 1.240 |         |        |               |              |
| 1.5_b2 | 0.695 | 0.765 |         |        |               |              |
| 1.9_b0 | 2.172 | 3.707 |    1.94 |   2.27 |         1.817 |         1.55 |
| 1.9_b1 | 2.154 | 1.748 |         |        |               |              |
| 1.9_b2 | 1.480 | 1.350 |         |        |               |              |
| 2.5_b0 | 1.601 | 1.839 |    1.31 |   1.47 |         1.169 |         1.29 |
| 2.5_b1 | 1.623 | 1.743 |         |        |               |              |
| 2.5_b2 | 0.715 | 0.838 |         |        |               |              |
| 2.9_b0 | 1.937 | 9.189 |    2.21 |   5.37 |         2.345 |         3.47 |
| 2.9_b1 | 3.275 | 3.839 |         |        |               |              |
| 2.9_b2 | 1.416 | 3.094 |         |        |               |              |
| 3.5_b0 | 1.935 | 2.428 |    1.25 |   1.55 |         0.906 |         1.11 |
| 3.5_b1 | 1.125 | 1.346 |         |        |               |              |
| 3.5_b2 | 0.686 | 0.873 |         |        |               |              |
| 3.9_b0 | 2.345 | 4.655 |    2.14 |   3.43 |         2.033 |         2.82 |
| 3.9_b1 | 2.234 | 2.301 |         |        |               |              |
| 3.9_b2 | 1.832 | 3.331 |         |        |               |              |

   as expected since previous file:simulation-tri-m2.R the decay model show favor of BQR, this time BQR is still better.

** DONE check if neither of  \alpha and \epsilon are normal, is Reich's estimates still unbiased in terms of quantile ?

#+begin_src R
test <- function(tau, n=10000){
  n <- n
  tau <- tau
  q <- (tau - pnorm(-1))/(pnorm(1)-pnorm(-1))
  mypi <- rbinom(n, size=1, prob=q)
#  r <- mypi*rnorm(n, mean=-2, sd=2) + (1-mypi)*rnorm(n, mean=2, sd=2)
  r <- mypi*rnorm(n, mean=-2, sd=1) + (1-mypi)*rnorm(n, mean=2, sd=1) + rnorm(n, sd=sqrt(3))
  print(quantile(r, probs=tau))
  print(sum(r<0)/length(r))
  r2 <- mypi*rnorm(n, mean=-2, sd=1) + (1-mypi)*rnorm(n, mean=2, sd=1) + rt(n, df=3)
  print(quantile(r2, probs=tau))
  print(sum(r2<0)/length(r2))
  
}
test(0.2)
test(0.5)
test(0.8)
#+end_src

   This code chunk shows if model is misspecified, like $a_i \sim t_3$, instead of $a_i \sim N(0,3)$, 
   marginally \beta may not be the quantile regression parameter of interest

   #+CAPTION: n=10,000
| TERM         | \tau=0.2 | \tau=0.5 | \tau=0.8 |
|--------------+----------+----------+----------|
| N, quantille |    0.006 |    -0.03 |    0.001 |
| N, P(<=0)    |     0.20 |     0.50 |     0.80 |
| t, quantile  |    0.365 |   -0.034 |   -0.312 |
| t, P(<=0)    |     0.16 |    0.503 |     0.84 |
** DONE mac 
*** DONE test ssh to my laptop and install R package (It's OK)
*** DONE fix R package install error on mike
    maybe because of absence of xquartz ?
    see notes. can download the package and install them through command 

*** DONE test xquartz on xuan 's laptop, and let me to ssh there, maybe mike does not have xquantz (X11) 
    Yes. After installing xquartz on xuan, it can forward X11 now. 
*** DONE check *echo $DISPLAY* in chanmin or no need ? ans: no need 

* 2012-10-08
  
** file:Diagnostic_HeterPTlmtri.R for making table from simulation-tri-* results :simulation:
   
** DONE check mse *MEDIAN* in case one model boomed 
   
   - M1
     
   #+attr_html: style="float:left;width:30%;margin:3ex;"
   | Term   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |--------+-------+-------+---------+--------+---------------+--------------|
   | 1.5_b0 | 0.604 | 0.659 |   0.358 |  0.467 |         0.554 |        0.646 |
   | 1.5_b1 | 0.441 | 0.478 |         |        |               |              |
   | 1.5_b2 | 0.258 | 0.284 |         |        |               |              |
   | 1.9_b0 | 0.734 | 1.213 |   0.618 |  0.889 |         1.254 |        1.193 |
   | 1.9_b1 | 1.103 | 1.016 |         |        |               |              |
   | 1.9_b2 | 0.412 | 0.477 |         |        |               |              |
   | 2.5_b0 | 0.551 | 0.653 |   0.364 |  0.400 |         0.461 |        0.560 |
   | 2.5_b1 | 0.460 | 0.499 |         |        |               |              |
   | 2.5_b2 | 0.235 | 0.264 |         |        |               |              |
   | 2.9_b0 | 0.984 | 2.614 |   0.868 |  1.886 |         1.166 |        2.359 |
   | 2.9_b1 | 1.300 | 1.402 |         |        |               |              |
   | 2.9_b2 | 0.658 | 1.439 |         |        |               |              |
   | 3.5_b0 | 0.791 | 0.802 |   0.410 |  0.444 |         0.586 |        0.674 |
   | 3.5_b1 | 0.566 | 0.555 |         |        |               |              |
   | 3.5_b2 | 0.288 | 0.269 |         |        |               |              |
   | 3.9_b0 | 1.525 | 1.449 |   0.731 |  0.934 |         0.956 |        1.296 |
   | 3.9_b1 | 0.691 | 1.305 |         |        |               |              |
   | 3.9_b2 | 0.574 | 0.592 |         |        |               |              |
   
   #+attr_html: style="float:left;width:40%;margin:3ex"
   [[file:save/tri-m1-mse.png]]
   #+html: <br style="clear:both;" />
   
   closer , but still twice error in model 2.9
   
   - M2:
     
   #+attr_html: style="float:left;width:40%;margin:3ex"
   | Term   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |--------+-------+-------+---------+--------+---------------+--------------|
   | 1.5_b0 | 0.619 | 0.614 |   0.480 |  0.631 |         0.605 |        0.698 |
   | 1.5_b1 | 0.602 | 0.738 |         |        |               |              |
   | 1.5_b2 | 0.262 | 0.274 |         |        |               |              |
   | 1.9_b0 | 1.347 | 1.982 |   0.765 |  1.089 |         0.900 |        1.294 |
   | 1.9_b1 | 0.658 | 0.834 |         |        |               |              |
   | 1.9_b2 | 0.619 | 0.673 |         |        |               |              |
   | 2.5_b0 | 0.656 | 0.730 |   0.462 |  0.549 |         0.609 |        0.651 |
   | 2.5_b1 | 0.467 | 0.714 |         |        |               |              |
   | 2.5_b2 | 0.257 | 0.272 |         |        |               |              |
   | 2.9_b0 | 1.820 | 2.657 |   0.914 |  1.478 |         1.055 |        1.527 |
   | 2.9_b1 | 0.719 | 0.865 |         |        |               |              |
   | 2.9_b2 | 0.504 | 1.116 |         |        |               |              |
   | 3.5_b0 | 0.819 | 0.627 |   0.588 |  0.522 |         0.663 |        0.750 |
   | 3.5_b1 | 0.723 | 0.736 |         |        |               |              |
   | 3.5_b2 | 0.430 | 0.325 |         |        |               |              |
   | 3.9_b0 | 1.254 | 1.595 |   0.832 |  1.433 |         1.295 |        1.923 |
   | 3.9_b1 | 0.791 | 1.410 |         |        |               |              |
   | 3.9_b2 | 0.741 | 1.623 |         |        |               |              |
   
   #+attr_html: style="float:left;width:40%;margin:3ex"
   [[file:save/tri-m2-mse.png]]
   #+html: <br style="clear:both;" />
   
   better on model 2.9
   
   - M3:
     
   #+attr_html: style="float:left;width:40%;margin:3ex"
   | Term   |   BQR |     PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |--------+-------+--------+---------+--------+---------------+--------------|
   | 1.5_b0 | 0.814 |  0.753 |   0.407 |  0.405 |         0.512 |        0.449 |
   | 1.5_b1 | 0.511 |  0.445 |         |        |               |              |
   | 1.5_b2 | 0.204 |  0.132 |         |        |               |              |
   | 1.9_b0 | 2.809 | 15.517 |   0.951 |  0.947 |         0.976 |        0.641 |
   | 1.9_b1 | 0.740 |  0.489 |         |        |               |              |
   | 1.9_b2 | 0.601 |  0.326 |         |        |               |              |
   | 2.5_b0 | 0.785 |  0.641 |   0.379 |  0.320 |         0.472 |        0.475 |
   | 2.5_b1 | 0.425 |  0.467 |         |        |               |              |
   | 2.5_b2 | 0.182 |  0.183 |         |        |               |              |
   | 2.9_b0 | 2.491 |  3.531 |   1.527 |  1.004 |         1.324 |        1.139 |
   | 2.9_b1 | 0.933 |  0.632 |         |        |               |              |
   | 2.9_b2 | 0.593 |  0.423 |         |        |               |              |
   | 3.5_b0 | 0.742 |  0.744 |   0.381 |  0.335 |         0.527 |        0.513 |
   | 3.5_b1 | 0.473 |  0.525 |         |        |               |              |
   | 3.5_b2 | 0.212 |  0.176 |         |        |               |              |
   | 3.9_b0 | 2.713 |  1.051 |   1.243 |  0.727 |         1.239 |        0.943 |
   | 3.9_b1 | 1.126 |  1.041 |         |        |               |              |
   | 3.9_b2 | 0.698 |  0.475 |         |        |               |              |
   
   #+attr_html: style="float:left;width:40%;margin:3ex"
   [[file:save/tri-m3-mse.png]]
   #+html: <br style="clear:both;" />
   
   now median is fine for model 2.9 \beta_0, but still unacceptable for model 1.9 \beta_0
   
   - M4:
     
   #+attr_html: style="float:left;width:40%;margin:3ex"
   | Term   |   BQR |    PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |--------+-------+-------+---------+--------+---------------+--------------|
   | 1.5_b0 | 0.875 | 1.065 |   1.470 |  1.587 |         2.286 |        3.177 |
   | 1.5_b1 | 1.636 | 2.324 |         |        |               |              |
   | 1.5_b2 | 1.398 | 1.498 |         |        |               |              |
   | 1.9_b0 | 1.840 | 2.634 |   2.521 |  3.219 |         4.257 |        5.263 |
   | 1.9_b1 | 1.824 | 3.098 |         |        |               |              |
   | 1.9_b2 | 3.477 | 4.508 |         |        |               |              |
   | 2.5_b0 | 0.406 | 0.468 |   0.440 |  0.506 |         0.475 |        0.629 |
   | 2.5_b1 | 0.692 | 0.884 |         |        |               |              |
   | 2.5_b2 | 0.233 | 0.316 |         |        |               |              |
   | 2.9_b0 | 0.579 | 2.232 |   1.227 |  1.856 |         1.625 |        1.721 |
   | 2.9_b1 | 1.811 | 2.182 |         |        |               |              |
   | 2.9_b2 | 0.740 | 1.119 |         |        |               |              |
   | 3.5_b0 | 0.605 | 0.582 |   0.284 |  0.359 |         0.313 |        0.594 |
   | 3.5_b1 | 0.256 | 0.511 |         |        |               |              |
   | 3.5_b2 | 0.125 | 0.152 |         |        |               |              |
   | 3.9_b0 | 1.168 | 1.689 |   0.989 |  1.233 |         1.086 |        1.483 |
   | 3.9_b1 | 0.762 | 0.818 |         |        |               |              |
   | 3.9_b2 | 0.732 | 1.224 |         |        |               |              |
   
   #+attr_html: style="float:left;width:40%;margin:3ex"
   [[file:save/tri-m4-mse.png]]
   #+html: <br style="clear:both;" />
   
** heter should not be the case , comparing M1 with M4, since Reich also consider heter in the model
   
** DONE [3/3] append difference of BQR and PT in file:../qr-draft/qr-multivariate.tex :draft:
   
   - [X] PT has more parameters (correlation matrix) than BQR in its
     compound symmetric matrix (1) 
   - [X] PT can draw inference for $y_1-y_2$
   - [X] add more description about modified bqr method for multivariate comparison
     
** DONE test $\rho=0.8$ and other $\rho_{13}=0.5$	      :simulationtri:
   
   [[file:simulation-tri-m3r.R]] 
   
   \begin{displaymath}
   \Sigma = 
   \begin{bmatrix}
   1 & 0.8 & 0.5 \\
   0.8 & 1 & 0.8 \\
   0.5 & 0.8 & 1 
   \end{bmatrix}
   \end{displaymath}
   
   send job to mackerel. 
   
   #+CAPTION: MEDIAN OF MSE FROM 100 BOOTSTRAP MODEL 3R
   | Term   |   BQR |     PT | BQR_avg | PT_avg | BQR_avg_noint | PT_avg_noint |
   |--------+-------+--------+---------+--------+---------------+--------------|
   | 1.5_b0 | 0.697 |  0.732 |   0.664 |  0.657 |         0.630 |        0.684 |
   | 1.5_b1 | 0.642 |  0.778 |         |        |               |              |
   | 1.5_b2 | 0.192 |  0.227 |         |        |               |              |
   | 1.9_b0 | 1.707 | 12.741 |   0.946 |  1.218 |         1.273 |        0.928 |
   | 1.9_b1 | 0.664 |  0.815 |         |        |               |              |
   | 1.9_b2 | 0.671 |  0.534 |         |        |               |              |
   | 2.5_b0 | 0.790 |  0.523 |   0.594 |  0.505 |         0.616 |        0.725 |
   | 2.5_b1 | 0.677 |  0.820 |         |        |               |              |
   | 2.5_b2 | 0.255 |  0.207 |         |        |               |              |
   | 2.9_b0 | 1.861 |  3.597 |   0.757 |  0.886 |         0.704 |        0.949 |
   | 2.9_b1 | 0.575 |  0.608 |         |        |               |              |
   | 2.9_b2 | 0.478 |  0.531 |         |        |               |              |
   | 3.5_b0 | 0.532 |  0.656 |   0.423 |  0.383 |         0.589 |        0.615 |
   | 3.5_b1 | 0.628 |  0.637 |         |        |               |              |
   | 3.5_b2 | 0.236 |  0.230 |         |        |               |              |
   | 3.9_b0 | 1.768 |  1.732 |   0.917 |  0.928 |         1.089 |        1.180 |
   | 3.9_b1 | 0.771 |  0.868 |         |        |               |              |
   | 3.9_b2 | 0.767 |  0.677 |         |        |               |              |
   
* 2012-10-05

** DONE try how bias in each component and include intercept in mse :simulation:tri:
   CLOSED: [2012-10-05 Fri 16:38]
   - State "DONE"       from "TODO"       [2012-10-05 Fri 16:38]

   modify BQRmargtri.R and HeterPTlmtri.R bootsummary part and output
   each component mse and include intercept, and then save result to RData

- file:simulation-tri-m1.R 

\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.5 & 0.5\\
0.5 & 1 & 0.5\\
0.5 & 0.5 & 1
\end{bmatrix}
 \right)
\end{displaymath}

seems like one of the intercept is hugely biased (3.9) . 

see file:tri-m1.RData for detail 

| TERM    |   BQR |     PT | BQR\_avg | PT\_avg | BQR\_avg\_noint | PT\_avg\_noint |
|---------+-------+--------+----------+---------+-----------------+----------------|
| 1.5\_b0 | 1.561 |  1.595 |    1.098 |    1.20 |           0.866 |           1.00 |
| 1.5\_b1 | 1.115 |  1.283 |          |         |                 |                |
| 1.5\_b2 | 0.618 |  0.725 |          |         |                 |                |
| 1.9\_b0 | 2.052 |  3.057 |    1.872 |    2.33 |           1.782 |           1.97 |
| 1.9\_b1 | 2.350 |  2.367 |          |         |                 |                |
| 1.9\_b2 | 1.214 |  1.569 |          |         |                 |                |
| 2.5\_b0 | 1.315 |  1.509 |    0.976 |    1.07 |           0.807 |           0.85 |
| 2.5\_b1 | 0.938 |  0.973 |          |         |                 |                |
| 2.5\_b2 | 0.675 |  0.727 |          |         |                 |                |
| 2.9\_b0 | 1.887 | 25.689 |    1.835 |   10.63 |           1.810 |           3.10 |
| 2.9\_b1 | 2.127 |  2.933 |          |         |                 |                |
| 2.9\_b2 | 1.493 |  3.269 |          |         |                 |                |
| 3.5\_b0 | 1.547 |  1.682 |    1.172 |    1.25 |           0.984 |           1.04 |
| 3.5\_b1 | 1.068 |  1.113 |          |         |                 |                |
| 3.5\_b2 | 0.901 |  0.968 |          |         |                 |                |
| 3.9\_b0 | 2.080 |  3.258 |    1.772 |    2.32 |           1.618 |           1.85 |
| 3.9\_b1 | 1.986 |  2.226 |          |         |                 |                |
| 3.9\_b2 | 1.249 |  1.470 |          |         |                 |                |


- file:simulation-tri-m2.R case 

\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.5 & 0.25\\
0.5 & 1 & 0.5\\
0.25 & 0.5 & 1
\end{bmatrix}
 \right)
\end{displaymath}

see file:tri-m2.RData for detail.

same problem for huge intercept error in 3.9

| Term    |   BQR |     PT | BQR\_avg | PT\_avg | BQR\_avg\_noint | PT\_avg\_noint |
|---------+-------+--------+----------+---------+-----------------+----------------|
| 1.5\_b0 | 1.241 |  1.219 |     1.02 |    1.11 |           0.914 |          1.052 |
| 1.5\_b1 | 1.130 |  1.442 |          |         |                 |                |
| 1.5\_b2 | 0.698 |  0.663 |          |         |                 |                |
| 1.9\_b0 | 2.432 |  3.166 |     2.11 |    2.40 |           1.952 |          2.020 |
| 1.9\_b1 | 2.403 |  2.629 |          |         |                 |                |
| 1.9\_b2 | 1.502 |  1.412 |          |         |                 |                |
| 2.5\_b0 | 1.914 |  1.768 |     1.22 |    1.25 |           0.873 |          0.995 |
| 2.5\_b1 | 1.008 |  1.168 |          |         |                 |                |
| 2.5\_b2 | 0.738 |  0.822 |          |         |                 |                |
| 2.9\_b0 | 3.001 | 14.191 |     1.95 |    6.28 |           1.426 |          2.324 |
| 2.9\_b1 | 1.699 |  2.057 |          |         |                 |                |
| 2.9\_b2 | 1.152 |  2.591 |          |         |                 |                |
| 3.5\_b0 | 1.425 |  1.443 |     1.14 |    1.22 |           0.997 |          1.109 |
| 3.5\_b1 | 1.269 |  1.399 |          |         |                 |                |
| 3.5\_b2 | 0.725 |  0.819 |          |         |                 |                |
| 3.9\_b0 | 2.621 |  3.378 |     2.21 |    2.82 |           2.008 |          2.548 |
| 3.9\_b1 | 2.172 |  2.643 |          |         |                 |                |
| 3.9\_b2 | 1.845 |  2.453 |          |         |                 |                |


** DONE try \rho=0.8 , a more extreme correlation or even negative :simulation:

   file:simulation-tri-m3.R compound symmetric , \rho=0.8 


\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.8 & 0.8\\
0.8 & 1 & 0.8\\
0.8 & 0.8 & 1
\end{bmatrix}
 \right)
\end{displaymath}

| Term    |   BQR |     PT | BQR\_avg | PT\_avg | BQR\_avg\_noint | PT\_avg\_noint |
|---------+-------+--------+----------+---------+-----------------+----------------|
| 1.5\_b0 | 1.513 |  1.437 |    0.988 |   0.935 |           0.725 |          0.684 |
| 1.5\_b1 | 0.982 |  0.942 |          |         |                 |                |
| 1.5\_b2 | 0.468 |  0.425 |          |         |                 |                |
| 1.9\_b0 | 4.863 | 15.621 |    2.687 |   5.993 |           1.599 |          1.179 |
| 1.9\_b1 | 1.785 |  1.529 |          |         |                 |                |
| 1.9\_b2 | 1.414 |  0.829 |          |         |                 |                |
| 2.5\_b0 | 1.510 |  1.571 |    0.992 |   1.019 |           0.734 |          0.743 |
| 2.5\_b1 | 1.006 |  1.055 |          |         |                 |                |
| 2.5\_b2 | 0.461 |  0.432 |          |         |                 |                |
| 2.9\_b0 | 5.671 | 10.519 |    3.111 |   4.626 |           1.831 |          1.680 |
| 2.9\_b1 | 1.893 |  2.236 |          |         |                 |                |
| 2.9\_b2 | 1.770 |  1.123 |          |         |                 |                |
| 3.5\_b0 | 1.364 |  1.375 |    0.985 |   0.987 |           0.796 |          0.793 |
| 3.5\_b1 | 1.160 |  1.202 |          |         |                 |                |
| 3.5\_b2 | 0.431 |  0.384 |          |         |                 |                |
| 3.9\_b0 | 5.813 |  2.482 |    3.136 |   1.827 |           1.798 |          1.500 |
| 3.9\_b1 | 1.999 |  2.004 |          |         |                 |                |
| 3.9\_b2 | 1.597 |  0.996 |          |         |                 |                |


** DONE proof of fall paper , check the figures and table with final version
   CLOSED: [2012-10-05 Fri 16:07]
   - State "DONE"       from "TODO"       [2012-10-05 Fri 16:07]

     2 small typo in table 1: 0.5000.67, 1.4-2.0

** DONE X=[1 x_1 x^{2}_{1}] problem ?

** DONE heter case might be better in favor of PT ? 

   file:simulation-tri-m4.R on whale 

\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \left( [1, x_{1}, x_{2}] 
\begin{bmatrix}
1 & 1 & 1\\
0 & 0.5 & 0\\
0.5 & 0 & 0
\end{bmatrix} \right) \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.5 & 0.5\\
0.5 & 1 & 0.5\\
0.5 & 0.5 & 1
\end{bmatrix}
 \right)
\end{displaymath}

| Term    |   BQR |     PT | BQR\_avg | PT\_avg | BQR\_avg\_noint | PT\_avg\_noint |
|---------+-------+--------+----------+---------+-----------------+----------------|
| 1.5\_b0 | 2.548 |  2.551 |    3.200 |   3.482 |           3.526 |          3.947 |
| 1.5\_b1 | 4.161 |  4.962 |          |         |                 |                |
| 1.5\_b2 | 2.890 |  2.931 |          |         |                 |                |
| 1.9\_b0 | 3.359 |  5.773 |    5.675 |   7.440 |           6.833 |          8.273 |
| 1.9\_b1 | 7.259 |  7.853 |          |         |                 |                |
| 1.9\_b2 | 6.407 |  8.694 |          |         |                 |                |
| 2.5\_b0 | 1.055 |  1.162 |    1.031 |   1.300 |           1.019 |          1.369 |
| 2.5\_b1 | 1.582 |  2.169 |          |         |                 |                |
| 2.5\_b2 | 0.457 |  0.570 |          |         |                 |                |
| 2.9\_b0 | 1.773 | 19.385 |    2.828 |  10.881 |           3.356 |          6.628 |
| 2.9\_b1 | 4.519 |  9.966 |          |         |                 |                |
| 2.9\_b2 | 2.193 |  3.291 |          |         |                 |                |
| 3.5\_b0 | 1.424 |  1.373 |    0.947 |   0.993 |           0.708 |          0.803 |
| 3.5\_b1 | 0.887 |  1.066 |          |         |                 |                |
| 3.5\_b2 | 0.529 |  0.541 |          |         |                 |                |
| 3.9\_b0 | 2.163 |  3.941 |    2.092 |   3.036 |           2.056 |          2.584 |
| 3.9\_b1 | 2.333 |  2.782 |          |         |                 |                |
| 3.9\_b2 | 1.779 |  2.386 |          |         |                 |                |


* 2012-10-01

** in fortran attributes calling, order matters 

** DONE fix heterptlmtri.f bug
   CLOSED: [2012-10-02 Tue 17:10]
   - State "DONE"       from "TODO"       [2012-10-02 Tue 17:10]

   find out 3rd component is not changing the loglik\_mpt , because I
   did not modify Sigmainv in loglik\_mpt , still the 2-dim. 

   after manually modify Sigmainv (by getting the inverse by hand), it
   works.

   try more single simulation to see if it works

** correlation matrix restriction

   $\rho_1^2 < 1$ and $\rho^2_2 < 1$

\begin{displaymath}
   \rho_1^2 + \rho_2^2 + \rho_3^2 < 1 + 2\rho_1\rho_2\rho_3
\end{displaymath}

** DONE test PTdensity on 3 dim PT 
   CLOSED: [2012-10-02 Tue 16:06]
   - State "DONE"       from "TODO"       [2012-10-02 Tue 16:06]
   
   now does not matter

** TODO try more simulations on trivariate case , compare to Reich w/ or w/o compound symmetric
   :PROPERTIES:
   :ID:       6C827903-6A33-4B46-9B0E-9EBB5F66E315
   :END:

   modify BQRmarg.R to file:BQRmargtri.R 

   gamma stuff , *and* stuff, see diff for detail

   time issue , 100 obs *3, 
   - 20k + 20k*20 for PT tri, 992s
   - 20k + 20k for Reich BQRmargtri.R , 997s 

     100 obs *3 , 100 boot

     file:simulation-tri-m2.R 

\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.5 & 0.25\\
0.5 & 1 & 0.5\\
0.25 & 0.5 & 1
\end{bmatrix}
 \right)
\end{displaymath}


     - PT: 20k+20k*20
     - BQR: (5k+10k )*2

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 0.89 | 0.95 |
|  1.9 | 2.11 | 1.79 |
|  2.5 | 0.72 | 1.00 |
|  2.9 | 1.36 | 2.86 |
|  3.5 | 0.89 | 1.02 |
|  3.9 | 1.97 | 2.45 |

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 0.86 | 1.06 |
|  1.9 | 1.82 | 1.96 |
|  2.5 | 0.86 | 1.10 |
|  2.9 | 1.59 | 3.96 |
|  3.5 | 0.91 | 1.13 |
|  3.9 | 1.69 | 2.55 |
   

     file:simulation-tri-m1.R 

\begin{displaymath}
[y_{1}, y_{2}, y_{3}] = [1, x_{1}, x_{2}]
\begin{bmatrix}
1 & 1 & 1\\
1 & 1 & 1\\
1 & 1 & 1
\end{bmatrix} + \mathrm{N}_3 \left( 0, 
\begin{bmatrix}
1 & 0.5 & 0.5\\
0.5 & 1 & 0.5\\
0.5 & 0.5 & 1
\end{bmatrix}
 \right)
\end{displaymath}

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 0.97 | 0.96 |
|  1.9 | 2.31 | 1.65 |
|  2.5 | 0.82 | 0.92 |
|  2.9 | 1.47 | 3.26 |
|  3.5 | 0.99 | 1.01 |
|  3.9 | 2.08 | 2.37 |

     weird performance 

* 2012-09-19

** TODO try tri-variate case, figure out how to deal with covariance matrix
   :PROPERTIES:
   :ID:       E4F0C00F-E032-4E48-8893-48C75FF41B06
   :END:

   file:heterptlmtri.f file:HeterPTlmtri.R

   first version, not right on 3rd component

   still debuging 

** TODO find out why Reich is worse than PT in simulation-multivariate{3,4}-heter.R
   :PROPERTIES:
   :ID:       0F61BA5E-E5BC-4C87-BA73-772589612451
   :END:

   - fewer iterations ?

     try more iterations for BQRmarg.R, 20k burn + 20k iter

     file:simulation-multivariate4-heter-more.R  on mackerel

     and just fit median regression, and wait to compare on mackerel 

| TERM |  BQR |   PT |
|------+------+------|
|  1.5 | 4.35 | 4.02 |
|  2.5 | 3.72 | 3.39 |

   seems like it is not because fewer iterations.

** DONE check out Reich method again, 
   CLOSED: [2012-09-19 Wed 15:01]
   - State "DONE"       from "TODO"       [2012-09-19 Wed 15:01]

*** DONE reich paper 
    CLOSED: [2012-09-19 Wed 14:18]
    - State "DONE"       from "TODO"       [2012-09-19 Wed 14:18]

    y = x\beta + a + x\gamma \epsilon 
    the conditional quantile regression is appropriate if each
    cluster's quantile is interested.
    can not interpretted as population's \tau th quantile

    marginal:
    y = x\beta + x\gamma (a + \epsilon)

*** DONE check code, subject. It's correct. 
    CLOSED: [2012-09-19 Wed 13:14]
    - State "DONE"       from "TODO"       [2012-09-19 Wed 13:14]

*** DONE try BQRmarg.R / BQRcond.R
    CLOSED: [2012-09-19 Wed 15:01]
    - State "DONE"       from "TODO"       [2012-09-19 Wed 15:01]

    BQRcond is for within cluster, BQRmarg is for population
    quantile. 

** DONE compare/simulation on spike and slab prior for heter model
   CLOSED: [2012-09-20 Thu 12:50]
   - State "DONE"       from "TODO"       [2012-09-20 Thu 12:50]

   \beta=(1,1,1), \gamma = (1,0,0.5) , e~N(0,1), n = 100, boot=100

   file:simulation-ss-m1.R on whale 

| TERM | Normal |    SS |
|------+--------+-------|
|  0.5 |   4.59 |  4.61 |
|  0.9 |  32.14 | 20.16 |

** DPpackage: there seems to be no function for multivariate regression , even for homogeneous model

* 2012-09-12

** TODO introducing \pi~beta(1,1) distribution. in spike and slab prior. using slice sampler ?
   :PROPERTIES:
   :ID:       64758277-79CA-499D-AE69-C043DA502DC2
   :END:

   file:HeterPTlmMean-ss.R

   updated file:invcdfnorm.c as well , added myrbeta

   done , but have not done simulation to test its effect ? 

** TODO x covariate matrix may include indicator for component, to affect heter variance
   :PROPERTIES:
   :ID:       110AB27D-730B-43ED-B00F-80AA205E8FF9
   :END:

** DONE try heter case in multivariate simulation, with modified Reich, refer to simulation-multivariate3.R and 4.R
   CLOSED: [2012-09-14 Fri 15:36]
   - State "DONE"       from "TODO"       [2012-09-14 Fri 15:36]
*** DONE try heter on e~n((0,0), (1,1,1,4)) , heter=(1,-0.5,0.5)
    CLOSED: [2012-09-13 Thu 11:06]
    - State "DONE"       from "TODO"       [2012-09-13 Thu 11:06]
    file:simulation-multivariate3-heter.R

| Term |   BQR |    PT |
|------+-------+-------|
|  1.5 |  3.68 |  3.01 |
|  1.9 |  9.97 |  6.26 |
|  2.5 | 15.87 | 12.03 |
|  2.9 | 47.09 | 23.77 | 
  
*** DONE try heter on e~n((0,0), (1,0.5,0.5,1)) , heter=(1,-0.5,0.5)
    CLOSED: [2012-09-14 Fri 15:36]
    - State "DONE"       from "TODO"       [2012-09-14 Fri 15:36]
    file:simulation-multivariate4-heter.R

| Term |   BQR |   PT |
|------+-------+------|
|  1.5 |  4.20 | 3.52 |
|  1.9 | 13.18 | 5.70 |
|  2.5 |  3.82 | 3.65 |
|  2.9 | 28.79 | 6.69 |

    in both cases, PT is better than BQR

** DONE try n=1500 with M=6 or 7 or 8 instead of log2(n)
   CLOSED: [2012-09-14 Fri 23:14]
   - State "DONE"       from "TODO"       [2012-09-14 Fri 23:14]

   on whale, file:testHeterPTlmMean-ss.R , failed, try mackerel

   when maxm(M) = 6, time = 23490 sec compare to previous 27*** sec,
   where M is set to be log(n)=10 with base 2

** TODO draft multivariate part (check previous document)
   :PROPERTIES:
   :ID:       D9F66480-24B7-433F-BD66-49E7D1A79065
   :END:

* 2012-09-10
** DONE try n = 1500
   CLOSED: [2012-09-11 Tue 20:58]
   - State "DONE"       from "TODO"       [2012-09-11 Tue 20:58]
   n = 1500, burn = 20k, skip=20, nsave=10k, 
   homo, e3, .5N(-2,1)+.5N(2,1)
   time : 27357 sec

#+BEGIN_SRC latex
$coef
$coef$beta
[1] 0.9833874 1.0080125 1.0078189

$coef$gamma
[1]  1.000000000 -0.003107103 -0.003907234

$coef$quan
[1] -1.206314e-16  2.918158e+00

$coef$betatau
         [,1]      [,2]      [,3]
0.5 0.9833874 1.0080125 1.0078189
0.9 3.9015458 0.9990775 0.9961223
#+END_SRC

   very accurate in beta and gamma, a little bit bias in quan(0.9), true=2.79

** TODO try update \pi in spike and slab prior
   :PROPERTIES:
   :ID:       9B185E9A-FBFC-42D4-88AC-27EE11566BE1
   :END:
** DONE try simulation on multivariate case, modified Reich, for e~n((0,0), (1,1,1,4))
   CLOSED: [2012-09-11 Tue 11:07]
   - State "DONE"       from "TODO"       [2012-09-11 Tue 11:07]
   file:simulation-multivariate3.R 

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 1.14 | 1.07 |
|  1.9 | 3.53 | 2.16 |
|  2.5 | 3.80 | 3.40 |
|  2.9 | 27.3 | 6.42 |

   dominate by PT

** DONE try simulation on multivariate case, modified Reich, for e~n((0,0), (1,0.5,0.5,1))
   CLOSED: [2012-09-11 Tue 11:06]
   - State "DONE"       from "TODO"       [2012-09-11 Tue 11:06]
   file:simulation-multivariate4.R 

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 0.97 | 1.04 |
|  1.9 | 2.18 | 2.14 |
|  2.5 | 1.03 | 1.11 |
|  2.9 | 2.36 | 2.40 | 

   as expected by Mike, BQR is better since the case is exact how
   Reich designed. 
  
   time: 10h for simulation 100 rep

** DONE check Mac, www.computerstore.utexas.edu
   CLOSED: [2012-09-12 Wed 12:47]
   - State "DONE"       from "TODO"       [2012-09-12 Wed 12:47]
** DONE check out printer budget 1,500
   CLOSED: [2012-09-12 Wed 12:47]
   - State "DONE"       from "TODO"       [2012-09-12 Wed 12:47]

* 2012-08-15 file:20120905-report.pdf
** DONE n=500 for all simulation in paper, univariate		 :simulation:
   CLOSED: [2012-08-28 Tue 00:05]
   - State "DONE"       from "DONE"       [2012-08-29 Wed 07:24]
   - State "DONE"       from "TODO"       [2012-08-28 Tue 00:05]
   - State "DONE"       from "TODO"       [2012-08-25 Sat 08:24]
   rewrite simulation function again , 
   file:simulation-parallel-m1.R
   file:simulation-parallel-m2.R on mackerel
   file:simulation-parallel-m3.R on mackerel, binormal N(-2,1)+N(2,1)

| Term |    RQ |  BQR |   PT |
|------+-------+------+------|
| M1.5 |  0.23 | 0.17 | 0.19 |
| M1.9 |  0.50 | 0.37 | 0.39 |
| M2.5 |  5.06 | 0.40 | 0.28 |
| M2.9 |  0.71 | 0.42 | 0.57 |
| M3.5 | 34.07 | 3.60 | 2.28 |
| M3.9 |  4.34 | 2.27 | 3.04 |

   more skew case homo, reich mixture skew
   file:simulation-parallel-m4.R on mackerel

   still BQR best

| Term |   RQ |  BQR |   PT |
|------+------+------+------|
| M4.5 | 0.38 | 0.27 | 0.36 |
| M4.9 | 3.75 | 1.31 | 1.78 |

   on t3 distribution ,  homo 
   file:simulation-parallel-m5.R on mackerel


| Term |   RQ |  BQR |   PT |
|------+------+------+------|
| M5.5 | 0.29 | 0.22 | 0.34 |
| M5.9 | 1.33 | 0.77 | 1.18 |

   t3, heter (1, -0.5, 0.5)
   file:simulation-parallel-m6.R on mackerel

   still BQR>PT>rq

| Term |   RQ |  BQR |   PT |
|------+------+------+------|
| M6.5 | 1.79 | 1.20 | 1.66 |
| M6.9 | 6.64 | 3.19 | 5.16 |

*** DONE decide M = 7 for n = 500
    CLOSED: [2012-08-24 Fri 16:21]
    - State "DONE"       from "TODO"       [2012-08-24 Fri 16:21]


** DONE not fair for both in multivariate simulation, try same beta, X=n*6, beta 6 for reich :simulation:
   CLOSED: [2012-08-24 Fri 16:21]
   - State "DONE"       from "TODO"       [2012-08-24 Fri 16:21]
*** DONE try e2 ~ ((0,0), (1, -1, -1,4))
    CLOSED: [2012-08-16 Thu 21:51]
    - State "DONE"       from "TODO"       [2012-08-16 Thu 21:51]
    modify [[file:simulation-multivariate2.R]] 
    modify [[file:BQRmarg.R]] too, gamma

    win 

| Term |   BQR |   PT |
|------+-------+------|
|  1.5 |  1.16 | 0.91 |
|  1.9 |  2.97 | 1.95 |
|  2.5 |  4.96 | 4.17 |
|  2.9 | 26.25 | 6.42 |

*** DONE try e3, with 6 beta with 1,2,3, 1,1,1
    CLOSED: [2012-08-20 Mon 21:32]
    - State "DONE"       from "TODO"       [2012-08-20 Mon 21:32]
    - State "DONE"       from "TODO"       [2012-08-19 Sun 16:25]
    modify file:simulation-multivariate.R

| Term |    BQR |   PT |
|------+--------+------|
|  1.5 |   1.48 | 0.24 |
|  1.9 |   0.92 | 0.50 |
|  2.5 | 250.17 | 0.06 |
|  2.9 | 269.92 | 0.11 |

    wrong code, rerun again

| Term |  BQR |   PT |
|------+------+------|
|  1.5 | 0.48 | 0.23 |
|  1.9 | 6.05 | 0.49 |
|  2.5 | 0.05 | 0.06 |
|  2.9 | 2.14 | 0.12 |

** TODO check Tokdar's model
   :PROPERTIES:
   :ID:       82840C46-CC96-4E35-B4DF-2FEDF890F04C
   :END:

** DONE compare time with Reich, univariate and multivariate
   CLOSED: [2012-09-05 Wed 20:38]
   - State "DONE"       from "TODO"       [2012-09-05 Wed 20:38]

*** univariate case
   file:comparetime.R

   n = 100, heter (1, -0.5, 0.5), e3 0.5N(-2,1)+0.5N(2,1)
   burn 20000, 
   runs = 10k for BQR
   runs = 10k (every 20) for pt

| TERM  |  Time |
|-------+-------|
| BQR.5 | 140.6 |
| BQR.9 | 142.1 |
| PT    | 352.9 |

   note: pt runs 10k*20 iterations

| TERM  |   Time |
|-------+--------|
| BQR.5 | 5197.4 |

   difference: pt is using fortran, compiled language, while BQR only
   depends on R

*** multivariate, file:comparetime-multi.R
    e3 , mixture binormal in Jara's paper, homo
 
| TERM  | TIME | Runs       |
|-------+------+------------|
| BQR.5 | 245s | 1k+5k      |
| BQR.9 | 242s | 1k+5k      |

| MPT   | 418s | 20k+20*10k |
** Use posterior mean as estimates , HeterPTlmMean.R

** NOTES:

   I agree with Larry that if youâre fitting a mixture model, itâs
   good to be aware of the problems that arise if you try to estimate
   its parameters using maximum likelihood or Bayes with flat priors. 

   In summary, yes, a mixture model can be a âbeastâ (as Larry puts
   it), but this beast can be tamed with a good prior
   distribution. More generally, I think prior distributions for
   mixture models can be expressed hierarchically, which connects my
   sort of old-fashioned models to more advanced mixture models that
   have potentially infinite dimension.

** DONE try spike slab prior in paper file:HeterPTlmMean-ss.R  file:heterptlm-ss.f
   CLOSED: [2012-09-09 Sun 00:24]
   - State "DONE"       from "TODO"       [2012-09-09 Sun 00:24]
   The spike slab prior I am using is 0.5N(0, 0.1^2)+0.5N(0, 1000)
   somehow works again. for homo, heter e3. file:testHeterPTlmMean-ss.R
   comparison:

   M3: homo e3 0.5N(-2,1)+0.5N(2,1):
   HeterPTlmMean: 
   \beta : 1.20, 0.94, 0.95
   \gamma : 1, -0.03, 0.01
   ss:
   \beta : 1.18, 0.94, 0.96
   \gamma: 1, -0.02, 0.00

   M4: heter(1,-0.5, 0.5), e3, same as above
   HeterPTlmMean:
   \beta: 1.27, 0.8, 0.87
   \gamma:1, -0.55, 0.46
   ss:
   \beta: 1.28, 0.69, 0.89
   \gamma: 1, -0.49, 0.39

   
* 2012-08-07 [[file:20120815-report.pdf]]
** DONE Multivariate simulation with Reich BQR: on mackerel
   CLOSED: [2012-08-13 Mon 09:49]
   - State "DONE"       from "TODO"       [2012-08-13 Mon 09:49]
   [[file:simulation-multivariate.R]]

   truebetatau = 
   [ 1.5:   (1,2,3) + (1,0,0)q1.5
     1.9:   (1,2,3) + (1,0,0)q1.9
     2.5:   (1,1,1) + (1,0,0)q2.5
     2.9:   (1,1,1) + (1,0,0)q2.9 ]

   BQR.Summary(fit.5, truebetatau1.5) 
   bootsummary.HeterPTlmm(foo3, truebetatau)$mse 

   [?contriversal: different X for same subject] 

   result=[mse.bqr1.5, 1.9, 2.5, 2.9; mse.pt1.5, 1.9, 2.5, 2.9]

   parallel to run **boot** times 

   nsub=100, q=2

   MSE result: 2012/08/12

| BQR |   PT |
|-----+------|
| 204 | 0.21 |
|  25 | 0.48 |
| 204 | 0.06 |
|  25 | 0.14 |

   try beta=(1,1,1) for all component 2012/08/13 , e3

|  BQR |   PT |
| 0.05 | 0.24 |
| 0.23 | 0.49 |
| 0.05 | 0.07 |
| 0.23 | 0.15 |

   try beta=(1,1,1) with e2 2012/08/13 on whale
   [[file:simulation-multivariate2.R]]

|  BQR |   PT |
| 0.51 | 0.78 |
| 1.03 | 1.60 |
| 0.51 | 0.84 |
| 1.03 | 1.68 | 
  

** DONE do simulation for univariate with obs=500 , parallel
   CLOSED: [2012-08-11 Sat 15:02]
   - State "DONE"       from "TODO"       [2012-08-11 Sat 15:02]
   [[file:simulation-parallel-skew-homo.R]]

   after running for about 30 hours, obs-500, boot=100,
   result 2012-08-11
   apply(result, 1, mean)*100

| Term |       0.5 |       0.9 | 
| rq   | 0.3639835 | 4.1763633 | 
| BQR  | 0.2435555 | 1.2849694 | 
| PT   | 0.3321430 | 1.6910171 | 

   BQR>PT>rq 

*** DONE work on R parallel , doMC, multicore, snow
    CLOSED: [2012-08-10 Fri 01:31]
    - State "DONE"       from "TODO"       [2012-08-10 Fri 01:31]
    see my blog

** DONE consider Q(y_p - y_1) or Q(C'Y)
   CLOSED: [2012-08-14 Tue 20:51]
   - State "DONE"       from "TODO"       [2012-08-14 Tue 20:51]
   posterior samples for \epsilon_p - \epsilon_1 ?

   since y_p = x \beta_p + (x'\gamma_p) \epsilon_p, 
   y_1 = x'\beta_1 + (x'\gamma_1) \epsilon_1

   so y_p - y_1 = x'(\beta_p - \beta_1) +(x'\gamma_p) \epsilon_p) -
   (x'\gamma_1) \epsilon_1

   since we have draw  samples from posterior distribution of vector
   \epsilon_1, ..., \epsilon_p,  then, we have posterior samples for
   y_p - y_1 

** DONE missing data in multivariate quantile regression :missing:longitudinal:
   CLOSED: [2012-08-14 Tue 21:35]
   - State "DONE"       from "TODO"       [2012-08-14 Tue 21:35]
   - f(\beta|y_obs)
   - f(\beta|y) -> y_mis | y_obs, \beta, F , imputation
     
*** missing mechanism
   p(y, r|x, w) = p(y|x,w) p(r|y, w)

   p(r|y, w) = p(r|y_obs, y_mis, w)
     - MCR: p(r|y,x, w) = p(r|x, w)
     - MAR: p(r|y_obs, y_mis, x, w) = p(r|y_obs, x, w)

*** Ignorable
   L(\theta, w |y_obs, r) \propto
   p(r, y_obs |\theta, w) = \int p(r|y_obs, y_mis, w)p(y_obs,
   y_mis|\theta) dy_mis
   (MAR) = p(r|y_obs, w) p(y_obs|\theta) 
   = L_1 (w|r, y_obs) L_2 (\theta|y_obs)

*** Example, J=2
   L(\theta, w|y_i,obs, r_i) = L_1(\theta|y_i, obs) L_2(w|r_i, y_i1)

*** Imputation
    p(y_mis|y_obs, r, w) = 
    p(y_mis, y_obs, r|w) / p(y_obs, r|w) 
    (IG) = p(r|y_obs, y_mis, \phi) p(y_obs, y_mis|\theta)/ p(r|y_obs,
    \phi)/p(y_obs|\theta) 
    (MAR) = p(y_mis|y_obs, \theta)

    so 
    p(y_2|y_1, r=0, \theta) = p(y_2|y_1, r=1, \theta) 
    any parametrize form ?
    check Ch6, data augmentation

    now suppose data are (y_1, y_2) , for some data, y_2 is missing,
    so 
    p(y_2|y_1, r=1, x,\beta) \propto p(y1, y2|\beta,x) , 
    which , the latter is a location-scale transformed multivariate
    Polya tree distribution, with  previous \beta as parameter. 

** DONE read spatial paper on desktop				    :spatial:
   CLOSED: [2012-08-14 Tue 11:50]
   - State "DONE"       from "TODO"       [2012-08-14 Tue 11:50]

     
* 2012-08-02
** DONE put more simulation (skewed, t) in paper, qr-draft.tex
   CLOSED: [2012-08-03 Fri 13:05]
   - State "DONE"       from "TODO"       [2012-08-03 Fri 13:05]
** DONE draft multivariate case BQRPT and demo result; draft/qr-multivariate.tex; git:skew
   CLOSED: [2012-08-05 Sun 14:39]
   - State "DONE"       from "TODO"       [2012-08-05 Sun 14:39]

     
* 2012-07-28
** TODO MI , missing data , wei-carroll
   :PROPERTIES:
   :ID:       855A5459-F1FB-4359-9112-8D357C080916
   :END:
** DONE notes for multiple imputation
   CLOSED: [2012-07-29 Sun 15:33]
   MAR: missingness only depend on Y_obs, not on Y_mis
   distinctness: parameter \theta for data model are distinct with
   missingness indicator
   MAR+distinctness = ignorable 

   Y_mis ~ p(Y_mis|Y_obs, theta_t)
   theta_t+1 ~ p(theta| Y_obs, Y_mis)

   converges to p(Y_mis, \theta|Y_obs)

   multiple imputation iteration 3-10 times 

   [[http://sites.stat.psu.edu/~jls/mifaq.html]]
   
** DONE HeterPTlmm.R, heterptlmm.f , git:multivariate, git:multi-matrix, [[file:draft/qr-multivariate.pdf]]
   CLOSED: [2012-08-06 Mon 15:37]
   - State "DONE"       from "TODO"       [2012-08-06 Mon 15:37]
   the whole multivaraite framework may be wrong, since the beta
   should be p*q dim ?

   look back to Jara again

   look back to multivariate regression. 
   HeterPTlmm.R, heterptlmm.f, git:multivariate

   sometimes works, sometimes not. 

   Y=XB+E

   bug: 
   1. x ->  X
   2. x(nrec,p) -> x(nsub, p)
   3. index, betasave(p, q, nsave), array, apply, dim
   4. array transfer between R and Fortran
   5. version 2.0 

   v2.0

** TODO think about spatial for zhuojie
   :PROPERTIES:
   :ID:       C4C559EE-1B34-4878-A0B6-51683A80BB8E
   :END:
   Notes on Spatial 
   
   1. stationarity : (Y(si), Y(sn)) is same as (Y(si+h), Y(sn+h)) 
      say \mu(s) = \mu, cov(Y(s), Y(s+h))= C(h)

   2. if E(Y(s+h)) = E(Y(s))
      E(Y(s+h)-Y(s))^2 = Var(Y(s+h)-Y(s)) = 2 \gamma(h) = 2(C(0)-C(h))
      variogram

   3. isotropy: \gamma(h) = f(|h|)

   first law of geostat: data = mean + error


** DONE remember to change tune3(p) to tune3(3) in git:master
   CLOSED: [2012-07-31 Tue 10:51]
   - State "DONE"       from "TODO"       [2012-07-31 Tue 10:51]
** DONE remember to add initial sec00 time in git:master
   CLOSED: [2012-07-31 Tue 10:51]
   - State "DONE"       from "TODO"       [2012-07-31 Tue 10:51]

** DONE test how array transfer between R and fortran
   CLOSED: [2012-08-01 Wed 19:41]
   - State "DONE"       from "TODO"       [2012-08-01 Wed 19:41]

     
* 2012-07-20
** DONE try more skewed distribution in simulation (mixture of normal?)
   \gamma=c(1, -0.5, 0.5)
   try Reich 2011, \pi*N(0,1) + (1-\pi)*N(3,3)
   [[file:simulation-skew.R]]
   [[file:simulation-skew-output-0721]]

   try mean of posterior for estimates 
   still not better than BQR(Reich)
   [[file:simulation-skew-0722]]

   but mean seems *better* than median and
   the result in 0722 of PT is *better* than that of BQR in 0721

   try that again 
   [[file:simulation-skew-0726]]
   still BQR > PT > rq , result close to 0722

   | Model          | Tau |         BQR |          PT |           rq |
   |----------------+-----+-------------+-------------+--------------|
   | Mixture Normal | 0.5 |  7.11(0.92) |  8.11(0.86) |  11.64(1.49) |
   |                | 0.9 | 39.41(4.09) | 44.91(4.28) | 103.0(10.52) |

** DONE read carefully on Tokdar paper
   give up

** TODO think about Y > X, log X, log Y model , survival, competing risks
   :PROPERTIES:
   :ID:       D0B7FE38-90C4-4C98-9F0B-33A2E80087DE
   :END:
   check out survival analysis with PT, walker or something

   Notes: 
   
*** competing risk 
    
    Putter 2007,
    Hanson, Jara 2012
    Walker Mallick 1997, 1999
    
    multivariate failiure time, model the minimum of t1, ..., tk
    cox PH
    model the joint Prob distribution of t1, ..., tk 

    PH , AFT, PO
    AFT, log T = x\beta + \epsilon  \Leftrightarrow S_x(t)=
    S_0(exp(-x\beta)t)
    exp(\epsilon) ~ S_0
    
    Zhao 2009 , model the S_0 baseline survival function with Bayesian
    nonparametric 

    Walker 1997, model the error with PT , median
    regression. including censoring.

** DONE simulation on t3 heter [[file:simulation-t3.R]]
   result: [[file:simulation-t3-0727]]
   still BQR > PT > rq 

   | Model          | Tau |         BQR |          PT |          rq |
   |----------------+-----+-------------+-------------+-------------|
   | Mixture Normal | 0.5 |  6.12(0.63) |  6.93(0.69) |  7.23(0.69) |
   |                | 0.9 | 18.38(2.06) | 24.16(2.32) | 38.80(4.69) |

   
** DONE simulation on skew distribution with homo 
   CLOSED: [2012-07-28 Sat 00:07]
   result: [[file:simulation-skew-homo-0727]]
   still BQR>PT>rq

   | Model          | Tau |        BQR |          PT |          rq |
   |----------------+-----+------------+-------------+-------------|
   | Mixture Normal | 0.5 | 1.87(0.22) |  2.24(0.27) |  2.33(0.32) |
   |                | 0.9 | 8.77(1.01) | 11.30(1.32) | 17.27(1.81) |


** DONE multivariate, HeterPTlmm.R, 
   change to maxm=log(nsub)/log(2) instead of log(nrec)/log(2)

   
* 2012-07-18
** Mike did another pass
1. all the paper above are about single quantile regression
2. specify more about deficit of single quantile regression: see
   tokdar 2011
3. DP also tractable , only mean advantage in continuous pdf
4. berger2001 not clear: 
   used a polya tree process to test the fit
   of data to a parametric model by embedding the parametric model in a
   nonparametric alternative and computing the Bayes factor of the
   parametric model to the nonparametric alternative.

* 2012-06-20
** DONE wrap paper with reference 
*** DONE [5/5]tours data
    - [X] more difference , better
    - [X] show rq estimates
    - [X] comment on Table 4
    - [X] explain age difference in \tau=0.9 for PT and qreg
    - [X] explain how we get the residual density 
** DONE revise paper
*** DONE reference : literature review on qr application
    just add several paper in introduction for qr application
    - Yu 2001
      - Cole, Green , 1992
      - Royston, Altman, 1994
      - Buchinsky 1998
      - yu and jones 1998
      - He et al 1998
      - Koenker and Machado 1999
    - Dette 2010
      - Buchinsky 1994
      - Wei et al 2006
    - Kobayashi:
      - Yu et al 2003
      - Buchinsky 1998
      - Koenker 2005
    - Oh 2011
      - Yu, Lu, Stander 2003 , twice
** DONE check Machado-silva-2011 paper about rq heterogeneity test
   about qreg package
** DONE multivariate : HeterPTlmm.R, heterptlmm.f ; reference : PTlmm.R
** DONE code HeterPTlmm.R, plot.HeterPTlmm
** difference in heterptlm.f and heterptlmm.f with mdzero
   in heterptlm.f , mdzero=0: median fixed at 0
   in heterptlmm.f , mdzero = fixed = 1 : fixed at 0 
** DONE how to draw 2-dim hist : plot( scatterplot)
** DONE marginal density estimation
** DONE quantile estimation 

* 2012-06-13
** DONE revise paper
** TODO spatial, lum
   :PROPERTIES:
   :ID:       B8BE0464-CBAD-4A62-9495-DBDCF566BAD6
   :END:
** TODO multivariate : HeterPTlmm.R, heterptlmm.f ; reference : PTlmm.R
   :PROPERTIES:
   :ID:       7577A6C3-9EE8-4DA1-AE3B-2C76D397FAC6
   :END:

** DONE coxph 
** DONE revise change to positive sign (baseline-6month) weight1-weight2, in [[file:data/manipulation2.R]]
** DONE for tours data, just leave race1 and race3, in the covariate matrix [[file:data/tours-quick-report.pdf]]
** Austin , Patterson Hall 
** [[file:function_list.org]] : explain important function in DPpackage src 

* 2012-06-06 [[file:qr-tours.pdf]]
** DONE use 90\% credible intervl , not 90\% , should be \tau=0.9
** DONE do tours model with age variable centerred
** TODO think about spatial
   :PROPERTIES:
   :ID:       5AB04D7C-70CE-4582-B7B1-FDDDCA5BCC88
   :END:
** DONE think about survival , coxph , with Lei Huang
   found Hanson 2006 already did that 
** TODO think about multiple inputation
   :PROPERTIES:
   :ID:       425D0DD3-BC85-4637-9E37-44052DE5F23C
   :END:
** DONE add future work in conclusion part 
** DONE modify HeterPTlm.R to improve density estimation, may just grid , change.200.center.grid.RData
** DONE even for my own simulation, first run is not good, second run is much better . (M3)
** DONE make ETS slides 
** DONE org-html5presentation.el , but no date, no email 

* 2012-05-29  
** DONE take weight2-weight1 as response, [[file:data/analysis2.R]] , [[file:data/manipulation2.R]]
** TODO think about lum paper, about spatial process of quantile regression
   :PROPERTIES:
   :ID:       2C79FF8C-12FE-4599-A136-D239AC47BC06
   :END:
** DONE revise paper and add real data part 
** DONE rm(list=ls(all=TRUE)), still the same, first time not working, run simulation first, then works
** TODO think about lei huang 's survival
   :PROPERTIES:
   :ID:       46B34D18-C42E-4219-B2AD-643E7AFDFA3D
   :END: 

* 2012-05-27 [[file:20120529-report.pdf]]
** DONE revise draft [[file:draft/qr-draft.tex]]
** DONE add / remove/change/ note ,etc, trackchange in qr-draft.tex
** latexdiff old.tex new.tex > diff.tex 

* 2012-05-16
** TODO try M=6 for real data
   :PROPERTIES:
   :ID:       38A0331D-3950-4C45-B58D-626B55CC3BDC
   :END: 

** DONE check boxplot default parameter , for upper and lower bar 
   Q3+ 1.5IQR, Q1- 1.5IQR for default
** DONE make credibla interval for \beta , \gamma 
   Model  fitfull  in [[file:analysis.R]]
## apply(fitfull$betasave, 2, function(x) quantile(x, c(0.025, 0.975)))
##            [,1]       [,2]       [,3]      [,4]
## 2.5%   83.13156 -0.2491084 -0.3905151 -9.884113
## 97.5% 107.62403  0.1657862  6.1281146  6.463808

## apply(fitfull$gammasave, 2, function(x) quantile(x, c(0.025, 0.975)))
##       [,1]      [,2]      [,3]      [,4]
## 2.5%     1 0.3844938 -16.07257 -68.71022
## 97.5%    1 6.5634041  44.54264  44.58428

## apply(fitfull$quansave, 2, function(x) quantile(x, c(0.025, 0.975)))
##                [,1]       [,2]
## 2.5%  -8.170117e-17 0.06385883
## 97.5%  1.140611e-16 1.03819180

## attach(fitfull)
## tmp5 <- betasave + gammasave*as.numeric(quansave[,1])
## tmp9 <- betasave + gammasave*as.numeric(quansave[,2])
## (ci.betatau5 <- apply(tmp5, 2, function(x) quantile(x, c(0.025, 0.975))))
## (ci.betatau9 <- apply(tmp9, 2, function(x) quantile(x, c(0.025, 0.975))))
## detach(fitfull)

## (ci.betatau5 <- apply(tmp5, 2, function(x) quantile(x, c(0.025, 0.975))))
##            [,1]       [,2]       [,3]      [,4]
## 2.5%   83.13156 -0.2491084 -0.3905151 -9.884113
## 97.5% 107.62403  0.1657862  6.1281146  6.463808
## > (ci.betatau9 <- apply(tmp9, 2, function(x) quantile(x, c(0.025, 0.975))))
##            [,1]      [,2]       [,3]      [,4]
## 2.5%   83.32166 0.1561623 -0.3394639 -21.76870
## 97.5% 107.87337 0.5876159 12.1397408  11.77846

** DONE wrap paper with intro, method, and simulation, real data, altogether -> [[file:qr-draft.pdf]]
   no MCMC tracing plot 
** can  not find funding 
* 2012-05-02
** DONE ask Chanmin about the TOURS dataset
   original dataset, about baseline weight covariates age, ethonot... 

** TODO real data , TOURS [[manipulation.R]] [[file:analysis.R]]
   :PROPERTIES:
   :ID:       7FED05A2-F126-4B67-B682-7D29A98DA93B
   :END:
   focus on AGE, RACE, wtkg1
   1. plot (wt ~ age)
      [[file:weight-age.png]]

   2. plot(wt ~ RACE)

      weird , never update
      try PTlm
      
** DONE write down introduction , paper  prepare [[file:qr-introduction.org]] , [[file:qr-introduction.pdf]]
** TODO compare vector vs component update , 100 datasets
   :PROPERTIES:
   :ID:       EDE05B3B-A6EA-473F-8955-DF2920CB189E
   :END:

** Change back to individual component update 

** TODO why not working again when change back component
   :PROPERTIES:
   :ID:       B8F57733-7C9D-487F-8252-EFD91311CE51
   :END:

** Not working first time, but every time , run simulation first, after that ,works again.

** TODO add seed
   :PROPERTIES:
   :ID:       3F86090E-7F02-438A-A0B4-234FEE5742EA
   :END: 

   
* 2012-04-25
** DONE may concentrate on cdf not pdf (PTdensity) , so turn back to log_2(n) for M

** DONE bring simulation stuff for paper, comparison  and just demo, [[file:qr-simulation.pdf]] :simulation:
   [[file:qr-simulation-code.R]] vector update
** DONE think about model for mike's data
   y_ij = beta0 + beta1*time + u_i + ( ...) e_ij
   e_ij ~ N(0, \sigma^2)
   u_i vector ~ MPT
** TODO seems like vector is not better than individual [[file:outfile-pt-0501-m4]]
   :PROPERTIES:
   :ID:       3FA83352-A166-4B75-9F11-29B28A4D2F76
   :END:

* 2012-04-18 [[file:20120425-report.pdf]]
** DONE may consider vector sampling again , and check loglik when nskip=1
   test multivariate normal sampling first 

   vector branch. 
   In HeterPTlm,   propv <- t(chol(solve(t(x)%*%x)))
   in heterptlm.f betac ~ beta + tune*propv %*% rnorm(p)

   test on M1-5, n=100, acf ,  on M2, better than previous individual sample,
   on M3, still better, except a little bit not as good as individual
   sample on intercept 

   [[file:20120420-vector-m1-pt-diag.pdf]]
   [[file:20120420-vector-m2-pt-diag.pdf]]
   [[file:20120420-vector-m3-pt-diag.pdf]]
   [[file:20120420-vector-m4-pt-diag.pdf]]
   [[file:20120420-vector-m5-pt-diag.pdf]]

   [[file:20120423-vector-m1-pt.pdf]]
   [[file:20120423-vector-m2-pt.pdf]]
   [[file:20120423-vector-m3-pt.pdf]]
   [[file:20120423-vector-m4-pt.pdf]]
   [[file:20120423-vector-m5-pt.pdf]]

   n=200, M1, M3, M4 good, M2 M5 only ok, ac drops slowly
   [[file:20120423-vector-m1-200-pt.pdf]]
   [[file:20120423-vector-m2-200-pt.pdf]]
   [[file:20120423-vector-m3-200-pt.pdf]]
   [[file:20120423-vector-m4-200-pt.pdf]]
   [[file:20120423-vector-m5-200-pt.pdf]]

   [[file:20120423-vector-m1-200-pt-diag.pdf]]
   [[file:20120423-vector-m2-200-pt-diag.pdf]]
   [[file:20120423-vector-m3-200-pt-diag.pdf]]
   [[file:20120423-vector-m4-200-pt-diag.pdf]]
   [[file:20120423-vector-m5-200-pt-diag.pdf]]

** DONE try not median 0 ? for PTdensity 
   1. X_0, X_1, X_00, X_01, ... | Y, mu, sigma, c 
   2. mu | X_0, Y, sigma, c, \propto \prod X_\epsilon (y_i) \phi(y_i, \mu_i)
   3. sigma | ... , same 
   4. c | sigma \mu, Y, G (X_\epsilon)  \propt f(y_i|X_\epsilon
      ...f(X_\epsilon)
      = dbeta(X_\epsilon, cj^2,cj^2)
   5. save sample 
      f(grid) = \prod X_\epsilon (grid) 2^M \phi(grid, \mu, \sigma)
** DONE try n=10k for PTdensity 
   [[file:maxm8-10k-normal.pdf]]
   [[file:maxm13-10k-normal.pdf]]

   [[file:maxm8-10k-gamma.pdf]]
   [[file:maxm13-10k-gamma.pdf]]
** TODO think about How to use quantile regression in Mike's data
   :PROPERTIES:
   :ID:       6CBD3C68-BA28-4059-AA67-C92A26B3701F
   :END:
   1. previous 
   y_ijk = b0 + b1* x_ijk + u_i + (1 + gamma_ij)*e_ijk 
   u_i ~ N(0, sigma^2i)
   e_ijk ~ PT 

   2. may model (u_i, and e_ijk) together . 
      y_ij ...

** DONE write my own PTDensity function  [cancel]
   Jara's is good
** DONE check out PTlmm
   y = xbeta + z*theta + e, e~ N(0, sigma2)
   theta | G ~ PT
   1. beta | ..  ~ N(...) conjugate
   2. theta, i = 1, nsub 
      L \proxt f(y|beta, theta) * p(theta) 
                normal            PT
   3. sigma2|...  , IGamma, conjugate
   4. mu, Sigma, c, Ortho
     
** TODO test shrinkage model ? on heter? on homo ?
   :PROPERTIES:
   :ID:       196C977B-B796-4A28-A688-57821A6D5CB8
   :END:
** TODO sample code the function for mike's data  with random effects
   :PROPERTIES:
   :ID:       28ADE70F-3B18-4750-AC11-D899837AB2D0
   :END: 
   
** DONE test n=500 , PTlm, M fixed at 8 or 6 

* 2012-04-04 ENAR [[file:20120417-report.pdf]] [[file:20120417-report-supp.pdf]]
** DONE no thining, brad does not recommend thining, check mixing with no thining
   since discarding samples is not efficient,
   if you believe after burn-in part, everything is from the true
   posterior distribution
** DONE check ACF function, wrap it into Diagnose function
** DONE [HETER] 
   - for n=100, M1 , heter is fine , [[file:20120408.pdf]], re-test
     M2, [[file:20120408-m2.pdf]]
   - revise heterptlm.f , discard gammac when (x'gammac<0)
   - BQRiid.R modified min(X'gammac) , M1, n=100, [[file:BQRheter.pdf]]
     [[file:20120408-bqr-m1.pdf]]
     m2 [[file:20120408-bqr-m2.pdf]]
** DONE [ACF]
** DONE [acceptance rate] 0.4 ?
   [[file:mcmc.pdf]] Page 29 mentioned 1/4 for high dim, 1/2 for dim 1 to 2
** DONE diagnose M1-5, n=100, arate=0.4, 
   [[file:20120408.pdf]]
   [[file:20120408-m2.pdf]]
   [[file:20120408-m3.pdf]]
   [[file:20120408-m4.pdf]]
   [[file:20120408-m5.pdf]]

   BQRiid: tau=0.5
   [[file:20120408-bqr-m1.pdf]]
   [[file:20120408-bqr-m2.pdf]]
   [[file:20120408-bqr-m3.pdf]]
   [[file:20120408-bqr-m4.pdf]]
   [[file:20120408-bqr-m5.pdf]]

   PTlm: tau=0.5
   [[file:20120409-ptlm-m1.pdf]]
   [[file:20120409-ptlm-m2.pdf]]
   [[file:20120409-ptlm-m3.pdf]]
   [[file:20120409-ptlm-m4.pdf]]
   [[file:20120409-ptlm-m5.pdf]]
** DONE change candidate distribution for alpha and sigma to Normal w/ truncated
   git branch newcand
   N(sigma, tune)*I(0,20)

   seems not good as previous one. want to change back 
** TODO check out posterior property from rPT
   :PROPERTIES:
   :ID:       5137D5D8-655D-466B-A4CA-C79594795992
   :END:
** TODO think about missing data
   :PROPERTIES:
   :ID:       B15A6F4A-8E5D-49AC-97B8-477CFEC28C2C
   :END: 
** DONE add arate in heterptlm.f 
** Thining = 20 much better than thining=10 , acf is small for M2 n=100
** n=500 , X random, not (1,x1,x1^2) foo2 bad , foo3 fine , foo4 bad 
** DONE M1-M5 n=500 , X=(1,x1,x2)
   [[file:20120413-m1.pdf]]
   [[file:20120413-m2.pdf]]
   [[file:20120413-m3.pdf]]
   [[file:20120413-m4.pdf]]
   [[file:20120413-m5.pdf]]

** DONE test n=500 PTdensity , gamma and normal [[file:test-ptdensity.R]]
   M=8 is quite different with M=6 [[file:maxm6-gamma.pdf]] [[file:maxm8-gamma.pdf]]
   M=8 much more wiggler , M=6 smooth
   M=9 even more wiggler 
   for mixture noral: [[file:maxm6-normal.pdf]] 
   [[file:maxm8-normal.pdf]]
** DONE try M=6 on n=500 gamma M2
   still not good on mixing , acf large
   - [X] try M3, 
   - [ ] try arate=0.4 on M2 ? 
   - M=6 for n=500, M2, M3 not good as M=8 (default), try M=9 ? 
     record figure 
** DONE simulation for boot=10, on M1-5 , compare with BQR	 :simulation:
   - PT M1-5 @whale
   - BQR  M1, M2, @mackerel 

   - BQRboot2 -> M3 bqrboot7.R -> M2
     bqrboot4 M4, bqrboot6 M5

     outfile-bqr-0413-m1
     outfile-pt-0413-m1

   MSE
|-------+---------------+-------------|
| Model |           BQR |          PT |
|-------+---------------+-------------|
| M1.5  |    0.66(0.05) |  0.96(0.07) |
| M2.5  | 163.26(1.95)* |  4.77(0.23) |
| M3.5  |    1.87(0.18) |  2.06(0.25) |
| M4.5  |    16.5(1.90) |  6.29(0.86) |
| M5.5  |    13.9(1.39) |  15.5(1.86) |
|-------+---------------+-------------|
| M1.9  |    2.77(0.29) |  1.30(0.09) |
| M2.9  | 642.15(9.87)* |  17.2(1.16) |
| M3.9  |    2.15(0.27) |  4.56(0.64) |
| M4.9  |    12.4(1.44) | 14.88(2.76) |
| M5.9  |    85.2(7.84) |  67.2(8.82) |
|-------+---------------+-------------|
   *: WRONG 

   seems like going to beat BQR in some model , try boot=100 on
   weekend 
** DONE simulation for boot=100, M1-M5, mcmc more , compete with BQR, :simulation:
   - PT M1-3 @whale
   - PT M4-5 @mackerel
     outfile-pt-0414-m1

   - BQR M1-M2 @prawn
   - BQR M3-5 @skate
     outfile-bqr-0414-m1

     M1: standard normal
     M2: gamma(3,1)
     M3: mixture normal
     M4: heter mixture normal
     M5: heter gamma(3,1)

     heter=c(1, -0.5, 0.5)

   MSE
|-------+------------+---------------|
| Model |        BQR | PT            |
|-------+------------+---------------|
| M1.5  | 0.96(0.10) | 0.96(0.09)*   |
| M2.5  | 2.08(0.36) | 2.72(0.33)    |
| M3.5  |  4.09(0.5) | 1.89(0.26)*   |
| M4.5  | 13.1(1.73) | 8.83(0.96)*   |
| M5.5  | 12.2(1.41) | 13.1(1.65)    |
|-------+------------+---------------|
| M1.9  | 1.96(0.25) | 1.79(0.17)*   |
| M2.9  | 10.4(1.77) | 14.6(1.87)    |
| M3.9  | 4.32(0.54) | 3.83(0.49)*   |
| M4.9  | 12.5(1.32) | 14.06(1.39)** |
| M5.9  | 47.7(6.65) | 61.7(7.18)    |
|-------+------------+---------------|

   comments: win on normal, mixture normal, ** except heter mixture
   normal 

   comments2: compare with simulation on 03-28, beat rq for all model.

** DONE simulation on ASL model Homo @whale			 :simulation:
   [[file:HeterPTlm-boot-asl.R]] outfile-pt-0414-asl
   [[file:BQRboot3-asl.R]] outfile-bqr-0414-asl

   MSE: homo ASL 
|--------+------------+------------|
| Model: |        BQR |         PT |
|--------+------------+------------|
| ASL.5  | 1.20(0.17) | 1.79(0.24) |
| ASL.9  | 4.76(0.65) | 6.07(0.81) |
|--------+------------+------------|

** DONE change heter parameter to get case when our method dominates for Mixture normal @mackerel
   M4: (1-x1+x2)*e4 HeterPTlm-boot4.R outfile-pt-0414-m4-2
   M4: BQRboot4.R outfile-bqr-0414-m4-2

   MSE: (1-x1+x2)*e4 , mixture normal, 
|--------+------------+------------|
| Model: |        BQR |         PT |
|--------+------------+------------|
| M4.5   | 33.9(4.67) |  25.6(3.5) |
| M4.9   | 23.5(2.80) | 23.8(2.89) |
|--------+------------+------------|

** DONE simulation heter ASL @whale (1,-1,1)			 :simulation:
   [[file:HeterPTlm-boot-asl-heter.R]] outfile-pt-0415-asl-heter
   [[file:BQRboot3-asl-heter.R]] outfile-bqr-0415-asl-heter

   MSE: (1-x1+x2)*e3 , ASL
|--------+------------+-------------|
| Model: |        BQR |          PT |
|--------+------------+-------------|
| M4.5   | 8.95(0.84) | 11.97(1.41) |
| M4.9   | 40.0(4.07) |  44.8(7.44) |
|--------+------------+-------------|

   not even close.. lose again

** DONE Kottas, Krnjajic, 2009 , SJS, mixture DP
   no method comparison,
   no regression parameter in simulation

** DONE Tokdar-Kadane-BA-2011 [important] simultaneous linear quantile regression
   /tmp/slqr
   good review on , traditional quantile regression with check
   function and linear programming, nonparameteric way, modeling error
   distribution with polya tree and DP. 
   simultaneous quantile regression 
   
   problem for a single tau-quantile regression: not coherent, as they
   each represent posterior belief under a different model

** DONE check Thompson 2010: splines

** DONE Kozami-2010, gibbs sampling for asl
   good paper about gibbs sampling for ASL, and 
   reported good performance of rq in heter case, 
   may consider do simulation against them, following their 
   settings 

   Tsionas update each element of beta separately, may produce highly
   correlated draws and become less efficient than Kozami's
   algorithm. 

** TODO consider simulation comparison on simultaneous quantile regression
   :PROPERTIES:
   :ID:       D263DF32-E152-4417-919A-8ACE858A688A
   :END:

* 2012-03-28
** Git
*** DONE clean folder first [cancel]
*** DONE git push 
    add agenda.org, heterptlm.f, HeterPTlm.R
*** DONE branch vector [cancel]
** DONE check out Kozami 's paper 4-17
** DONE revise ENAR slides [[file:enar-minzhao-slides.pdf]]
** TODO n=1k mixing fix , after git , only HeterPTlm.R, and heterptlm.f , add sigmasave
   :PROPERTIES:
   :ID:       4D9C3CF3-A215-474D-817D-F8DD4CC0364F
   :END:
*** TODO set nskip=1, check loglik,
    :PROPERTIES:
    :ID:       5F3B660E-08DA-48B1-9FDF-2D5B6A65EA7B
    :END: 
*** DONE using new heterptlm.f check other 5 model 
** DONE simulation M5 heter gamma on BQRboot6.R, [[file:outfile-bqr-5]]
MSE
|-------+------------+------------------------------------+------------|
| Model |         rq |                          HeterPTlm |        BQR |
|-------+------------+------------------------------------+------------|
| M1.5  | 1.39(0.13) |                         1.06(0.12) |            |
| M2.5  | 3.31(0.36) |                         3.18(0.35) |            |
| M3.5  | 17.2(1.48) |                         2.21(0.30) |            |
| M4.5  | 95.4(6.69) |                         9.87(1.09) |            |
| M5.5  | 14.3(1.36) | 15.16(1.8); 10.0(1.04) outfile 5.1 | 10.4(1.07) |
|-------+------------+------------------------------------+------------|
| M1.9  | 2.35(0.26) |                         2.07(0.23) |            |
| M2.9  | 15.2(1.51) |                         13.5(1.61) |            |
| M3.9  | 3.68(0.46) |  4.27(0.64) ;3.94(0.56) outfile3.1 |            |
| M4.9  | 25.1(2.66) |                         14.8(1.41) |            |
| M5.9  | 73.7(8.48) |             63.1(7.01); 60.2(8.14) | 40.4(4.00) |
|-------+------------+------------------------------------+------------|

* 2012-03-21
** DONE revise ENAR slides
** DONE finish the previous simulation
** TODO check n=1k mixing , debug, heterptlm5.f, HeterPTlm3.R,
   :PROPERTIES:
   :ID:       7BF7FD70-F7F4-4FC9-B259-51FBA1ABD885
   :END:
     - rerun M3 on skate n=100, boot=100 , also M5
     - check n=1k M2 on whale
     - after debug my function, works better for M2, (n=500, 50k runs) 
     - still bad for M5, seems small acceptence rate
     - may due to large noise , by Arkendu, change prior ? foo2.3
     - [ ] may because of (X'gamma) check
     - compare to PTlm , for M2, n=500, runs=1k,
       [[file:PTlm-500-1000.pdf]]
     - add b~N(b, tune*(xtx)^-1(i)) , M2, n=500,
       [[file:foo2.6.pdf]]
     - increase tuning 0.1 on beta and gamma
       [[file:foo2.7.pdf]]
     - set max tuning =100 instead of 10
     - guessing need to change MH rate criteror
       [[file:mcmc.pdf]] mentioned 1/4 for high dim, 1/2 for dim 1 to 2
       try to adjust acceptance rate to 1/2
       not good on M4 foo4.4
       rate->0.2 foo4.5
** TODO debug heterptlm3.f, correct right tuning and add ratesave tunesave, hetersave, add b~N(b, tune*(xtx)^-1(i))
   :PROPERTIES:
   :ID:       30B0FD8E-3E4B-4DAE-8161-175C5F4BBE22
   :END:
** DONE check biometrika paper 
   - may apply to our model , think about it.
   - multiple imputation with PT, paddock 2002
   - check Bayesian , multiple imputation
** TODO X=(1,x,x^2) , linearity in X, consider any X ?
   :PROPERTIES:
   :ID:       D2EDA264-14F4-4DE5-A14A-151516D918A8
   :END:
** DONE update with vector, not componentwisely, heterptlm4.f, and HeterPTlm2.R, testHeterPTlm2.R
   propv 
   time, n=100, nsave=1k, 26s
   very very bad mixing on foo2, n=500, discard

* 2012-03-14 [[file:20120321-report.pdf]]
** TODO revise ENAR slides
   :PROPERTIES:
   :ID:       C8ED9A52-D9E6-4342-B827-097A58D442E8
   :END:
*** figure							     :figure:
    [[file:homo-heter-fig.R]]
** TODO test Gamma(3,1) post quantile with n=1k ?      :HeterPTlm:simulation:
   :PROPERTIES:
   :ID:       25C5CE8B-B738-40E5-90D0-95E091CA10A9
   :END:
   foo2, n=1k, wired output, may because of large M ? try set M=7 or 6
   ? or because nsave=1k ?
   try X\beta + Mixture normal with n=1k

   M1: [[file:0316-1.pdf]]
   M2: [[file:0316-2.pdf]]
   M3: [[file:0316-3.pdf]] bad
   M4: [[file:0316-4.pdf]] bad
   M5: [[file:0316-5.pdf]]

   try to adjust mdzero=1, in HeterPTlm.R 2012/03/16 @kelp, n=500
   M1: [[file:0316-1-md1.pdf]]
   M1: [[file:0317-1-md1(2).pdf]]
   M2: [[file:0317-2-md1.pdf]]
   M3: [[file:0316-3-md1.pdf]]
   M3: [[file:0317-3-md1(2).pdf]]
   M4: [[file:0317-4-md1.pdf]]
   M5: [[file:0317-5-md1.pdf]]

   M5 quite bad, may check with mdzero=0 ? same. why ? 
   seems like still not converge

   try myheterptlm13.R ?  [[file:0317-pt13-5-md1.pdf]]

   try to adjust M=6 or 7 , not log(n)/log(2) in HeterTPlm.R @tygro
   2012/03/16, put 'M" and "mdzero" in prior parameter, n=500

   M3: [[file:0316-3-md0-m6.pdf]]

   just realize M5 is not wrong, since  2012/03/18
   1+x1+x2 + (1-0.5x1+0.5x2)(2.67+e) 
   = 3.67 + (1-2.67/2)x1 + (1+2.67/2)x2 + ...e

   M3: n=1k, mdzero=0, maxm=log(n)/log(2), 10k save, 
   [[file:0318-3-md0-10k.pdf]]

   do n=1k, save=5000 again for M1-M5
   [[file:0319-1.pdf]]
   [[file:0319-2.pdf]]   
   [[file:0319-3.pdf]]
   [[file:0319-4.pdf]]
   [[file:0319-5.pdf]]

   guess M is too large, set maxm=6
   [[file:0320-1.pdf]]
   [[file:0320-2.pdf]]   
   [[file:0320-3.pdf]]
   [[file:0320-4.pdf]]
   [[file:0320-5.pdf]]
   
   turn back to n=100, again, reproduce, maxm=6
   [[file:0320-1-n100.pdf]]
   [[file:0320-2-n100.pdf]]   
   [[file:0320-3-n100.pdf]]
   [[file:0320-4-n100.pdf]]
   [[file:0320-5-n100.pdf]]
   they are all mixing well 

   previously, always set maxm=log_2(n), because syntax error on
   if/else , shame. same with mdzero

** DONE runs simulation M1-M5  , compare with quantreg		 :simulation:
    M1: x\beta + N(0,1)
    M2: x\beta + Gamma(3,1)
    M3: x\beta + Mixture Normal
    M4: x\beta + (1-0.5x_1 + 0.5x_2) Mixture normal
    M5: x\beta + (1-0.5x_1 + 0.5x_2) Gamma(3,1)
    
    [[file:HeterPTlm-boot1.R]] n=100 boot = 100, nsave=10k
    @whale , skate, drum, prawn, mackerel

    [[file:RQboot1.R]]  very quick, just one click.

MSE
|-------+------------+------------------------------------|
| Model |         rq |                          HeterPTlm |
|-------+------------+------------------------------------|
| M1.5  | 1.39(0.13) |                         1.06(0.12) |
| M2.5  | 3.31(0.36) |                         3.18(0.35) |
| M3.5  | 17.2(1.48) |                         2.21(0.30) |
| M4.5  | 95.4(6.69) |                         9.87(1.09) |
| M5.5  | 14.3(1.36) | 15.16(1.8); 10.0(1.04) outfile 5.1 |
|-------+------------+------------------------------------|
| M1.9  | 2.35(0.26) |                         2.07(0.23) |
| M2.9  | 15.2(1.51) |                         13.5(1.61) |
| M3.9  | 3.68(0.46) |  4.27(0.64) ;3.94(0.56) outfile3.1 |
| M4.9  | 25.1(2.66) |                         14.8(1.41) |
| M5.9  | 73.7(8.48) |             63.1(7.01); 60.2(8.14) |
|-------+------------+------------------------------------|

length b2
|-------+------+-----------|
| Model |   rq | HeterPTlm |
|-------+------+-----------|
| M1.5  | 0.40 |      0.46 |
| M2.5  | 0.68 |      0.72 |
| M3.5  | 1.43 |      0.62 |
| M4.5  | 2.99 |      1.37 |
| M5.5  | 1.36 |      1.24 |
|-------+------+-----------|
| M1.9  | 0.70 |      0.66 |
| M2.9  | 1.59 |      1.52 |
| M3.9  | 0.88 |      0.88 |
| M4.9  | 1.56 |      1.52 |
| M5.9  | 2.91 |      2.35 |
|-------+------+-----------|

length b3
|-------+------+-----------|
| Model |   rq | HeterPTlm |
|-------+------+-----------|
| M1.5  | 0.30 |      0.37 |
| M2.5  | 0.53 |      0.55 |
| M3.5  | 1.01 |      0.51 |
| M4.5  | 2.39 |      1.29 |
| M5.5  | 1.22 |      1.16 |
|-------+------+-----------|
| M1.9  | 0.86 |      0.53 |
| M2.9  | 1.76 |      1.14 |
| M3.9  | 1.02 |      0.74 |
| M4.9  | 1.72 |      1.37 |
| M5.9  | 3.28 |      2.17 |
|-------+------+-----------|

coverage prob
|-------+------+-----------|
| Model |   rq | HeterPTlm |
|-------+------+-----------|
| M1.5  | 0.82 |      0.93 |
| M2.5  | 0.89 |      0.95 |
| M3.5  | 0.85 |      0.95 |
| M4.5  | 0.86 |      0.95 |
| M5.5  | 0.89 |       0.9 |
|-------+------+-----------|
| M1.9  | 0.95 |      0.96 |
| M2.9  |  0.9 |      0.89 |
| M3.9  | 0.93 |      0.97 |
| M4.9  | 0.88 |      0.94 |
| M5.9  | 0.93 |      0.87 |
|-------+------+-----------|


** DONE write down specifically rigorously the proof for marginalized posterior quantile :report:
*** QR, Heterogeneity
*** PT
**** Definition
**** parameter choice
**** mean or maginal of PT, cdf and pdf
**** Update and conjugacy
**** mixture of PT
**** [ ] multivariate
**** marginalized posterior / predictive cdf, and quantile function
*** QR w/ PT
** DONE consider code for choosing/changeing baseline measure in HeterPTlm.R
   it's feasible, by using different .Fortran function in HeterPTlm.R
   with pre-specified family

* 2012-03-07 [[file:20120314-report.pdf]]
** TODO make slides for ENAR, 5 min for QR, 5 for Polya, 5 for my. see [[file:enar-minzhao-slides.pdf]]
   :PROPERTIES:
   :ID:       BDF3E11F-6BF1-4E1B-A1D1-4FEAD7258416
   :END:
   - PT-talk3.pdf
   - quantreg.pdf
   - rq.pdf
   - schrimpf-2011.pdf

** TODO optimize myheterptlm13.R w/ fortran [[file:HeterPTlm.R]]	  :HeterPTlm:
   :PROPERTIES:
   :ID:       C5A21012-3BE9-4CBC-85A5-E177729CB57B
   :END:
   [[file:heterptlm1.f][heterptlm1.f]] (for mcmc) , w/ invcdfnorm.c , [[file:heterptlm1.R]]
   mixing bad, begin to add tuning parameter , say gamma(3,1) , [[file:gamma-100-10k.pdf]]
   first , try tune separately , then try same model as above
   (gamma(3,1), 100-10k, 3+x1+x2+gamma(3,1)) 16s for 100 nsave,
   [[file:gamma-100-10k-aftertune.pdf]]

   after correct prior paramater, add 20k burning,
   [[file:gamma-100-10k-0312.pdf]]
   
   now test mixture of Normal, pretty good for mixing and result 
   even for heterogeneity
   [[file:MN-100-10k-0312.pdf]]

   2012/03/12   back up heterptlm1.f as heterptlm1.back

*** DONE add posterior quantile (tau) : [[file:postquantile.f]] perfect.

*** DONE combine postquantile.f with heterptlm1.f

*** DONE wrap heterptlm1.f in [[file:HeterPTlm.R]] with [[file:heterptlm3.f]]
    (y,X, mcmc, prior, quan)
    mcmc=c(nburn, nskip, nsave, ndisp)
    prior: 
    beta ~ N(betapm, betapv)
    gamma ~ N(gammapm, gammapv)
    1/sigma2 ~ Gamma(tau1, tau2) tau
    alpha ~ Gamma(aa0, aa1) a0b0

*** DONE summary.HeterPTlm  in [[file:HeterPTlm.R]]

*** DONE print.HeterPTlm  in [[file:HeterPTlm.R]]
*** DONE record time: n=100, burn=10k, thin=20, nsave=1k
1) HeterPTlm: 93s, 47s after running on a x86 system (@whale)
2) Reich: BQRiid : 25s

*** DONE do M1-M6, give output pdf file (mixing)		 :simulation:
    [[file:0314-1.pdf]]
    [[file:0314-2.pdf]]
    [[file:0314-3.pdf]]
    [[file:0314-4.pdf]]
    [[file:0314-5.pdf]]
    M1: x\beta + N(0,1)
    M2: x\beta + Gamma(3,1)
    M3: x\beta + Mixture Normal
    M4: x\beta + (1-0.5x_1 + 0.5x_2) Mixture normal
    M5: x\beta + (1-0.5x_1 + 0.5x_2) Gamma(3,1)

*** DONE do simulation M1-M6 , get table about MSE 
    see 03-14
*** DONE guessing to tune whole beta vector might be better *CANCEL*

** DONE write my own fortran code for loglik_unippt function,
   remember to compare to Jara's function
   I check Jara's code for loglik_unippt, it should be right if we
   take mdzero not equal to 0, a little bit worse for b1, but for
   other , almost same 

   set mdzero =0 , seems to be the right way
** DONE check Gamma(3,1)'s PTboot6.R, foo6's mixing , check jump , *CANCEL*

** DONE mdzero=0 or mdzero=1 , loglik_unippt is right , Jara used to mention about calculating from second level, check 
*** in [[file:heterptlm1.R]]
   mdzero!=0  seems to be thr right answer, but why there is mdzero=0
   option

   mdzero=0 : calculate from 2nd level
   mdzero=1 : calculate from 1st level
   and mdzero=0/1 depends a lot, loglik may switch 
: nrec <- 20
: > v <- rgamma(nrec, 3,1)
: > loglik_pt(nrec, 1, 6, 1, 0, 6.8^2, v, whicho, whichn, 0)
: [1] -42.10861
: > loglik_pt(nrec, 1, 6, 1, 0, 6.8^2, v-3, whicho, whichn, 0)
: [1] -50.66843
: > loglik_pt(nrec, 0, 6, 1, 0, 6.8^2, v, whicho, whichn, 0)
: [1] -52.92703
: > loglik_pt(nrec, 0, 6, 1, 0, 6.8^2, v-3, whicho, whichn, 0)
: [1] -49.74306
   but when change to another partition
: loglik_pt(nrec, 1, 6, 1, 0, 1^2, v, whicho, whichn, 0)
: [1] -81.20012
: > loglik_pt(nrec, 1, 6, 1, 0, 1^2, v-3, whicho, whichn, 0)
: [1] -34.71013
: > loglik_pt(nrec, 0, 6, 1, 0, 1^2, v, whicho, whichn, 0)
: [1] -92.01854
: > loglik_pt(nrec, 0, 6, 1, 0, 1^2, v-3, whicho, whichn, 0)
: [1] -33.78475
   
** DONE mdzero=0 or 1  in loglik_unippt, but in PTlm, always set it to be 0
   and seems like set mdzero=0 is the right answer for heterptlm.f ,
   i guess it is to fix or tend to shrink to median 0 as we specify to
   error should be 

** DONE check Walker and Mallick , they might mention about not to update first level, fixing median and variance ? :median:variance:level:
*** They prefer not updating the first level , even the second level to fix median  and variance. might help for (x\gamma)\epsilon .
   walker-1997.pdf
   /If F is allowed to be completely arbitrary then a scource of
   confouding is the location of F with the intercept term of \beta. A
   solution to this problem is provided if the median of F is fixed. This
   is possible with Polya trees, without much difficulty, by taking the
   first partition at level 1 to coincide with the fixed median value,
   i.e. to take B0=(-\nfty, \lambda) and B1=[\lambda, \infty) if \lambda
   is the required median. The random variable C_0 is now defined to be
   1/2 , instead of coming from a beta distribution. The centring of F is
   not affected in any way provided that centring probability
   distribution G also has its median at \lambda./

   mallick-walker-2003.pdf
   If F is allowed to be completely arbitrary then a source of confounding is
   the intercept term of Î² with the location of F . To solve this problem we fix
   the median of F at Gâ1 (1/2) by defining F (B0 ) = F (B1 ) = 1/2. This does
   not affect the centering of F . If G is normal with median at 0 then F has its
   median at 0 almost surely. Here (2) becomes a median regression model with
   medg(Ti) = âXi Î² instead of the more usual mean regression model. We will
   also fix the quantiles to control the variance as F (B00 ), F (B01 ), F (B10 ) and
   F (B11 ) all fixed at 1/4 so that the interquartile range will be fixed.

   We can then sample a random F from this posterior (up to level M only)
   according to Definition 1 but with F (B0 ) and F (B1 ) fixed at 1/2 and F (B00 ),
   F (B01 ), F (B10 ) and F (B11 ) all fixed at 1/4.

** DONE also compare with myheterptlm13.R, where the mdzero=1, and the algorithm seems to be right.
*** [[file:heterptlm1.R]] , with gamma(3,1) 3+x1+x2 + gamma(3,1), 100, 1k, 
    [[file:myptlm13-gamma.pdf]] fine (right beta1, even for 1k)
    - myheterptlm13 
      -- mdzero=1 : 3.66
      -- mdzero=0 : 5.66 mixing is bad [[file:myptlm13-gamma-mdzero0.pdf]]
    - heterptlm1
      - mdzero=1 : 0.68, but [[file:md1.pdf]] ,a location shift
      - mdzero=0 : 5.23 

** pre-specify prior parameters , report them and discuss with mike

   
* 2012-02-29
** TODO do coverage prob separately
   :PROPERTIES:
   :ID:       3BDD878C-DFE5-4A87-9372-E63028E49416
   :END: 

** DONE try Gamma(3,1) , PTboot6.R , esp more obs like n=1k, , also check Reich on that
   CLOSED: [2012-03-07 Wed 14:17]
   foo6, PTboot6.R, fit6 @kelp , [[file:fit6.pdf]] [[file:foo6.pdf]]

** DONE PTdensity works quite well in Gamma(3,1) 
   CLOSED: [2012-03-01 Thu 15:00]

** DONE try mixing mu ? first from PTlm, no way. same. but try 1+x1 as X
   CLOSED: [2012-03-02 Fri 10:27]
   previously, the posterior density plot is  not like gamma at all. but
   later found it's just a location shift of gamma. so PTlm works.

** DONE compare hetergenous fit4 (PTlm) @tygro and foo4 @kelp, runs=10k, n=500
   CLOSED: [2012-03-07 Wed 11:13]
   [[file:fit4.pdf]] [[file:foo4-2.png]] [[file:foo4-1.png]]

* 2012-02-22 [[file:20120221-report.pdf]] [[file:20120222-report.pdf]]
** DONE get coverage
   CLOSED: [2012-02-28 Tue 14:58]
** DONE length of credible interval
   CLOSED: [2012-02-28 Tue 14:59]
** DONE get REich BQR running time : 5000 runs , 100=n, 480 = 6 min ; while for PT, 1000 runs, 400s
   CLOSED: [2012-02-28 Tue 16:18]
** TODO take look at sd(betahat - beta true/ betatrue)
   :PROPERTIES:
   :ID:       5F1B2B73-36C4-489F-8100-19E5F5184A5A
   :END:
** TODO numerical error when jump in mixing
   :PROPERTIES:
   :ID:       81B2BCEC-98DE-414B-A10B-142C48327ACB
   :END: 
** DONE take look at why PT at M2 tau=0.9 so small 
   CLOSED: [2012-02-23 Thu 14:13]
   cauz mod(y1~x)
** TODO why ALS se so small
   :PROPERTIES:
   :ID:       E15C8249-E90C-4884-ACDD-3655B4BB828B
   :END: 
** DONE PT M4 and M9 no good at all , see next
   CLOSED: [2012-02-25 Sat 02:25]
** DONE another M4 (IMPORTANT)
   CLOSED: [2012-02-24 Fri 00:45]
   - [X] w/ X=(1,x1,x2), M4 w/ mixture normal error , half N(-2,1),
     half N(2,1), boot=100 save time
	 -- myheterptlm13.R (@kelp, reich-simulation-4(3)-pt.R)
	 -- testBQRiid4(3).R (@tygro for tau=0.9, @shera for tau=0.5)
|-----+------------+------------|
|  M4 |         PT |        BQR |
|-----+------------+------------|
| 0.5 | 25.7(3.45) | 34.3(4.38) |
| 0.9 | 12.5(1.39) | 21.3(2.28) |
|-----+------------+------------|

** DONE RQboot1-5.R w/ RQboot.R, (@kelp)
   CLOSED: [2012-02-26 Sun 16:54]
** DONE ASLboot.R @kelp , ASLboot1-5.R (@kelp, crab, clam, plankton, shera)
   CLOSED: [2012-02-27 Mon 12:31]
** DONE PTboot.R w/ myheterptlm13.R (@kelp, crab, clam, tygro, shera)
   CLOSED: [2012-02-27 Mon 23:34]

** DONE BQRboot.R BQRboot1-5.R @croaker, plankton, clam, redroot, seaweed
   CLOSED: [2012-02-29 Wed 11:20]

** DONE simulation M1-4 
   CLOSED: [2012-02-29 Wed 11:20]
   - n=100
   - boot=100
   - M1: Xb+N(0,1)
   - M2: Xb+ 1/2 N(-2,1) + 1/2 N(2,1)
   - M3: Xb + ASL/DEXP(2)
   - M4: Xb + (Xgamma)*1/2 N(-2,1) + 1/2 N(2,1)
   - M5: Xb (x4 ~|t2|) + N(0,1)

MSE
|-------+------------+-------------+-------------+-------------|
| Model |       FBQR |         ASL |        QReg |          PT |
|-------+------------+-------------+-------------+-------------|
| M1.5  | 1.12(0.13) | 1.06(0.126) |  1.2(0.137) | 1.16(0.121) |
| M2.5  | 3.12(0.47) |  12.2(1.31) |   16.1(1.3) |  2.28(0.30) |
| M3.5  | 1.12(0.11) |  1.31(0.16) | 1.17(0.135) |  1.42(0.16) |
| M4.5  | 40.4(4.42) | 195.4(15.4) |   213(15.5) |  35.4(3.97) |
| M5.5  | 0.77(0.07) |  0.87(0.08) | 1.11(0.106) | 0.82(0.076) |
|-------+------------+-------------+-------------+-------------|
| M1.9  | 2.12(0.25) | 1.95(0.231) |  2.39(0.24) |  2.45(0.26) |
| M2.9  | 2.86(0.31) |  3.65(0.43) | 5.39(0.579) |  4.40(0.48) |
| M3.9  |  3.47(0.4) |  4.81(0.64) |  6.56(0.68) |  4.93(0.56) |
| M4.9  | 23.4(3.97) |  38.2(4.86) |  45.7(5.46) |  28.5(4.32) |
| M5.9  | 2.82(1.23) |  1.86(0.19) | 2.03(0.147) |  2.19(0.28) |
|-------+------------+-------------+-------------+-------------|

LENGTH for b2
|-------+------+-------+-------+------|
| Model | FBQR |   ASL |  QReg |   PT |
|-------+------+-------+-------+------|
| M1.5  | 0.45 | 0.664 | 0.422 | 0.44 |
| M2.5  | 0.81 |  1.22 |  1.38 | 0.59 |
| M3.5  | 0.52 |  0.68 | 0.416 | 0.52 |
| M4.5  | 2.37 |  2.79 |  4.25 | 1.38 |
| M5.5  | 0.45 |  0.71 |  0.42 | 0.43 |
|-------+------+-------+-------+------|
| M1.9  | 0.70 |  1.23 | 0.673 | 0.67 |
| M2.9  | 0.85 |  1.53 | 0.947 | 0.83 |
| M3.9  | 1.04 |  1.51 |  1.16 | 0.96 |
| M4.9  | 2.04 |  2.30 |  2.07 | 1.97 |
| M5.9  | 0.71 |  1.39 | 0.624 | 0.66 |
|-------+------+-------+-------+------|

LENGTH for b3
|-------+------+-------+-------+------|
| Model | FBQR |   ASL |  QReg |   PT |
|-------+------+-------+-------+------|
| M1.5  | 0.34 | 0.492 | 0.324 | 0.36 |
| M2.5  | 0.62 |  0.87 | 0.958 | 0.50 |
| M3.5  | 0.41 |  0.53 | 0.323 | 0.42 |
| M4.5  | 2.28 |  2.21 |  3.61 | 1.29 |
| M5.5  | 0.34 |  0.54 | 0.327 | 0.34 |
|-------+------+-------+-------+------|
| M1.9  | 0.51 |  0.93 | 0.738 | 0.53 |
| M2.9  | 0.67 |  1.22 | 0.977 | 0.69 |
| M3.9  | 0.76 |  1.13 |  1.64 | 0.78 |
| M4.9  | 1.91 |  1.94 |  2.38 | 1.79 |
| M5.9  | 0.54 |  1.04 | 0.826 | 0.51 |
|-------+------+-------+-------+------|

Coverage Prob
|-------+------+------+------+------|
| Model | FBQR |  ASL | QReg |   PT |
|-------+------+------+------+------|
| M1.5  | 0.94 |    1 | 0.91 | 0.97 |
| M2.5  | 0.97 | 0.88 | 0.87 | 0.94 |
| M3.5  | 0.98 | 0.99 | 0.92 |    1 |
| M4.5  | 0.91 | 0.56 | 0.84 | 0.71 |
| M5.5  | 0.95 | 0.99 |  0.9 | 0.99 |
|-------+------+------+------+------|
| M1.9  | 0.95 |    1 | 0.92 | 0.93 |
| M2.9  | 0.99 |    1 | 0.91 | 0.91 |
| M3.9  | 0.96 |    1 | 0.91 |  0.9 |
| M4.9  | 0.96 | 0.84 | 0.86 | 0.96 |
| M5.9  | 0.97 |    1 | 0.93 | 0.95 |
|-------+------+------+------+------|

** M4: runs=1k, convergence is bad for M2-M4 PT, try increasing runs->10k , fine for M1, and M5
   even for runs = 10k, still bad. 
** DONE test M6: e ~ Poisson( 3) ? PTboot6.R
   CLOSED: [2012-02-29 Wed 13:14]
   plot weird, even for PTlm 

* 2012-02-15 
** DONE test FBQR : testBQRiid*.R  (kelp, crab, clam, plankton, shera) tau=0.9 ; see [[file:20120208-report.pdf]]
   CLOSED: [2012-02-17 Fri 13:28]
** DONE try revise myheterptlm12.R , simplify log normal candidate
   CLOSED: [2012-02-17 Fri 13:28]

** TODO test M4
   :PROPERTIES:
   :ID:       13FE87B7-70FA-428D-B9EE-01D4F18BC3D1
   :END: 
   - [X] w/ myheterptlm12.R (since previously FBQR still best) kelp ,
     see [[file:20120208-report.pdf]] still larger than BQR for M4 tau=0.9
   - [X] w/ X=(1,x1,x2) , suspect X=(1,x3) make it fail 
	 -- w/ BQRiid (@tygro, testBQRiid4(2).R) 
	 --- tau=0.5 , w/o int, 7.66(9.7)
	 --- tau=0.9 , w/o int, 14.1(16.6)
	 -- w/ myheterptlm12.R  (@plankton, reich-simulation-4(2).R)
	 --- tau=0.5, w/o int, 8.90(12.1)
	 --- tau=0.9, w/o int, 14.1(17.3)
   - PT is  not assumed to beat BQR in M4, since M4 is also mixture of
     heterogeneous normal 
   - add onepage=TRUE parameter to posteriorplot3.R
   - [X] present alhamzawi-yu-2011 paper , especially simulation , may
     follow that simulation 
   - [X] try to do the same simulation in alhamzawi-yu-2011.pdf @crab alhamzawi-simulation-1.R
	 -- which is true beta , after test, should be:
         beta+gamma*F^-1(tau)
   - convergence rate may be different, Reich's BQR default  5000,
     mine PT is 1000
** print code myheterptlm13.R, ptquantile.R , posteriorplot3.R , loglik_unippt.f, 

** seems like runs=1000 is not enough for convergence, what to do  for MCMC simulation

* 2012-02-08 : [[file:20120208-report.pdf]]
** TODO do more iteration for M2 and M3, for 5 datasets
   :PROPERTIES:
   :ID:       459FC284-5D01-482B-9904-863BB7B4BD7D
   :END:
** TODO get coverage rate , build credible interval for each dataset, see if cover the true value
   :PROPERTIES:
   :ID:       D102BC8C-A841-4E0E-97D4-42FEE006496C
   :END: 
** TODO check qreg function for standard deviation (check manual)
   :PROPERTIES:
   :ID:       672F3F82-0080-483E-A830-1BCA1B103140
   :END:
** report sd as sd/sqrt(200)
** DONE revise myheterptlm10.R to myheterptlm11.R , sample beta and gamma as a vector 
   CLOSED: [2012-02-10 Fri 23:12]
** review Jara paper 
** not much property in other's paper about PT (see qr-review.org / qr-review.tex)
** DONE test FBQR : testBQRiid*.R  (kelp, crab, clam, plankton, shera) tau=0.5
   CLOSED: [2012-02-17 Fri 13:28]
** DONE revise myheterptlm11 to myheterptlm12.R ( with same prior and candidate with PTlm.R) (test in tygro)
   CLOSED: [2012-02-14 Tue 23:24]

** DONE without intercept , beat them 
   CLOSED: [2012-02-15 Wed 15:20]

* 2012-02-01 : report: 20120201-report.pdf [[file:20120201-report.pdf]]
** TODO find dataset and make comparison
   :PROPERTIES:
   :ID:       7CF6287F-12EF-4D4F-8EEF-7204F247B8BF
   :END:
   - try look at Reich 's paper for dataset 
   - reich-simulation 1-5.R (kelp, crab, clam, plankton, shera)
   - for M1 reich, 10 time MSE than quantreg, consider 
     - may should use beta(tau) = beta + gamma*F^-1
     - optimize myheterptlm9.R : simultaneously sample vector
     - nonparametric may lose some power
     - test for other complicated case  
     - [ ] X=(1,x1,x1^2)
   - [X] code myheterptlm10.R from myheterptlm9.R
     - beta(tau) = beta + gamma* F^-1(tau) for each iteration
     - return(beta(tau)) vector
     - also return F^-1(tau)
   - [ ] code for FBQR
   - [X] code for ASL , Yu 2001??  yu-mcmc.R ( tygro)
   - why exclude the intercept when calculating MSE ?
*** simulation
    - reich-simulation*.R (kelp, crab, clam, plankton, shera)
    - yu-mcmc.R (testyu-mcmc.R) (tygro)
    - qreg.R 
    - see 20120201-report.pdf
** for my model, we can get beta(tau) for several tau simultaneously, while for ASL, quantreg and Reich BQR,  they need to fit separate model 
** Literature:
*** RUbbery Polya Tree , Nieto, 
    We propose a generalization of the PT that reduces the undesirable
    sensitivity to the choice of Î . To reduce the impact of the partition
    on statistical inference, we allow the random variables  to be
    dependent within the same level m, but keeping the independence
    assumption between different levels. This defines a new RPM that still
    belongs to the class of tail-free processes, and thus inference will
    still depend on the choice of partitions. But the random probabilities
    of the partitioning subsets vary in a smoother fashion across the sets
    in each level of the partition tree. The only tail-free process
    invariant to the choice of partitions is the DP. To keep the new prior
    comparable with the original PT we continue to use beta distributions
    as the marginal distributions for each Y. This is achieved by
    considering a stochastic process with beta stationary distribution as
    prior for . The construction of the process is defined in such a way
    that for a specific choice of the hyperparameters we recover
    independence of the Ys within the same level and thus having the
    regular PT as particular case.
    
    - being a tail-free distribution is a condition for posterior
      consistency (Freedman, 1963; Fabius, 1964).
    - propositon: rPT = PT marginally
    - corollary: absolutely cts
    - corollary: posterior consistence 

* 2012-01-30
  - if it's easier to extend to multivariate case with quantiles with
    polya tree and mixture of DPs

* 2012-01-27
  - send dropbox folder 
  - find dataset email
  - send draft
  - find Hogan, sinica paper, no bayesian
* 2012-01-19
  - betahat ( tau) = hat( beta + gamma*F^-1 ) , directly, not  plug-in
    estimate
  - look at L(y1, .., yn|beta) directly , find var or something else. 
  - check Yu-2001 for posterior under an improper prior
  - read Lum-gelfand paper.
  - read Kim-Yang-2012-JASA.pdf 
  - read Kottas-Krnjajic-2009 paper 

* 2012-01-12
** TODO test Koenker 2005, p13-14 , heter model , test0111.R,
   :PROPERTIES:
   :ID:       CA849C0F-E8B6-4CAE-BA40-EE40F2985D9E
   :END: 

* 2011-12-08
* 2011-11-30
** TODO check ton's of paper review, reference
   :PROPERTIES:
   :ID:       5C687949-031B-4F97-8B48-61EDA7B8845C
   :END: 
* 2011-11-16
** DONE check revised paper 
   CLOSED: [2011-11-21 Mon 10:24]
** DONE reference: check out missing + quantile regression
   CLOSED: [2011-11-22 Tue 13:59]
   - Yoon-2010
   - Yuan-2010 print (good review on correlated quantile regression)
By inversely weighting the estimating equation with the
probability of dropout, Lipsitz et al. (1997) studied QR for
longitudinal data with ignorable dropouts. Noting that the
classical random-effects model can be reformulated as a pe-
nalized least-square estimation, Koenker (2004) developed
a1-regularization QR method to shrink individual effects to-
ward a common value. Geraci and Bottai (2007) proposed
a random-effects QR model for longitudinal data based on
the asymmetric Laplace distribution (ALD; Yu and Moyeed,
2001), in which the within-subject correlation was modeled by
random intercepts. Other applications of quantile regression
in correlated data include the work of Cole and Green (1992),
Jung (1996), and Heagerty and Pepe (1999), among others.

no distribution assumption for error in the conclusion part /?

   - Sun-2011
* 2011-11-09
** DONE find the true correlation of e41 and e42 in model 10 and 12
   CLOSED: [2011-11-17 Thu 10:30]
   - -0.589 ?
** TODO maybe can tune baseline measure firstly on independent marginal distr'n and then tune scaled parameters
   :PROPERTIES:
   :ID:       E4BF3CBE-58FC-4C20-958A-9EE415F1A1A9
   :END: 
** TODO turn to bimodel bivariate normal distribution for e2
   :PROPERTIES:
   :ID:       1A302F59-51D5-4BD3-A273-1513D6332304
   :END: 
   - MM3-7 rho ?? = cov , not cor , 1114
   - MM3-8 1114
** TODO try plot 3d picture of those samples  (plot ee[1,] vs ee[2,])
   :PROPERTIES:
   :ID:       22CE557C-9D52-4B67-980F-5AA50F0BF202
   :END:
** TODO think about how baseline measure affect the computation convergence ?
   :PROPERTIES:
   :ID:       C21325B0-78DD-4B34-B4FD-1435881F1B8F
   :END:
** DONE can get posterior marginalized quantile of error without mentioning the X, maybe can integral out X from hanson 2006 p1551 equation 5,and 6,7
   CLOSED: [2011-11-14 Mon 19:13]
   - integral out equation 6 in terms of script X
** Reference : 
   - Spatiotemporal quantile regression for detecting distributional changes in environmental processes : Reich 2011
   - Bayesian Spatial Quantile Regression, Reich 2011,
   - noncrossing quantile regression curve estimation, Bondell 2010 
   - Bayesian quantile regression for count data with application to
     environmental epidemiology

** TODO check out asymptotic property
   :PROPERTIES:
   :ID:       8E03B2E1-9D1C-4704-A1A0-9E466B9A4F31
   :END: 

   
* 2011-11-02
** DONE get posterior inverse cdf from univariate estimates , revise to myheterptlm9.R , add ptquantile2.R into it. 
   CLOSED: [2011-11-16 Wed 15:07]
** DONE revise ptquantile.R to ptquantile2.R for posterior inverse cdf, adding cpar, tau vector 
   CLOSED: [2011-11-02 Wed 13:46]
** DONE test another simulation model (add cov into error distribution) M5-6 (Normal) M7-8 (mixed normal + normal + cov) testmyhetermpt3.R
   CLOSED: [2011-11-04 Fri 19:26]

   - MM3-5  [[file:MM3-5-1104-beta.pdf]]  [[file:MM3-5-1104-gamma.pdf]]
   - MM3-6  [[file:MM3-6-1104-beta.pdf]]  [[file:MM3-6-1104-gamma.pdf]]
** DONE can test correlated bimodel with normal ?
   CLOSED: [2011-11-11 Fri 14:05]
   - both are good. 
   - MM3-7  [[file:MM3-7-1108-beta.pdf]]  [[file:MM3-7-1108-gamma.pdf]]
   - MM3-8  [[file:MM3-8-1108-beta.pdf]]  [[file:MM3-8-1108-gamma.pdf]]
   - sample may be bias or not sufficient : copula rho=0.3 for MM3-7 MM3-8

** DONE check Hanson and Johnson's paper (in terms of e), or QR literature (y=x*beta+e) in terms of beta
   CLOSED: [2011-11-16 Wed 15:07]
   - Hanson Johnson 2002: p1023  predictive density can be
     discontinuous at 0 because 0 in pi_theta for all theta

** TODO add posterior (predictive ) density plot for MPT
   :PROPERTIES:
   :ID:       EBBDD340-9942-4FC9-AC1B-612C86BC9D57
   :END: 
** TODO check paper reference: Chaudhuri and Loh: Nonparametric estimation of conditional quantiles using quantile regression trees.
   :PROPERTIES:
   :ID:       E635C235-B303-48E2-A5D1-DB5B1D922F6A
   :END:
** DONE check the chapter in some book : DP and PT
   CLOSED: [2011-11-16 Wed 15:07]
   - p113: Because the DP sit on discrete measures, so does any
     mixture of these and hence they are unsuitable as priors for
     densities. For the same reason, it is also inappropriate for the
     parametric part of a semiparametric problem. For example,
     Diaconis and Freedman show that the Dirichlet prior in a location
     parameter problem can lead to pathologies as well as
     inconsistency of the posterior for even reasonable "true"
     densities. 
** DONE check out Reference : 'Wild bootstrap for quantile regression' (Feng, Xu, Hu) 
   CLOSED: [2011-11-16 Wed 15:07]
   - wild bootstrap for heteroscedasticity


   
* 2011-10-26
** DONE literature review from Mike's book, Rubin 1976 (Annals) to now or Little 1990's mixture model ?, key word: Bayesian , missing , incomplete, 
   CLOSED: [2011-11-03 Thu 11:54]
   - 195+234 paper
   - title include keyword
   - no bayesian network
   - no application 
   - [ ] some about quantile regression , need check
   - see Google docs, and [[file:~/Documents/RA/list.pdf]]

** DONE following myheterptlm8.R and myhetermpt2.R -> myhetermpt3.R 
   CLOSED: [2011-10-28 Fri 11:11]
   - M1: [[file:MM3-1-1027-beta.pdf]]  [[file:MM3-1-1027-gamma.pdf]]
     y = x*beta + e1 , 
   - M2: [[file:MM3-2-1027-beta.pdf]]  [[file:MM3-2-1027-gamma.pdf]]
     y = x*beta + e2 (e21 ~ Normal, e22 ~ bimodel )
   - M3: [[file:MM3-3-1027-beta.pdf]]  [[file:MM3-3-1027-gamma.pdf]]
     y = x*beta + (x*gamma)*e1
   - M4: [[file:MM3-4-1027-beta.pdf]]  [[file:MM3-4-1027-gamma.pdf]]
     y = x*beta + (x*gamma)*e2
** DONE posteriorplot4.R for myhetermpt3.R 
   CLOSED: [2011-10-27 Thu 12:51]

   
* 2011-10-12
** TODO fix myheterptlmp.f, write my own c function to let fortran call them (see function-needed-list.txt) : myToolsRfun.c
   :PROPERTIES:
   :ID:       A27B08AA-5734-4631-B36A-D2F9F1691743
   :END: 
   - R CMD SHLIB myheterptlmp.f myneededfunction2.f myToolsRfun.c ToolsRfun.c 
   - loglik_unippt : in myneededfunction2.f
   - ToolsRfun.c (clean invcdfnorm.c -> myToolsRfun.c, not to make multiple definition
     of function)
   - myToolsRfun.c 
   - [X] in myheterptlmp.f, when generating random variable, rndstart
     first and rndend last
   - debug myheterptlmp.R/myheterptlmp.f  : log-sigma some problem  ,
     bug in acceptance step : maybe myrunif , no myrunif(a,b)
   - now fix myrunif in myheterptlmp.f , good until MCMC ends
   - Error in dimnames(x) <- dn : 
     length of 'dimnames' (2) not equal to array extent
   - never accept , something wrong with acceptance procedure
   - found myrunif(0,1) return NaN, because defined :'real myrunif'
     not 'real*8 myrunif' not only this
   - should be myrunif(0.d0, 1.d0)
   - not update again  for heter model, but good for homo model 
   - [X] plot.ptlm function not plot gamma parameter well 
   - [X] plot.ptlm no residual plot
   - [ ] check heter model gamma parameter
   - [X] gamma did not update?
   - [ ] now gamma problem fixed, but for heter model, gamma not right ?
   - [ ] check what's identifiability problem for a semi parametric model
   - [X] check gamma  and residual.
   - [ ] alpha 
   - [X] plot no gamma3 
   - weird mixing somehow for heter model 
   - when error is normal , quite good for mixing :fit1.3.2

   - simulation 
     -- M3 terrible 

*** TODO try myheterptlmp.R with updating componentwisely into myheterptlmp2.R
    :PROPERTIES:
    :ID:       C2963038-6055-457A-9A2A-03AF5FFD9B59
    :END:

** TODO check heteroskatic model (He 1997) in Reich 2009
   :PROPERTIES:
   :ID:       9BBCEB54-CD43-429A-ABBB-1ACC1F01B725
   :END:
   - he set median(e) = 0, |e| has median 1 , x'gamma >0 
   - heteroscedastic model see *Gutenbrunner and Jureckova (1982)* and
     *Koenker and Zhao (1994)*
   - 3 procedure for his RRQ
** TODO try y = xb + e , make (e tau quantile ) 0 using myhomolmp.f ?
   :PROPERTIES:
   :ID:       5E6D8BDE-6005-4985-9451-805F143B8004
   :END:

** DONE fit y= x*beta + x*gamma*e, e~Normal(0, sigma^2) , test MCMC on gamma : myheterlm.R
   CLOSED: [2011-10-23 Sun 15:46]
   - gamma mixing bad [[file:polyatree/code/myheterlm.pdf]]
   - try another gamma likelihood
   - but when use X=(1,x,x^2, y,y^2), perfect [[file:polyatree/code/myheterlm.pdf]]
** DONE ABOUT myheterptlm7.R , more simulation
   CLOSED: [2011-10-24 Mon 19:16]
   - M2, normal error , heter model, p=3, gamma=c(1,0.5,.5) , perfect
     good. [[file:polyatree/code/M2-7-1017.pdf]]
   - M3, bimodel error, hetermodel p=3,  gamma=c(1,0.5,.5) , i think
     good, [[file:polyatree/code/M3-7-1017.pdf]]
   - M3, bimodel, p=5 , gamma=c(1,0.5,0.5,0.5,0.5) , perfect after
     *fix X* [[file:polyatree/code/M3-7-4-1023.pdf]]
   - M3, bimodel , p=5, gamma=rep(1,5), perfect,
     [[file:polyatree/code/M3-7-5-1024.pdf]] 
   - M3, bimodel, p=5, gamma=(1,0.50.50.50.5), beta=1:5, perfect 
     [[file:polyatree/code/M3-7-6-1024.pdf]] 
** DONE MCMC y= (x*gamma)*e, e~N(0, sigma), myheterlm2.R , Perfect, fix X, [[file:polyatree/code/myheterlm.pdf]]
   CLOSED: [2011-10-24 Mon 13:55]
** DONE try to get predictive density function throught plot.ptlm function , and inplement it into posteriorplot2.R also modify to myheterptlm8.R
   CLOSED: [2011-10-28 Fri 11:14]
   - M3 , good,      [[file: M3-8-1-1024.pdf]] 
   - M1 :   [[file:M11-8-1025-beta.pdf]] [[file:M11-8-1025-gamma.pdf]] 
   -M2 :   [[file:M22-8-1025-beta.pdf]] [[file:M22-8-1025-gamma.pdf]] 
   -M3 :   [[file:M33-8-1025-beta.pdf]] [[file:M33-8-1025-gamma.pdf]] 
   -M4 simulation :   [[file:M44-8-1025-beta.pdf]] [[file:M44-8-1025-gamma.pdf]] 
** TODO what to do next? consistency ? efficiency ? CLT ?
   :PROPERTIES:
   :ID:       94C6DD53-8F70-41DD-BF94-2DC75F80ED93
   :END:
** DONE modify posteriorplot2.R to posteriorplot3.R , 5*3, and error , which fit into tex file (8*10 inch) for myheterptlm8.R 
   CLOSED: [2011-10-26 Wed 12:32]

* 2011-10-05
** DONE draft abstract for ENAR [[file:enar-abstract.txt]]
   CLOSED: [2011-10-05 Wed 19:09]
** DONE review (Hanson 2006) and (Jara 2009)
   CLOSED: [2011-10-08 Sat 17:28]
   - Hanson 2006 focus on non-marginalized 
   - change drastically for different value of c
   - c goes to 0,  likelihood more diffuse
   - fitting a model with a large number of levels J and random or
     small c can be problematic if data are unlike any member of base
     measure and n is large 
   - proposal a constant times the estimated asymptotic covariance
     matrix from a ME fit of the underlying parametric model, would be
     good 
   - Bayes factors as model comparison
   - when the prior on c favors small values and data are unlike the
     centering distribution, MCMC mixing can be poor. 
   - Jara (2009) better represent the distributional uncertainty and
     to avoid the effects of the misspecification
   - on marginalization , the infinite dimensional process G no longer
     needs to be partially sampled , and inference is exact up to MCMC
     error 
   - c* ~ Lognormal(log c(t-1), tc) 
   - p846 adaptive Metropolis entirely automate the process ?? ask
   - how he knows the best tuning parameter for acceptance rate 
   - upadte O: bij~N(bij, tb)
   - simulation data: 1. bivariate normal 2. mixture of bivariate
     normal 
   - burn-in 20k + 40*20k = 820k scans 
   - dimensions above 4 make the implementation practically impossible 
   - how he gets those acceptance rate 

** TODO try MCMC on c  : myheterptlm6.R -> myheterptlm7.R (add c MCMC ) also, write myloglik_unippt.f , adding cpar ; acutally ,
   :PROPERTIES:
   :ID:       0930F344-6E2F-4331-9CDD-0939A03C458E
   :END: 
   no need, since alpha parameter in ToolPT.f 
   - M1, p=2 , [[file:polyatree/code/M1-7-2-1009.pdf]] fine
   - M1, p=5, [[file:polyatree/code/M1-7-5-1009.pdf]] seems good, but
     mixing bad, especially for b0.
   - M1, p=2, beta=(1,1) , [[file:polyatree/code/M1-7-2-2-1010.pdf]] fine,
     but not good for b0
   - M1, p=5, beta=(1,1,1,1,1) , [[file:polyatree/code/M1-7-5-2-1010.pdf]]
     estimates good, mixing good, except for b0
     better than myheterptlm6 on (1,1,1,1,1) , file:polyatree/code/M1-6-5-1012.pdf
** TODO try revise PTlmp.f to myheterptlmp.f (add gamma part) , myheterptlmp.R , testmyheterptlmp.R
   :PROPERTIES:
   :ID:       99E5F89F-335B-455F-9017-3DB2F6E7654A
   :END:
   function needed list : [[file:polyatree/code/function-needed-list.txt]]
   put every function I need into myneededfunction.f 
   cut posterior predictive error first to make the function go through 
   R CMD SHLIB myheterptlmp.f ToolsPT.f ToolsMatrix.f ToolsDistributions.f ToolsRfun.c ToolsRnumbers.f ToolsRandlib.f ToolsCdflib.f ToolsSparseMatrix.f 

* 2011-09-28
** TODO try X~ N(0,1)
   :PROPERTIES:
   :ID:       CDF7C765-651E-4FBA-BAFC-4868EE8FB6ED
   :END:
   - M1 , p=5, awful also. 
** TODO try center X
   :PROPERTIES:
   :ID:       E944FA16-C319-42FB-8FCE-90DB73BF0B37
   :END:
** DONE think about whether the choice of Base Measure affect the posterior , if M goes to infinite  
   CLOSED: [2011-10-08 Sat 15:34]
** TODO think about shrinking gamma to 0 (like LASSO)
   :PROPERTIES:
   :ID:       6DBF018B-373E-4044-BA3A-ECA225A39714
   :END:
** TODO update multivaraite likelihood in the paper
   :PROPERTIES:
   :ID:       999C059B-E1FD-4C63-9E75-58BFD8F751FA
   :END:
** TODO think about identifiability problem of gamma and sigma/Sigma
   :PROPERTIES:
   :ID:       7C112384-1CA8-4265-8A99-8B3E21010A2F
   :END:
** DONE revise intern report , rerun code, add tables and plots
   CLOSED: [2011-10-04 Tue 20:49]
** DONE read Lavine's paper more
   CLOSED: [2011-10-08 Sat 17:28]
   - DP is the only tailfree process in which \Pi does not play an
     essential role (Lavine 1992)
   - with mixture of PT, the problem of dependence on the partitions
     is not as critical (Lavine 1992) p1230
   - Hanson(2002) mention the advantage of mixing (p 1021)
   - Hanson 2002 p1024 mention: mixture of pT also eliminates the need
     to choose a centering distribution with adequate spread in an ad
     hoc way 
   - Hanson 2002 exmaples use twod different base measure : normal and
     logistic. the resulting predictive densities are practically
     indistinguishable . he find little difference in inferences
     obtained from normal, logistic, or extreme value base measures
     unless c is fixed to be very large.

* 2011-09-20
** DONE tune betac ~ N(beta, tune_i) componentwise 
   CLOSED: [2011-09-22 Thu 16:29]
*** DONE revise myptlm2.R to myptlm3.R : M1-0922.pdf [[file:polyatree/code/M1-0922.pdf]] [[file:polyatree/code/M1-2-0922.pdf]]
    CLOSED: [2011-09-23 Fri 14:02]
found an error in myptlm2.R (acc2=acc+1) 
acceptance rate is very low. need to check tuning parameter trace plot 

update to begin with ls est for beta 
** DONE PTlm.R MCMC mixing plot : check 2011-09-14 for detail
   CLOSED: [2011-09-22 Thu 16:29]
** DONE not tune after burn 
   CLOSED: [2011-09-22 Thu 16:29]
** DONE try tuning all the time in myptlm3.R : myptlm4.R foo1.4 [[file:polyatree/code/M1-4-0923.pdf]] still not good, acceptance rate too low.
   CLOSED: [2011-09-24 Sat 00:29]
** TODO study tuning
   :PROPERTIES:
   :ID:       5AA21F68-2209-49FB-9A33-77D3E9E04558
   :END:
** DONE found  MHrate for beta wrong with long sentence splitted  , corrected. 
   CLOSED: [2011-09-25 Sun 13:54]
simulation : foo1.5 : good [[file:polyatree/code/M1-5-0924.pdf]] by myptlm3.R

** DONE update myheterptlm5.R into updating componentwisely, : myheterptlm6.R , test M2: foo5.2 foo5.2.2 , M3: foo6 
   CLOSED: [2011-09-27 Tue 15:22]
   M1: foo6.1 p=5 awful [[file:polyatree/code/M1-6-0926.pdf]]

   foo6.2 p=2 perfect [[file:polyatree/code/M1-6-2-0926.pdf]]

   redo foo6.1 p=5 still awful

   try p=3 ? perfect , quite good, [[file:polyatree/code/M1-6-3-0926.pdf]]

   M2: still beta good, gamma weird, seems tend to be large
   [[file:polyatree/code/M2-5-0924.pdf]]
   need to check can 

   but for p=2, gamma=(1,1) , M2: foo5.2.2,
   [[file:polyatree/code/M2-5-2-0924.pdf]] , good mixing 

   M3: p=2 foo6, [[file:polyatree/code/M3-lm6.pdf]] good 

   M3: p=5 foo6.2 [[file:polyatree/code/M3-lm6-2.pdf]] beta good, sigma not
   good, 

   M3: p = 5, 20k, foo6.2.2 [[file:polyatree/code/M3-lm6-2-2.pdf]] beta good,
   sigma still weird.

   M3: p=3 foo6.3.3 kind of ok, but weird /same /similar mixing plot ?
   sparse, check [[file:polyatree/code/M3-lm6-3.pdf]]

*** TODO check Reich BQRiid's gamma for p=5
    :PROPERTIES:
    :ID:       27DE7F16-4409-4BE0-8A30-CE3BCBCA1368
    :END:
*** TODO check MHrate for gamma ?
    :PROPERTIES:
    :ID:       87B5742E-BC2C-475F-9055-01308FB81ED2
    :END:

** TODO generalized to multivariate case
   :PROPERTIES:
   :ID:       2DBCFFD9-3417-455B-9193-F6A16827B1E0
   :END: 
*** TODO first revise myhomompt1.R to myhomompt2.R (following myheterptlm6.R) update componentwisely , including Sigma(componentwise), dnoe.
    :PROPERTIES:
    :ID:       7AB3D0FE-4AE0-40A6-A793-79BC761A8C7C
    :END: 
    detlogl_0 should be 0 instead of 1
    - awful, but sigma matrix perfect. beta did not update at all . 
    - guess the tuning parameter still too large, try BQRiid's tuning,
      *.5, * 1.5
    - but the sigma matrix did update move 
    - mhrate for beta is 0 all the time , but betac is moving 
* 2011-09-14
** check Shorr's paper Page 9-12
** change can/tuning parameter in myhomoptlm3.R
** DONE add progress bar in myhomoptlm3.R /myptlm2.R
   CLOSED: [2011-09-15 Thu 23:53]
** DONE check PTlm.R 's MCMC convergence : [[file:polyatree/code/homo-bimodel-PTlm.pdf]]
   CLOSED: [2011-09-15 Thu 23:53]
** DONE check myptlm2.R/myhomoptlm3.R for bimodel MCMC convergence:  [[file:polyatree/code/homo-bimodel-myptlm2.pdf]]
   CLOSED: [2011-09-16 Fri 08:49]
** DONE cummean for PTlm.R [[file:polyatree/code/homo-bimodel-PTlm-cummean.pdf]]
   CLOSED: [2011-09-16 Fri 18:13]
   nscan=nburn +(nskip +1)nsave
   nsave=10k
   nskip=20
   nburn=5k
** DONE add    nscan=nburn +(nskip +1)nsave in myptlm2.R (have not talked to Daniels)
   CLOSED: [2011-09-16 Fri 18:15]
[[file:polyatree/code/homo-bimodel-myptlm2-10k-new.pdf]]
[[file:polyatree/code/homo-bimodel-myptlm2-cummean-10k-new.pdf]]

** DONE revise myheterptlm3.R to myheterptlm5.R
   CLOSED: [2011-09-17 Sat 23:44]
   results not good. sigma seems weird. try normal candidate for
   myptlm2.R -> very good 
** DONE try normal candidate for sigma variable (myheterptlm5.R) 
   CLOSED: [2011-09-19 Mon 21:10]
   results good for homo-bimodel 'M1'
   record [[file:polyatree/code/M1.pdf]]
** DONE compare likelihood for different sigma in the baseline measure
   CLOSED: [2011-09-18 Sun 21:09]
   e3 on N(0,1) vs N(0,3) : log(3) > log(1)
** DONE check myheterptlm5.R with heter-normal. beta=c(1,2) gamma=c(1,1) foo2
   CLOSED: [2011-09-19 Mon 21:10]
M2: [[file:polyatree/code/M2.pdf]]
** DONE check myheterptlm5.R with heter-bimodel b=(1,2), Gamma=(1,1) foo3 M3 [[file:polyatree/code/M3.pdf]]
   CLOSED: [2011-09-19 Mon 21:10]
** DONE b=(1,2,3,4,5) g=c(1,1,1,1,1) M4 : [[file:polyatree/code/M4.pdf]]
   CLOSED: [2011-09-19 Mon 21:11] 
   gamma awful

* 2011-09-07
  - dont use Wishart(smallest df,..) , instead, use sigma11, sigma22, rho,
componently
  - type to see whether intuition make sense about marginalized
    inference (univariate from multivariate)
  - MCMC try to be conservative   
** DONE check how Reich did for heterogeneity in multivariate case
   CLOSED: [2011-09-13 Tue 22:27]
#        MHrate<-sum(dnorm(resids,cansigh*mmm,cansigh*sss,log=T)-
#                    dnorm(resids,sigh*mmm,sigh*sss,log=T))+
#                dnorm(cangamma[s],0,1,log=T)-dnorm(gamma[s],0,1,log=T)

** some problem with myheterptlm3.R , not good for p=5, b=c(1,2,3,4,5), even homo model, try code for myhomoptlm3.R
** found a bug in myhomoptlm3.R/myheterptlm3.R, mdzero should be 1, to fix mu=0. correct in myhomoptlm3.R .
** still not good for beta0, seems converge very slowly. try separately mcmc(tune) beta component for myhomoptlm3.R.
very slow when updating componentwise
* 2011-08-31
** TODO test e1~bimodel vs indep e2~ normal , and get marginal
   :PROPERTIES:
   :ID:       E6810F79-C9AE-4B3D-8F77-FE216175FD30
   :END: 
** TODO get marginal cdf estimatation from MPT
   :PROPERTIES:
   :ID:       DEE63689-1460-489E-8250-3E5B7BA89685
   :END:
** DONE flat prior on Sigma ?
   CLOSED: [2011-09-13 Tue 22:41]
no. for 2*2, prior on each component separately
** TODO check myhetermpt1.R
   :PROPERTIES:
   :ID:       83858003-C987-4E95-AD3E-C633BE746413
   :END: 
** DONE check myheterptlm3.R 's sigma whether it goes to enormous large
   CLOSED: [2011-09-13 Tue 22:40]
no . it has a upper bound. see m1-mcmc.pdf for detail. (qr-polya.tex
simulation part)
** TODO try to type them: qr-polya.tex
   :PROPERTIES:
   :ID:       2FD48560-58EC-4671-AF41-4C6AB3F34B4F
   :END:
** TODO  test
   :PROPERTIES:
   :ID:       1E0B153D-4EF7-4F5C-B003-7DFD8CB29730
   :END:
   1. [ ] homo normal
   2. [ ] homo bimodel
   3. [ ] heter normal
   4. [ ] heter bimodel    

* 2011-08-24 
    myhomompt1.R, myhetermpt1.R , no tuning so far. report: testmyhetermpt1.tex

mike mention: priors should be difuse , not too tight, like variance*10. 
also 

* 2011-08-07
** TODO check partially specified Polya Tree and fully specified one
   :PROPERTIES:
   :ID:       2B5291B9-6B1D-4010-A4D4-18801C3150AE
   :END:
** TODO ask about theory part.
   :PROPERTIES:
   :ID:       B9A2D744-2047-47D0-BA50-E915067CC0FD
   :END:    
* 2011-05-29
** TODO generalized to multivariate case (write down scratch first)
   :PROPERTIES:
   :ID:       1556DCB1-7EA2-4169-8AFD-DC23EC7A753F
   :END:

* 2011-05-25
  1. Hanson(2002) mentioned p1024: inefficiency in MCMC
  2. the partition is critical
  3. check prior for sigma(theta)
** DONE back to Jara/Hanson's framework, mixed polya tree, marginalized PT, myheterptlm3.R 
   CLOSED: [2011-05-28 Sat 19:17]
   1. multivariate normal candidate and prior for beta and gamma
   2. 
** small tips for chasing mixing plot, choose sample of them, every 50 of them
** DONE simulation : simulation0527.R
   CLOSED: [2011-05-28 Sat 19:17]
   b = [2,5] ,    gamma = [1,2], n = 500, runs = 100000  , X[,2] ~ unif(0,2)

   a) data plot: 
     - hist(y)
     - y vs X[,2]
   b) estimates: mean of afterburn 
   c) mixing: b0, b1, gamma2, sigma
   d) posterior residual density
   e) estimates for any quantile , formula
      
   - y = x*b + e2 ~ N(0,1)
   - y = x*b + (x*gamma) * e1 
   - y = x*b + (x*gamma)*e2 ~ p*N(-2,1) + (1-p)*N(2,1)
** DONE check posterior sigma close to upper bound (var(y)) [[file:polyatree/code/post-sigma.pdf]]      
   CLOSED: [2011-06-01 Wed 13:22]
** DONE get other quantile for simulation0527.R     
   CLOSED: [2011-06-01 Wed 13:25]
| Model | tau  |   0.25 |    0.5 | 0.75 |    0.9 |
|-------+------+--------+--------+------+--------|
| M2    | Q    | -0.585 | -0.016 | 0.57 | 1.1839 |
|       | TRUE |  -0.67 |      0 | 0.67 |   1.28 |
|-------+------+--------+--------+------+--------|
| M1    | Q    |  -1.87 |  -0.02 | 2.04 |   3.16 |
|       | TRUE |     -2 |      0 |    2 |        |
|-------+------+--------+--------+------+--------|
| M3    | Q    | -1.909 |  -0.02 | 2.06 |   3.17 |
|       | TRUE |     -2 |      0 |    2 |        |
   
* 2011-05-18
** DONE mywallickptqr.R: 
   but results seem not good
   add f(res), much better for N(0,1) error , homo, 
*** DONE add f(res) test bimodel
    CLOSED: [2011-05-24 Tue 14:54]
    beta estimates are good: 
    mixing are fine:  [[file:polyatree/code/20110524a.pdf]]
    residual plot look fine for bimodel : [[file:polyatree/code/20110524b.pdf]]    
*** DONE add f(res) to test posterior density for bimodel: testposterior.R
    CLOSED: [2011-05-24 Tue 14:54]
    M must be large, n should be large, residual fine : [[file:polyatree/code/20110524c.pdf]]
*** DONE test 0.9/0.75 quantile , for homo, standard normal
    CLOSED: [2011-05-24 Tue 21:09]
    1. 0.75: 30k runs, 500 obs, est = [2.4, 2.1] , qnorm(0.75) = 0.67
       res vs X[,2] : [[file:polyatree/code/20100524d.pdf]]
    2. 0.9 : 30k , 500 obs, est = [3, 1.97] , qnorm(0.9) = 1.28
       res vs X[,2] : [[file:polyatree/code/20100524e.pdf]]
*** TODO test 0.9 / 0.75 quantile , for homo, bimodel
    :PROPERTIES:
    :ID:       D7B30B29-7C6C-4D7F-9761-035A8FAB4D6D
    :END: 
** DONE code for heter model: myheterwallick.R
   CLOSED: [2011-05-24 Tue 21:31]
   some potential problems: 
   1. large gamma ? 
   2. small sample size ?
   3. extreme quantile
   4. X%*%gamma too restrictive 
*** DONE test on heter, median, standard normal
    CLOSED: [2011-05-25 Wed 00:04]
    100k runs, 500 obs, betahat = [1.15, 2.2], gammahat = [1, 0.55]
    mixing plot : [[file:polyatree/code/20110524f.pdf]]
    res vs X[,2] : [[file:polyatree/code/20100524g.pdf]] 
*** DONE test on heter , median, bimodel
    CLOSED: [2011-05-25 Wed 01:48]
    data look like : [[file:polyatree/code/20110525a.pdf]]
    est : beta [1.11, 2.04], gamma [1, 0.2]
    mixing plot : [[file:polyatree/code/20110525h.pdf]]
    res vs X[,2] : [[file:polyatree/code/20110525i.pdf]]
*** TODO test quantile other than 0.5
    :PROPERTIES:
    :ID:       C59A165B-F59F-423E-9B7A-A25F12BFBBE3
    :END:
** TODO think about the choice of A[1,] based on tau
   :PROPERTIES:
   :ID:       CF68B8E6-6C20-4A6C-AAD5-AF927B2FC6A1
   :END:
** TODO fit mixed PT model
   :PROPERTIES:
   :ID:       03D4A12F-6E64-484C-8218-4811529A611D
   :END: 

* 2011-05-12
  stick to Walker & Mallick 's method since y = x*b + e, dont have much random term when sampling from e.
** DONE GetCount.R : get how many counts in the each interval, N(y,interval)

   
* 2011-04-20
   should plot resid|X hist to see whether median 0
** DONE check Reich and his code how he did for gamma/sigma identifiability problem, 
   CLOSED: [2011-04-23 Sat 09:45]
   fix $gamma[1]$, for(s in c(2:p)), if min(cansign)>0
   prior for sigma = flat prior (0,c1)
** TODO try 1/sigma^2 ~ Gamma(1,1) prior
   :PROPERTIES:
   :ID:       66741D89-C1EF-4E1D-BB0F-5A6F35922E41
   :END:
** DONE check Mallick how he did for updating first level a0 and a1   :level:
   CLOSED: [2011-04-26 Tue 14:30]
   did not see He kept a0 and a1 unchanged during updating
** DONE revise loglik_unippt for tau other than 0.5, and use y = xb+e , e~PT(tau); # myptquantile.R myloglikunippt.f 
   library(DPpackage)
   R CMD SHLIB myptquantile.f invcdfnorm.c
   CLOSED: [2011-04-23 Sat 09:44]
   1. y = x*b + e~N(0,1), 
      compare with myptlm2.R with tau = 0.5 , with X~N(2,1), e~N(0,1), homo model
      4-23, see homo-e1-myptquantile-50k-500obs, good estimates, good mixing
   2. y = x*b + e ~ N(0,1)
      try tau = 0.75, 0.9 , estimates should be added ***on intercept. X~N(2,1), 
      homo-e1-myptquantile-50k-500obs-0.75 and 0.95, estimates good.
   3. y = x*b + (x*gamma)*e , e~N(0,1), X~N(2,1), n=500, runs = 50k
      1. tau = 0.5 

#+begin_src R
	 > apply(foo2$beta[afterburn,],2,mean)
	 1.116539 2.011414
	 > mean(foo2$sigma[afterburn])
	 96.60993
#+end_src

      2. tau = 0.75 

#+begin_src R
	 > apply(foo2$beta[afterburn,],2,mean)
	 1.286611 3.049272
	 > mean(foo2$sigma[afterburn])
	 12.15426
#+end_src

	 residuals plot looks fine , 4-25-2.pdf  [[file:polyatree/code/4-25-2.pdf]]
      
      3. tau = 0.95

#+begin_src R
	 > apply(foo2$beta[afterburn,],2,mean)
	 12.729506  2.820130
	 > mean(foo2$sigma[afterburn])
	 9.64147
#+end_src

	 residuals plot: [[file:polyatree/code/4-25-3.pdf]]

       4. y = x*b + e , X~N(2,1), e~Bimodel,  HOMO 
      1. tau = 0.5,

#+begin_src R
	 > apply(foo2$beta[afterburn,],2,mean)
	 0.8064216 2.0466124
	 > mean(foo2$sigma[afterburn])
	 2.767956
#+end_src
	 [[file:polyatree/code/4-25-4.pdf]]

      2. tau = 0.9

#+begin_src R
	 apply(foo2$beta[afterburn,],2,mean)
	 3.274973 2.037439
	 > mean(foo2$sigma[afterburn])
	 1.833906
#+end_src
	 [[file:polyatree/code/4-25-5.pdf]]
	 # qbimodel(0.9) = 2.841622

** potential unconsistent of L(e), by Walker, Mallick (1999) and Jara (2009), also as to g(e)
   Danison-Mallick

   
* 2011-04-13
** DONE permute ei to check exchangibility for loglik_unippt  # it doesnot change
   CLOSED: [2011-04-18 Mon 19:42]
** DONE test on homo model (myheterptlm.R)
   CLOSED: [2011-04-18 Mon 22:39]
   actually more for heter model
** DONE check gamma*sigma , consider their product
   CLOSED: [2011-04-18 Mon 20:18]
   not exact as gamma,
** DONE check loglik_unippt , if they update first level	      :level:
   CLOSED: [2011-04-18 Mon 20:06]
   it does update first level , *depend on mdzero*
** DONE revise myheterptlm.R , update att each time # done
   CLOSED: [2011-04-18 Mon 19:44]
** TODO check MHrate when only small deviance on canbeta/cangamma
   :PROPERTIES:
   :ID:       1E0C1A99-B75A-4D12-AFF6-FCE30AFD6FF0
   :END:
** DONE check PTlm mixing # pretty good
   CLOSED: [2011-04-18 Mon 19:44]
** DONE revise myptlm.R  # done 
   CLOSED: [2011-04-18 Mon 19:43]
** DONE revise myheterptlm.R to update beta/gamma vector together # done
   CLOSED: [2011-04-18 Mon 19:43]

  
   
** DONE make a posterior quantile function for polya tree
   CLOSED: [2011-04-18 Mon 22:56]
** TODO check after myheterptlm, the posterior density of e
   :PROPERTIES:
   :ID:       89AEF61A-6F42-44DC-9433-B7810BF581AB
   :END:
   
** TODO new problem : myheterptlm.R for X~N(2,1), not good for gamma, too large
   :PROPERTIES:
   :ID:       81DC12E1-2452-4D50-B9A1-50D72F8091F6
   :END:
   actually when X~N(0,1), gamma too small
** TODO check gamma*Phi^-1(tau) [true] =  estimated gamma*Phi^-1(tau)
   :PROPERTIES:
   :ID:       EAA60FAB-039C-4534-A231-D4A19E47CBA5
   :END:

** DONE BQRiid X~N(2,1) e ~ N(0,1)
   CLOSED: [2011-04-19 Tue 17:16]
   1. homo model

      beta is good: 1.017670 1.959527 3.026009

   2. heter model

#+begin_src R
      > apply(fit1$beta[-(1:burn),],2,mean)
      [1] 0.2112864 1.9139275 3.4354247
      > apply(fit1$gamma[-(1:burn),],2,mean)
      [1] 1.000000 3.711290 2.208914
#+end_src

** DONE posterior myptlm2 X~N(2,1) e~N(0,1) # even 10k runs
   CLOSED: [2011-04-19 Tue 19:58]
   Homo model

#+begin_src R
   > apply(foo2$beta[afterburn,],2,mean)
   [1] 0.9638703 1.9451384 3.0343966
   > mean(foo2$sigma[afterburn])
   [1] 1.177481
#+end_src

** DONE posterior myptlm2 X~N(2,1) e~N(3,1) # even 10k runs
   CLOSED: [2011-04-19 Tue 19:58]
   Homo model : good

** DONE posterior myptlm2 X~U(2,3) e~N(3,1) # even 10k runs
   CLOSED: [2011-04-19 Tue 19:58]

#+begin_src R
   > apply(foo2$beta[afterburn,],2,mean)
   [1] 4.588289 1.919516 2.806195
#+end_src

** DONE posterior myptlm2 X~N(2,1), e~bimodel # 10k runs
   CLOSED: [2011-04-19 Tue 19:58]
   Homo model

#+BEGIN_src R
   ## > apply(foo2$beta[afterburn,],2,mean)
   [1] 0.9239102 1.9320364 3.0096620
   > mean(foo2$sigma[afterburn])
   [1] 2.958015
   residual plot good (obvious bimodel shape)
#+END_src

** DONE try single myheterptlm2 w/o sigma , base is N(0,1)
   CLOSED: [2011-04-19 Tue 19:58]
   not good for gamma
** TODO fix X'gamma > 0, by X ~ N(2,1) ?
   :PROPERTIES:
   :ID:       C5B76FBB-E2B1-4333-A4AB-DA55E5BE5EF1
   :END: 

** TODO revise loglik_unippt for tau other than 0.5, and use y = xb+e , e~PT(tau)
   :PROPERTIES:
   :ID:       A02819D1-6DE0-4E48-8171-E218F12F613B
   :END:

** DONE try y = xb+exp(x*gamma)e, where X~N(2,1), look into gamma estimate # myheterptlm4.R
   CLOSED: [2011-04-20 Wed 11:27]
   beta good, but not with gamma, still too large problem
   homo e~N(0,1)

#+begin_src R
   > apply(foo2$beta[afterburn,],2,mean)
   [1] 0.8030724 1.8966566 2.9205925
   > apply(foo2$gamma[afterburn,],2,mean)
   [1] 0.000000 5.150702 5.511493
   > mean(foo2$sigma[afterburn])
   [1] 0.008272906
#+end_src

** DONE try y = x*b + (gamma0+x*gamma) e, where X~N(2,1), look into gamma estimates # myheterptlm3.R
   even bad for homo+e~N(0,1)+X~N(2,1)
   CLOSED: [2011-04-20 Wed 10:25]

#+begin_src R
   > apply(foo2$beta[afterburn,],2,mean)
   [1] 0.4457855 2.0384361 3.2306537
   > apply(foo2$gamma[afterburn,],2,mean)
   [1]  95.52856 126.36820 122.80139
   > mean(foo2$sigma[afterburn])
   [1] 0.0003381502
#+end_src

* 2011-04-06
    exp not good for nice form, so focus on 
    y = a + x*b + (1 + x*d)*e
    test heter model y = (1+x*d)*e
    check DPpackage PTlmp.f etc file, check my pt likelihood is the same 
    with DPpackage  # little different , may check detail later

    for single y = sigma*N(0,1), # MCMC works
    note MH= sum(ldnorm(canres)-ldnorm(res)+
    log(sigma)-log(cansig))

    test huge heter factor with normal: 

    I found my previous likelihood of x1,...,xn is wrong, 
    actually it should be f(x1,...,xn)=f(xn|xn-1,...,x1)*...*f(x2|x1)*f(x1)
    while previously, I took f(x1,...xn)=f(x1|x1,...,xn)*...*f(xn|x1,...,xn)

    so, could use Jara's loglik_unippt to get likelihood in my MCMC
    
    # jara'DPpackage is good for bimodel:
    # y = x*b + e, e is bimodel
    
    # y = xb + x*gamma *N(1,1) 
    # PTlm good for beta (testmyheterptlm.R) , but not good for gamma

    # gamma seems to always prefer bigger
    # guess may not estimate the variance for polya tree distribution

    # back to y = x*b+exp(x*c)e , model , test if still larage variance problem

    # X~unif, gamma pretty large
    # X ~ norm, gamma  good

    # mixing not good, check tuning from Reich

* 2011-03-30
    y = a + x*b + exp(c + x*d)*e 
    without intercept(c) , then no identifiability problem, only need to constraint on median 0
    - e ~ N(0,1) or N(0, sigma)
    - e ~ PT(), mixture or fixed, 
    code for them , and test

* 2011-03-15     
    y = a + x*b + (1 (c) + x*d)*e 
    where e ~ iid PT(mix)
    explicit form of any quantile form
    identifiability problem (see hanson, johnson(2002) regression with PT) ( Walker and Mallick (1999))

* 2011-02-23
    run simulation for 5 design and 4 models
    deal with intercept problem
    learn fortran
    found Jara's code and paper, DPpackage, PTlm,
    did some experiment, might not deal with other quantile, 
    Jara might only deal with median (0 or nonzero)
    compared lm method with Jara's, and myPT
    test with heterogeinety y = x*0 + x* unif(0,1) , but didnot fit the model
    assumption

* 2011-02-16
    try 1000/500 sample size for FBQR with copula and check lag correlation
    try ALD for base , code for polya tree

* 2011-02-09
    try 100,000 loops 
    check hanson and johnson (2002) paper 
    check hanson, walker paper 
    try ALD for base (predictive) distribution in polya tree

* 2011-02-02
    improve the code 0.6s /loop but mix not good (using calling C from R)
    found funding for ENAR
    heard his leaving (NCSU) ?
    check paper lavine, hansen

* 2011-01-19
    1. conditional settings with common correlation matrix
    2. code it , runs well but slow
       
* 2011-01-26
    1. reject the conditional settings with common R, since 
       off diagonal correlation might be dominated by variance
    2. thought about the Reich 's setting with marginal copula
    3. code it but extremely slow
    4. need to check how they converges/ mix
    5. check Lavine (1992,? 94?) paper and Hansen 2006 JASA,
       about Polya tree, quantile, multivariate settings
    6. also use Google Scholar

* 2011-01-12
    write down whole previous thought
    1. test Reich's code
       simulation by self
    2. write down likelihood w/ longitudinal w/ gaussian copula
    3. MCMC with long using PACF method on correlation matrix
    
* 2010-12-1
    
* 2010-11-24
    thanksgiving , break
* 2010-11-17
    - some question about casella's notes
* 2010-11-10
    - Pi -> Rho has to bje recursive
    - check MCMC book
      G.Casella : ch1,2,7,8,9,10
      Gamerman : ch 1-6
    - revise my.pacf function, now reversible
* 2010-11-3
    - check Liu and Daniels, 2006, JCGS, 
    sampling a correlation matrix based on parameters expansion and reparameterization
    - check Daniels and Parahmad (2009) JMVA 
    partial autocorrelation to sample Correlation matrix (-1,1) 
    - wishart prior would be too constraint
* 2010-10-27
    - Mike's grandma pass away
    - check MCMC 
    - Pitt, chan , kohn (2006) biometrika
    - check gaussian copula
    gaussian copula + gaussian marginal = ? \neq MVN
    - check Song (2000) multi dispersion , gaussian copula
    - how to sampling C, the correlation matrix in copula
* 2010-10-20
    - cancelled
    - Bouye 2009 is bivariate case
* 2010-10-13
    1) cancelled 
    2) read three R code by Reich, may have a total review later
* 2010-10-06
    1) check bootstrap ; quantile regression
    2) check 2 papers in copula quantile regression (Bouye 2009) , estimation parts
       Koenker (1996) and Chen (2006) 
    3) consider (Bouye 2009) bivariate case -> n dim
    4) consider contrasts m(Y1-Y2)
    5) check Reich (2010) R code on his website , with copula
* 2010-09-29 
    copula + Reich problem 
* 2010-09-22 
    paper reading ( looking for copula method, further reading)
* 2010-09-15
    paper reading ( check function, lasso, penalized term)
* 2010-09-08
    image / quantile regression
* 2010-09-01 
  paper reading , topic deciding
